<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Markdown链接小卡片</title>
      <link href="/2021/12/05/%E6%8A%80%E6%9C%AF/02.Markdown%E9%93%BE%E6%8E%A5%E5%B0%8F%E5%8D%A1%E7%89%87/"/>
      <url>/2021/12/05/%E6%8A%80%E6%9C%AF/02.Markdown%E9%93%BE%E6%8E%A5%E5%B0%8F%E5%8D%A1%E7%89%87/</url>
      
        <content type="html"><![CDATA[<p>提醒：需要会写基本的<code>Markdown</code>语法（当然，如果只想学会链接小卡片的话会写图片和链接的语法就可以了）。</p><h1 id="什么是链接小卡片"><a href="#什么是链接小卡片" class="headerlink" title="什么是链接小卡片"></a>什么是链接小卡片</h1><p>实际上叫<code>badge</code>，翻译过来是徽标的意思。因为我每次用这个都是用作链接，而它长得有点像小卡片，所以贴心地起名叫“链接小卡片”。</p><h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>链接小卡片本质上是借助 <a href="https://img.shields.io/"><img src="https://img.shields.io/badge/Shields.io-%E5%85%AB%E6%9C%88?color=222&logo=shieldsdotio"></a> 这个网站来实现的图片。所以会用到 Markdown 图片语法，如果想做成链接，还需用到 Markdown 链接语法。</p><p>所有参数值未加特殊说明均不可省略！</p><p>由于是通过其他网站实现显示图片，所以要想正常显示，必须确保有网。</p><h2 id="单内容链接小卡片"><a href="#单内容链接小卡片" class="headerlink" title="单内容链接小卡片"></a>单内容链接小卡片</h2><p>我把只有一个内容项的称为<strong>单内容链接小卡片</strong>。</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/内容-防伪值?color=颜色值</span>)</span><br></pre></td></tr></table></figure><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/未央-八月?color=ff69b4</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/%E6%9C%AA%E5%A4%AE-%E5%85%AB%E6%9C%88?color=ff69b4"></p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>使用时替换语法代码部分中的汉字内容即可</li><li>颜色值可省略（从 ? 开始省略）</li><li>颜色值均指背景颜色，字体颜色会自动调整，无法自定义字体颜色</li><li>颜色值若使用 16 进制，不要加 # 号</li><li>默认的颜色是：<img src="https://img.shields.io/badge/%E7%BB%BF%E7%9A%84-%E6%9C%AA%E5%A4%AE"></li><li>防伪值只是我是这么叫的，因为它不会显示</li><li>只要出现防伪值，防伪值均不可省略，下同</li></ul><h2 id="双内容链接小卡片"><a href="#双内容链接小卡片" class="headerlink" title="双内容链接小卡片"></a>双内容链接小卡片</h2><p>我把有两个内容项的称为<strong>双内容链接小卡片</strong>。</p><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/前内容-后内容-后内容颜色值</span>)</span><br></pre></td></tr></table></figure><h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/Atideas-未央-fff</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/Atideas-%E6%9C%AA%E5%A4%AE-fff"></p><h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>所有内容均不可省略，包括颜色值</li><li>这里的颜色值只能修改<strong>后内容</strong>的颜色值</li></ul><h2 id="图标链接小卡片"><a href="#图标链接小卡片" class="headerlink" title="图标链接小卡片"></a>图标链接小卡片</h2><p>我把带有小图标的称为<strong>图标链接小卡片</strong>。</p><p>图标链接小卡片又分为<strong>内置图标链接小卡片</strong>和<strong>自定义图标链接小卡片</strong>。</p><h3 id="内置图标链接小卡片"><a href="#内置图标链接小卡片" class="headerlink" title="内置图标链接小卡片"></a>内置图标链接小卡片</h3><p>内置图标可以直接使用。所有内置图标可以在这里找到（点击传送）：<a href="https://simpleicons.org/"><img src="https://img.shields.io/badge/Simple%20Icons-%E5%85%AB%E6%9C%88?color=222&logo=simpleicons"></a></p><h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/内容-防伪值?color=颜色&amp;logo=内置图标名</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/前内容-后内容-后内容颜色值?logo=内置图标名</span>)</span><br></pre></td></tr></table></figure><h4 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/QQ-八月?color=4ab7f5&amp;logo=tencentqq</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/macOS-10.13+-367aff?logo=apple</span>)</span><br></pre></td></tr></table></figure><p>效果：</p><ol><li><p>单内容：<img src="https://img.shields.io/badge/QQ-%E5%85%AB%E6%9C%88?color=4ab7f5&logo=tencentqq"></p></li><li><p>双内容：<img src="https://img.shields.io/badge/macOS-10.13+-367aff?logo=apple"></p></li></ol><h4 id="修改内置图标颜色"><a href="#修改内置图标颜色" class="headerlink" title="修改内置图标颜色"></a>修改内置图标颜色</h4><ul><li>部分内置图标默认是白色的，比如上面的示例</li><li>部分内置图标默认自带颜色，比如：<img src="https://img.shields.io/badge/WeChat-%E5%85%AB%E6%9C%88?color=fff&logo=wechat"> 和 <img src="https://img.shields.io/badge/%E6%94%AF%E4%BB%98%E5%AE%9D-%E5%85%AB%E6%9C%88?color=fff&logo=alipay"> </li><li>哪些默认带颜色，哪些默认不带，需要自己试</li><li>内置图标的颜色可以修改</li></ul><h5 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/内容-防伪值?color=颜色&amp;logo=内置图标名&amp;logoColor=内置图标颜色值</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/前内容-后内容-后内容颜色值?logo=内置图标名&amp;logoColor=内置图标颜色值</span>)</span><br></pre></td></tr></table></figure><h5 id="示例-3"><a href="#示例-3" class="headerlink" title="示例"></a>示例</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/QQ-八月?color=fff&amp;logo=tencentqq&amp;logoColor=4ab7f5</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/macOS-10.13+-367aff?logo=apple&amp;logoColor=f9d694</span>)</span><br></pre></td></tr></table></figure><p>效果：</p><ol><li><p>单内容：<img src="https://img.shields.io/badge/QQ-%E5%85%AB%E6%9C%88?color=4ab7f5&logo=tencentqq"></p></li><li><p>双内容：<img src="https://img.shields.io/badge/macOS-10.13+-367aff?logo=apple"></p></li></ol><h4 id="自定义图标链接小卡片"><a href="#自定义图标链接小卡片" class="headerlink" title="自定义图标链接小卡片"></a>自定义图标链接小卡片</h4><p>自定义图标需将图片转换成<code>Base64</code>编码（这样的工具很多），同时需要原图片的长和宽均 ≥ 14px。</p><h5 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h5><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/内容-防伪值?color=颜色&amp;logo=内置图标名&amp;logoColor=内置图标颜色值</span>)</span><br><span class="line"></span><br><span class="line"><span class="bullet">2.</span> 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/前内容-后内容-后内容颜色值?logo=内置图标名&amp;logoColor=内置图标颜色值</span>)</span><br></pre></td></tr></table></figure><h5 id="示例-4"><a href="#示例-4" class="headerlink" title="示例"></a>示例</h5><p>我把自己的头像转换成了<code>Base64</code>编码作为示例，不过编码太长了，放进来严重影响性能，所以就省略不放了。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> 单内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/未央-八月?color=fff&amp;logo=data:image/png;base64,AAA...A==</span>)</span><br><span class="line"></span><br><span class="line">;2. 双内容</span><br><span class="line">![](<span class="link">https://img.shields.io/badge/Atideas-未央-八月?color=fff&amp;logo=data:image/png;base64,AAA...A==</span>)</span><br></pre></td></tr></table></figure><p>效果：</p><ol><li><p>单内容：<img src="https://img.shields.io/badge/%E6%9C%AA%E5%A4%AE-%E5%85%AB%E6%9C%88?color=fff&logo=data:image/jpg;base64,9j"></p></li><li><p>双内容：<img src="https://img.shields.io/badge/Atideas-%E6%9C%AA%E5%A4%AE-%E5%85%AB%E6%9C%88?color=fff&logo=data:image/jpg;base64,9j"></p></li></ol><h2 id="双内容自定义颜色"><a href="#双内容自定义颜色" class="headerlink" title="双内容自定义颜色"></a>双内容自定义颜色</h2><p>前面提及双内容链接小卡片的语法和示例中可修改的颜色值都只能修改后内容的颜色。本小节将演示如何分别控制双内容的颜色。</p><h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/后内容-防伪值?label=前内容&amp;colorA=前内容颜色值&amp;colorB=后内容颜色值</span>)</span><br></pre></td></tr></table></figure><h3 id="示例-5"><a href="#示例-5" class="headerlink" title="示例"></a>示例</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/macOS-八月?label=AppStore&amp;colorA=fff&amp;colorB=367aff&amp;logo=appstore</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/macOS-%E5%85%AB%E6%9C%88?label=AppStore&colorA=fff&colorB=367aff&logo=appstore"></p><h3 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>注意图片语法链接中的“前内容”跑到后面去了，“后内容”跑到前面去了，不要搞反了</li><li>如果要加上图标，比如上面的示例，直接在图片语法链接末尾加上<code>&amp;logo=图标名</code>即可，注意<code>&amp;</code>不要忘了</li><li>如果还要修改图标颜色，再继续在链接末尾继续加上<code>&amp;logoColor=图标颜色值</code>即可</li></ul><h2 id="增加超链接"><a href="#增加超链接" class="headerlink" title="增加超链接"></a>增加超链接</h2><p>链接小卡片是可以点的，这是因为在<code>Markdown</code>图片语法外层又套娃了一层超链接语法。</p><h3 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">链接小卡片图片显示</span>](<span class="link">超链接地址</span>)</span><br></pre></td></tr></table></figure><h3 id="示例-6"><a href="#示例-6" class="headerlink" title="示例"></a>示例</h3><p>就是把<code>§ 2.1 ~ § 2.4</code>学到的放在超链接语法的 [] 里就行。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">![</span>](<span class="link">https://img.shields.io/badge/未央-八月?color=fff&amp;logo=data:image/png;base64,AAA...A==</span>)](<span class="link">https://atideas.github.io/</span>)</span><br></pre></td></tr></table></figure><p>效果：<a href="https://atideas.github.io/"><img src="https://img.shields.io/badge/%E6%9C%AA%E5%A4%AE-%E5%85%AB%E6%9C%88?color=fff&logo=data:image/png;base64,AAA...A=="></a></p><h3 id="注意事项-3"><a href="#注意事项-3" class="headerlink" title="注意事项"></a>注意事项</h3><ul><li>注意图片语法链接中的“前内容”跑到后面去了，“后内容”跑到前面去了，不要搞反了</li><li>如果要加上图标，比如上面的示例，直接在图片语法链接末尾加上<code>&amp;logo=图标名</code>即可，注意<code>&amp;</code>不要忘了</li><li>如果还要修改图标颜色，再继续在链接末尾继续加上<code>&amp;logoColor=图标颜色值</code>即可</li></ul><p>其他的可以自行尝试。</p><h2 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h2><p>有五种样式可供选择。</p><h3 id="立体胶质圆角矩形"><a href="#立体胶质圆角矩形" class="headerlink" title="立体胶质圆角矩形"></a>立体胶质圆角矩形</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/style=plastic-八月?label=Git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git&amp;style=plastic</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/style=plastic-%E5%85%AB%E6%9C%88?label=Git&colorA=fff&colorB=f14d28&logo=git&style=plastic"></p><h3 id="扁平圆角矩形（默认）"><a href="#扁平圆角矩形（默认）" class="headerlink" title="扁平圆角矩形（默认）"></a>扁平圆角矩形（默认）</h3><p>如果什么都不加，默认就相当于<code>&amp;style=flat</code>。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/style=flat-八月?label=Git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git&amp;style=flat</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/style=flat-%E5%85%AB%E6%9C%88?label=Git&colorA=fff&colorB=f14d28&logo=git&style=flat"></p><h3 id="扁平直角矩形"><a href="#扁平直角矩形" class="headerlink" title="扁平直角矩形"></a>扁平直角矩形</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/style=flat--square-八月?label=Git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git&amp;style=flat-square</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/style=flat--square-%E5%85%AB%E6%9C%88?label=Git&colorA=fff&colorB=f14d28&logo=git&style=flat-square"></p><h3 id="大扁平圆角矩形-字母全大写"><a href="#大扁平圆角矩形-字母全大写" class="headerlink" title="大扁平圆角矩形 - 字母全大写"></a>大扁平圆角矩形 - 字母全大写</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/style=for--the--badge-八月?label=Git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git&amp;style=for-the-badge</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/style=for--the--badge-%E5%85%AB%E6%9C%88?label=Git&colorA=fff&colorB=f14d28&logo=git&style=for-the-badge"></p><h3 id="GitHub-交流样式"><a href="#GitHub-交流样式" class="headerlink" title="GitHub 交流样式"></a>GitHub 交流样式</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/style=social-八月?label=Git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git&amp;style=social</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/style=social-%E5%85%AB%E6%9C%88?label=Git&colorA=fff&colorB=f14d28&logo=git&style=social"></p><h2 id="动态内容"><a href="#动态内容" class="headerlink" title="动态内容"></a>动态内容</h2><p>动态内容即显示的内容为可变的，主要用于<code>GitHub</code>等网站的某些数据显示。</p><p>这里的动态内容只介绍与<code>GitHub</code>相关的一部分，想了解更多可以去官网查询。</p><p>以<code>Linux</code>之父林纳斯·托瓦斯的<code>Linux</code>源代码仓库<code>torvalds/linux</code>为示例。</p><h3 id="Watch"><a href="#Watch" class="headerlink" title="Watch"></a>Watch</h3><p>语法：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/watchers/用户名/仓库名?style=social&amp;label=Watch</span>)</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/watchers/torvalds/linux?style=social&amp;label=Watch</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/github/watchers/torvalds/linux?style=social&label=Watch"></p><h3 id="Star"><a href="#Star" class="headerlink" title="Star"></a>Star</h3><p>语法：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/stars/用户名/仓库名?style=social</span>)</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/stars/torvalds/linux?style=social&amp;label=star</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/github/stars/torvalds/linux?style=social&label=star"></p><h3 id="Fork"><a href="#Fork" class="headerlink" title="Fork"></a>Fork</h3><p>语法：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/forks/用户名/仓库名?style=social&amp;label=Fork</span>)</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/github/forks/torvalds/linux?style=social&amp;label=Fork</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/github/forks/torvalds/linux?style=social&label=Fork"></p><p>其他的可以自行尝试。</p><h1 id="特殊符号问题"><a href="#特殊符号问题" class="headerlink" title="特殊符号问题"></a>特殊符号问题</h1><p>有时候需要空格或者其他的特殊符号，直接打在链接里可能会导致结果不符合预期。</p><p>解决方法其实很简单，就是把特殊符号转换成<code>url</code>编码即可。</p><h2 id="空格示例"><a href="#空格示例" class="headerlink" title="空格示例"></a>空格示例</h2><p>之前<code>App Store</code>那个示例中是没有空格的，现在添加空格（空格的<code>url</code>编码是<code>%20</code>）：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/macOS-八月?label=App%20Store&amp;colorA=fff&amp;colorB=367aff&amp;logo=appstore</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/macOS-%E5%85%AB%E6%9C%88?label=App%20Store&colorA=fff&colorB=367aff&logo=appstore"></p><h2 id="短横-符号示例"><a href="#短横-符号示例" class="headerlink" title="短横 - 符号示例"></a>短横 - 符号示例</h2><p>短横符号<code>-</code>比较特殊，它没有<code>url</code>编码，或者说它的<code>url</code>编码就是它本身。 要想在小卡片中显示它也很简单，写两遍就行。</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">![](<span class="link">https://img.shields.io/badge/----everything--is--local-八月?label=git&amp;colorA=fff&amp;colorB=f14d28&amp;logo=git</span>)</span><br></pre></td></tr></table></figure><p>效果：<img src="https://img.shields.io/badge/----everything--is--local-%E5%85%AB%E6%9C%88?label=git&colorA=fff&colorB=f14d28&logo=git"></p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>面向对象设计的SOLID原则</title>
      <link href="/2021/12/04/%E6%8A%80%E6%9C%AF/01.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E7%9A%84SOLID%E5%8E%9F%E5%88%99/"/>
      <url>/2021/12/04/%E6%8A%80%E6%9C%AF/01.%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1%E7%9A%84SOLID%E5%8E%9F%E5%88%99/</url>
      
        <content type="html"><![CDATA[<p><code>S.O.L.I.D</code>是面向对象设计和编程（<code>OOD&amp;OOP</code>）中几个重要编码原则（Programming Priciple）的首字母缩写。</p><table><thead><tr><th align="center"><strong>SRP</strong></th><th align="center"><a href="http://www.objectmentor.com/resources/articles/srp.pdf">The Single Responsibility Principle</a><br/></th><th align="center">单一责任原则</th></tr></thead><tbody><tr><td align="center"><strong>OCP</strong></td><td align="center"><a href="http://www.objectmentor.com/resources/articles/ocp.pdf">The Open Closed Principle</a><br/></td><td align="center">开放封闭原则</td></tr><tr><td align="center"><strong>LSP</strong></td><td align="center"><a href="http://www.objectmentor.com/resources/articles/lsp.pdf">The Liskov Substitution Principle</a></td><td align="center">里氏替换原则</td></tr><tr><td align="center"><strong>DIP</strong></td><td align="center"><a href="http://www.objectmentor.com/resources/articles/dip.pdf">The Dependency Inversion Principle</a></td><td align="center">依赖倒置原则</td></tr><tr><td align="center"><strong>ISP</strong></td><td align="center"><a href="http://www.objectmentor.com/resources/articles/isp.pdf">The Interface Segregation Principle</a></td><td align="center">接口分离原则</td></tr></tbody></table><p><a href="http://stevesmithblog.com/">Steve Smith</a>在5月份的微软TechED 2009上有个<a href="http://stevesmithblog.com/blog/teched-2009-session-aftermath/">SOLIDify Your ASP.NET MVC</a>的讲座, <a href="http://www.lostechies.com/members/derick.bailey/default.aspx">derick.bailey</a>的<a href="http://www.lostechies.com/blogs/derickbailey/archive/2009/02/11/solid-development-principles-in-motivational-pictures.aspx">SOLID Development Principles – In Motivational Pictures</a>很好的解释了SOLID原则。</p><h1 id="单一责任原则"><a href="#单一责任原则" class="headerlink" title="单一责任原则"></a>单一责任原则</h1><p>当需要修改某个类的时候原因有且只有一个（<code>THERE SHOULD NEVER BE MORE THAN ONE REASON FOR A CLASS TO CHANGE</code>）。换句话说就是让一个类只做一种类型责任，当这个类需要承当其他类型的责任的时候，就需要分解这个类。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638580256/1639479537-3625ee4b.png" title="The Single Responsibility Principle"></p></div><h1 id="开放封闭原则"><a href="#开放封闭原则" class="headerlink" title="开放封闭原则"></a>开放封闭原则</h1><p>软件实体应该是可扩展，而不可修改的。也就是说，对扩展是开放的，而对修改是封闭的。这个原则是诸多面向对象编程原则中最抽象、最难理解的一个。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638580256/1639479579-620695e9.png" title="Open Closed Principle"></p></div><h1 id="里氏替换原则"><a href="#里氏替换原则" class="headerlink" title="里氏替换原则"></a>里氏替换原则</h1><p>当一个子类的实例应该能够替换任何其超类的实例时，它们之间才具有<code>is-A</code>关系。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638580256/1639479664-eec4a030.png" title="Liskov Subtitution Principle"></p></div><h1 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h1><ol><li>高层模块不应该依赖于低层模块，二者都应该依赖于抽象</li><li>抽象不应该依赖于细节，细节应该依赖于抽象</li></ol><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638580256/1639479695-20bdd418.png" title="Dependency Inversion Principle"></p></div><h1 id="接口分离原则"><a href="#接口分离原则" class="headerlink" title="接口分离原则"></a>接口分离原则</h1><p>不能强迫用户去依赖那些他们不使用的接口。换句话说，使用多个专门的接口比使用单一的总接口总要好。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638580256/1639479768-7deecc37.png" title="Interface Segregation Principle"></p></div><p>这几条原则是非常基础而且重要的面向对象设计原则。正是由于这些原则的基础性，理解、融汇贯通这些原则需要不少的经验和知识的积累。上述的图片很好的注释了这几条原则。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面向对象 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式介绍</title>
      <link href="/2021/12/03/%E6%8A%80%E6%9C%AF/%E6%AD%A3%E5%88%99/01.%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BB%8B%E7%BB%8D/"/>
      <url>/2021/12/03/%E6%8A%80%E6%9C%AF/%E6%AD%A3%E5%88%99/01.%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是正则表达式？"><a href="#什么是正则表达式？" class="headerlink" title="什么是正则表达式？"></a>什么是正则表达式？</h1><blockquote><p>正则表达式是一组由字母和符号组成的特殊文本, 它可以用来从文本中找出满足你想要的格式的句子。</p></blockquote><p>一个正则表达式是在一个主体字符串中从左到右匹配字符串时的一种样式。例如<code>Regular expression</code>是一个完整的句子，但我们常使用缩写的术语<code>regex</code>或<code>regexp</code>。</p><p>正则表达式可以用来替换文本中的字符串、验证形式、提取字符串等等。</p><p>想象你正在写一个应用，然后你想设定一个用户命名的规则，让用户名包含字符、数字、下划线和连字符以及限制字符的个数，好让名字看起来没那么丑。</p><p>我们使用以下正则表达式来验证一个用户名:</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638522453/1639473212-1926fd4f.png"></p></div><p>以上的正则表达式可以接受 <code>john_doe</code>, <code>jo-hn_doe</code>, <code>john12_as</code>，但不匹配<code>Jo</code>，因为它包含了大写的字母而且太短了。</p><h1 id="基本匹配"><a href="#基本匹配" class="headerlink" title="基本匹配"></a>基本匹配</h1><p>正则表达式其实就是在执行搜索时的格式，它由一些字母和数字组合而成。</p><p>例如: 一个正则表达式 <code>the</code>，它表示一个规则：由字母<code>t</code>开始,接着是<code>h</code>,再接着是<code>e</code>.</p><blockquote><p>“the” =&gt; The fat cat sat on <strong>the</strong> mat.</p></blockquote><p>正则表达式<code>123</code>匹配字符串<code>123</code>。它逐个字符的与输入的正则表达式做比较。</p><p>正则表达式是大小写敏感的，所以<code>The</code>不会匹配<code>the</code></p><blockquote><p>“The” =&gt; <strong>The</strong> fat cat sat on the mat.</p></blockquote><h1 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h1><p>正则表达式主要依赖于元字符。</p><p>元字符不代表他们本身的字面意思，他们都有特殊的含义。</p><p>一些元字符写在方括号中的时候有一些特殊的意思.。</p><p>以下是一些元字符的介绍:</p><table><thead><tr><th align="center">元字符</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">.</td><td align="center">句号匹配任意单个字符除了换行符</td></tr><tr><td align="center">[ ]</td><td align="center">字符种类. 匹配方括号内的任意字符</td></tr><tr><td align="center">[^ ]</td><td align="center">否定的字符种类. 匹配除了方括号里的任意字符</td></tr><tr><td align="center">*</td><td align="center">匹配&gt;=0个重复的在*号之前的字符</td></tr><tr><td align="center">+</td><td align="center">匹配&gt;1个重复的+号前的字符</td></tr><tr><td align="center">?</td><td align="center">标记?之前的字符为可选</td></tr><tr><td align="center">{n,m}</td><td align="center">匹配num个中括号之前的字符 (n &lt;= num &lt;= m)</td></tr><tr><td align="center">(xyz)</td><td align="center">字符集, 匹配与 xyz 完全相等的字符串</td></tr><tr><td align="center">&#124;</td><td align="center">或运算符,匹配符号前或后的字符</td></tr><tr><td align="center">&#92;</td><td align="center">转义字符,用于匹配一些保留的字符 <code>[ ] ( ) &#123; &#125; . * + ? ^ $ \</td></tr><tr><td align="center">^</td><td align="center">从开始行开始匹配</td></tr><tr><td align="center">$</td><td align="center">从末端开始匹配</td></tr></tbody></table><h2 id="点运算符"><a href="#点运算符" class="headerlink" title="点运算符 ."></a>点运算符 <code>.</code></h2><p><code>.</code>是元字符中最简单的例子。</p><p><code>.</code>匹配任意单个字符，但不匹配换行符。</p><p>例如，表达式<code>.ar</code>匹配一个任意字符后面跟着是<code>a</code>和<code>r</code>的字符串。</p><blockquote><p>“.ar” =&gt; The <strong>car par</strong>ked in the <strong>gar</strong>age</p></blockquote><h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><p>字符集也叫做字符类。</p><p>方括号用来指定一个字符集，在方括号中使用连字符来指定字符集的范围；在方括号中的字符集不关心顺序。</p><p>例如，表达式<code>[Tt]he</code> 匹配 <code>the</code> 和 <code>The</code>。</p><blockquote><p>“[Tt]he” =&gt; <strong>The</strong> car parked in <strong>the</strong> garage.</p></blockquote><p>方括号的句号就表示句号。</p><p>表达式 <code>ar[.]</code> 匹配 <code>ar.</code>字符串。</p><blockquote><p>“ar[.]” =&gt; A garage is a good place to park a c<strong>ar</strong></p></blockquote><h3 id="否定字符集"><a href="#否定字符集" class="headerlink" title="否定字符集"></a>否定字符集</h3><p>一般来说 <code>^</code> 表示一个字符串的开头，但它用在一个方括号的开头的时候表示这个字符集是否定的。</p><p>例如, 表达式<code>[^c]ar</code> 匹配一个后面跟着<code>ar</code>的除了<code>c</code>的任意字。</p><blockquote><p>“[^c]ar” =&gt; The car <strong>par</strong>ked in the <strong>gar</strong>age.</p></blockquote><h2 id="重复次数"><a href="#重复次数" class="headerlink" title="重复次数"></a>重复次数</h2><p>后面跟着元字符<code>+</code>、<code>*</code>、<code>?</code> 的，用来指定匹配子模式的次数。这些元字符在不同的情况下有着不同的意思。</p><h3 id="号"><a href="#号" class="headerlink" title="* 号"></a><code>*</code> 号</h3><p><code>*</code>号匹配在<code>*</code>之前的字符出现<code>大于等于0</code>次。</p><p>例如，表达式<code>a*</code>匹配以<code>0</code>或更多个<code>a</code>开头的字符，因为有<code>0</code>个这个条件，其实也就匹配了所有的字符。表达式<code>[a-z]*</code>匹配一个行中所有以小写字母开头的字符串。</p><blockquote><p>“[a-z]<em>“ =&gt; T*<em>he car parked in the garage</em></em>.</p></blockquote><p><code>*</code>字符和<code>.</code>字符搭配可以匹配所有的字符<code>.*</code>。</p><p><code>*</code>和表示匹配空格的符号<code>\s</code>连起来用, 如表达式<code>\s*cat\s*</code>匹配<code>0</code>或更多个空格开头和<code>0</code>或更多个空格结尾的<code>cat</code>字符串。</p><blockquote><p>“\s*cat\s*“ =&gt; The fat <strong>cat</strong> sat on the con<strong>cat</strong>enation</p></blockquote><h3 id="号-1"><a href="#号-1" class="headerlink" title="+ 号"></a><code>+</code> 号</h3><p><code>+</code>号匹配<code>+</code>号之前的字符出现<code>&gt;=1</code>次个字符。</p><p>例如，表达式<code>c.+t</code> 匹配以首字母<code>c</code>开头以<code>t</code>结尾,中间跟着任意个字符的字符串。</p><blockquote><p>“c.+t” =&gt; The fat <strong>cat sat  on the mat</strong>.</p></blockquote><h3 id="号-2"><a href="#号-2" class="headerlink" title="? 号"></a><code>?</code> 号</h3><p>在正则表达式中元字符 <code>?</code> 标记在符号前面的字符为可选, 即出现<code>0</code>或<code>1</code>次。</p><p>例如，表达式<code>[T]?he</code>匹配字符串<code>he</code>和<code>The</code>。</p><blockquote><p>“[T]he” =&gt; <strong>The</strong> car is parked in the garage.</p><p>“[T]?he” =&gt; <strong>The</strong> car is parked in t<strong>he</strong> garage.</p></blockquote><h2 id="号-3"><a href="#号-3" class="headerlink" title="{} 号"></a><code>&#123;&#125;</code> 号</h2><p>在正则表达式中 <code>&#123;&#125;</code> 是一个量词，常用来一个或一组字符可以重复出现的次数。</p><p>例如，表达式 <code>[0-9]&#123;2,3&#125;</code> 匹配<code>2~3</code>位<code>0~9</code>的数字.</p><blockquote><p>“[0-9]{2,3}” =&gt; The number was 9.<strong>999</strong>7 but we rounded it off to <strong>10</strong>.0.</p></blockquote><p>我们可以省略第二个参数。</p><p>例如，<code>[0-9]&#123;2,&#125;</code>匹配至少两位<code>0~9</code>的数字。</p><blockquote><p>“[0-9]{2,}” =&gt; The number was 9.<strong>9997</strong> but we rounded it off to <strong>10</strong>.0.</p></blockquote><p>如果逗号也省略掉则表示重复固定的次数。<br>例如, <code>[0-9]&#123;3&#125;</code> 匹配<code>3</code>位数字。</p><blockquote><p>“[0-9]{3}” =&gt; The number was 9.<strong>999</strong>7 but we rounded it off to 10.0.</p></blockquote><h2 id="特征标群"><a href="#特征标群" class="headerlink" title="(...) 特征标群"></a><code>(...)</code> 特征标群</h2><p>特征标群是一组写在 <code>(...)</code> 中的子模式。</p><p>例如之前说的<code>&#123;&#125;</code>是用来表示前面一个字符出现指定次数，但如果在<code>&#123;&#125;</code>前加入特征标群则表示整个标群内的字符重复<code>N</code>次。</p><p>例如, 表达式<code>(ab)*</code>匹配连续出现<code>0</code>或更多个<code>ab</code>。</p><p>我们还可以在<code>()</code>中用或字符<code>|</code>表示或。</p><p>例如，<code>(c|g|p)ar</code>匹配<code>car</code>或<code>gar</code>或<code>par</code>。</p><blockquote><p>“(c|g|p)ar” =&gt; The <strong>car</strong> is <strong>par</strong>ked in the <strong>gar</strong>age.</p></blockquote><h2 id="或运算符"><a href="#或运算符" class="headerlink" title="| 或运算符"></a><code>|</code> 或运算符</h2><p>或运算符就表示或，用作判断条件。</p><p>例如<code>(T|t)he|car</code>匹配<code>(T|t)he</code> 或 <code>car</code>。</p><blockquote><p>“(T|t)he|car” =&gt; <strong>The car</strong> is parked in <strong>the</strong> garage.</p></blockquote><h2 id="转码特殊字符"><a href="#转码特殊字符" class="headerlink" title="转码特殊字符"></a>转码特殊字符</h2><p>反斜线<code>\</code>在表达式中用于转码紧跟其后的字符。用于指定<code>&#123; &#125; [ ] / \ + * . $ ^ | ?</code>这些特殊字符，如果想要匹配这些特殊字符则要在其前面加上反斜线<code>\</code>。</p><p>例如<code>.</code>是用来匹配除换行符外的所有字符的，如果想要匹配句子中的<code>.</code>则要写成<code>\.</code>。</p><blockquote><p>“(f|c|m)at.?” =&gt; The <strong>fat cat</strong> sat on the <strong>mat</strong>.</p></blockquote><h2 id="锚点"><a href="#锚点" class="headerlink" title="锚点"></a>锚点</h2><p>在正则表达式中, 想要匹配指定开头或结尾的字符串就要使用到锚点. <code>^</code> 指定开头, <code>$</code> 指定结尾.</p><h3 id="号-4"><a href="#号-4" class="headerlink" title="^ 号"></a><code>^</code> 号</h3><p><code>^</code>用来检查匹配的字符串是否在所匹配字符串的开头。</p><p>例如，在<code>abc</code>中使用表达式<code>^a</code>会得到结果<code>a</code>，但如果使用<code>^b</code>将匹配不到任何结果，因为在字符串<code>abc</code>中并不是以<code>b</code>开头。</p><p>例如，<code>^(T|t)he</code>匹配以<code>The</code>或<code>the</code>开头的字符串。</p><blockquote><p>“(T|t)he” =&gt; The car is parked in <strong>the</strong> garage.</p><p>“^(T|t)he” =&gt; <strong>The</strong> car is parked in the garage.</p></blockquote><h3 id="号-5"><a href="#号-5" class="headerlink" title="$ 号"></a><code>$</code> 号</h3><p>同理于<code>^</code>号，<code>$</code>号用来匹配字符是否是最后一个。</p><p>例如，<code>(at\.)$</code>匹配以<code>at.</code>结尾的字符串。</p><blockquote><p>“(at.)” =&gt; The fat c<strong>at.</strong> s<strong>at.</strong> on the mat.</p><p>“(at.)$” =&gt; The fat cat. sat. on the m<strong>at.</strong></p></blockquote><h2 id="简写字符集"><a href="#简写字符集" class="headerlink" title="简写字符集"></a>简写字符集</h2><p>正则表达式提供一些常用的字符集简写. 如下:</p><table><thead><tr><th align="center">简写</th><th>描述</th></tr></thead><tbody><tr><td align="center">.</td><td>除换行符外的所有字符</td></tr><tr><td align="center">\w</td><td>匹配所有字母数字, 等同于 <code>[a-zA-Z0-9_]</code></td></tr><tr><td align="center">\W</td><td>匹配所有非字母数字, 即符号, 等同于: <code>[^\w]</code></td></tr><tr><td align="center">\d</td><td>匹配数字: <code>[0-9]</code></td></tr><tr><td align="center">\D</td><td>匹配非数字: <code>[^\d]</code></td></tr><tr><td align="center">\s</td><td>匹配所有空格字符, 等同于: <code>[\t\n\f\r\p&#123;Z&#125;]</code></td></tr><tr><td align="center">\S</td><td>匹配所有非空格字符: <code>[^\s]</code></td></tr></tbody></table><h2 id="前后关联约束（前后预查）"><a href="#前后关联约束（前后预查）" class="headerlink" title="前后关联约束（前后预查）"></a>前后关联约束（前后预查）</h2><p>前置约束和后置约束都属于<strong>非捕获簇</strong>（用于匹配不在匹配列表中的格式）。</p><p>前置约束用于判断所匹配的格式是否在另一个确定的格式之后。</p><p>例如，我们想要获得所有跟在<code>$</code>符号后的数字，我们可以使用正向向后约束<code>(?&lt;=\$)[0-9\.]*</code>。这个表达式匹配<code>$</code>开头，之后跟着<code>0,1,2,3,4,5,6,7,8,9,.</code>这些字符可以出现大于等于<code>0</code>次。</p><p>前后关联约束如下：</p><table><thead><tr><th align="center">符号</th><th>描述</th></tr></thead><tbody><tr><td align="center">?=</td><td>前置约束-存在</td></tr><tr><td align="center">?!</td><td>前置约束-排除</td></tr><tr><td align="center">?&lt;=</td><td>后置约束-存在</td></tr><tr><td align="center">?&lt;!</td><td>后置约束-排除</td></tr></tbody></table><h3 id="前置约束（存在）"><a href="#前置约束（存在）" class="headerlink" title="?=... 前置约束（存在）"></a><code>?=...</code> 前置约束（存在）</h3><p><code>?=...</code>前置约束（存在），表示第一部分表达式必须跟在<code>?=...</code>定义的表达式之后。</p><p>返回结果只瞒住第一部分表达式。</p><p>定义一个前置约束（存在）要使用<code>()</code>，在括号内部使用一个问号和等号：<code>(?=...)</code>.</p><p>前置约束的内容写在括号中的等号后面。</p><p>例如，表达式<code>[T|t]he(?=\sfat)</code>匹配<code>The</code>和<code>the</code>，在括号中我们又定义了前置约束（存在）<code>(?=\sfat)</code>，即<code>The</code>和<code>the</code>后面紧跟着<code>(空格)fat</code>。</p><blockquote><p>“[T|t]he(?=\sfat)” =&gt; <strong>The</strong> fat cat sat on the mat.</p></blockquote><h3 id="前置约束-排除"><a href="#前置约束-排除" class="headerlink" title="?!... 前置约束-排除"></a><code>?!...</code> 前置约束-排除</h3><p>前置约束-排除<code>?!</code>用于筛选所有匹配结果，筛选条件为其后不跟随着定义的格式。</p><p><code>前置约束-排除</code>的定义和<code>前置约束(存在)</code>一样, 区别就是<code>=</code>替换成<code>!</code>也就是<code>(?!...)</code>。</p><p>表达式<code>[T|t]he(?!\sfat)</code>匹配<code>The</code>和<code>the</code>，且其后不跟着 <code>(空格)fat</code>。</p><blockquote><p>“[T|t]he(?!\sfat)” =&gt; The fat cat sat on <strong>the</strong> mat.</p></blockquote><h3 id="lt-后置约束-存在"><a href="#lt-后置约束-存在" class="headerlink" title="?&lt;= ... 后置约束-存在"></a><code>?&lt;= ...</code> 后置约束-存在</h3><p>后置约束-存在记作<code>(?&lt;=...)</code>，用于筛选所有匹配结果，筛选条件为 其前跟随着定义的格式。</p><p>例如，表达式<code>(?&lt;=[T|t]he\s)(fat|mat)</code>匹配<code>fat</code>和<code>mat</code>，且其前跟着<code>The</code>或<code>the</code>。</p><blockquote><p>“(?&lt;=[T|t]he\s)(fat|mat)” =&gt; The <strong>fat</strong> cat sat on the <strong>mat</strong>.</p></blockquote><h3 id="lt-后置约束-排除"><a href="#lt-后置约束-排除" class="headerlink" title="?&lt;!... 后置约束-排除"></a><code>?&lt;!...</code> 后置约束-排除</h3><p>后置约束-排除记作<code>(?&lt;!...)</code>，用于筛选所有匹配结果，筛选条件为其前不跟着定义的格式。</p><p>例如，表达式<code>(?&lt;!(T|t)he\s)(cat)</code>匹配<code>cat</code>，且其前不跟着<code>The</code>或<code>the</code>。</p><blockquote><p>“(?&lt;![T|t]he\s)(cat)” =&gt; The cat sat on <strong>cat</strong>.</p></blockquote><h2 id="标志"><a href="#标志" class="headerlink" title="标志"></a>标志</h2><p>标志也叫修饰语，因为它可以用来修改表达式的搜索结果。这些标志可以任意的组合使用，它也是整个正则表达式的一部分。</p><table><thead><tr><th align="center">标志</th><th align="center">描述</th></tr></thead><tbody><tr><td align="center">i</td><td align="center">忽略大小写</td></tr><tr><td align="center">g</td><td align="center">全局搜索</td></tr><tr><td align="center">m</td><td align="center">多行的: 锚点元字符 <code>^</code> <code>$</code> 工作范围在每行的起始</td></tr></tbody></table><h3 id="忽略大小写（Case-Insensitive）"><a href="#忽略大小写（Case-Insensitive）" class="headerlink" title="忽略大小写（Case Insensitive）"></a>忽略大小写（Case Insensitive）</h3><p>修饰语<code>i</code>用于忽略大小写。</p><p>例如，表达式<code>/The/gi</code>表示在全局搜索<code>The</code>，在后面的<code>i</code>将其条件修改为忽略大小写，则变成搜索<code>the</code>和 <code>The</code>，<code>g</code>表示全局搜索。</p><blockquote><p>“The” =&gt; <strong>The</strong> fat cat sat on the mat.</p><p>“/The/gi” =&gt; <strong>The</strong> fat cat sat on <strong>the</strong> mat.</p></blockquote><h3 id="全局搜索（Global-search）"><a href="#全局搜索（Global-search）" class="headerlink" title="全局搜索（Global search）"></a>全局搜索（Global search）</h3><p>修饰符<code>g</code>常用于执行一个全局搜索匹配，即（不仅仅返回第一个匹配的，而是返回全部）。</p><p>例如，表达式<code>/.(at)/g</code>表示搜索任意字符（除了换行）+<code>at</code>，并返回全部结果。</p><blockquote><p>“/.(at)/“ =&gt; The <strong>fat</strong> cat sat on the mat.</p><p>“/.(at)/g” =&gt; The <strong>fat cat sat</strong> ont the <strong>mat</strong>.</p></blockquote><h3 id="多行修饰符（Multiline）"><a href="#多行修饰符（Multiline）" class="headerlink" title="多行修饰符（Multiline）"></a>多行修饰符（Multiline）</h3><p>多行修饰符<code>m</code>常用于执行一个多行匹配.</p><p>像之前介绍的<code>(^,$)</code>用于检查格式是否是在待检测字符串的开头或结尾，但我们如果想要它在每行的开头和结尾生效，我们需要用到多行修饰符<code>m</code>。</p><p>例如，表达式<code>/at(.)?$/gm</code>表示在待检测字符串每行的末尾搜索<code>at</code>后跟一个或多个<code>.</code>的字符串，并返回全部结果。</p><p>　　</p><blockquote><p>“/.at(.)?$/“ =&gt; The fat cat sat on the <strong>mat.</strong></p></blockquote><blockquote><p>“/.at(.)?$/gm” =&gt; The fat cat <strong>sat</strong> on the <strong>mat.</strong></p></blockquote><h2 id="额外补充"><a href="#额外补充" class="headerlink" title="额外补充"></a>额外补充</h2><ul><li>正整数：<code>^\d+$</code></li><li>负整数：<code>^-\d+$</code></li><li>手机国家号：<code>^+?[\d\s]&#123;3,&#125;$</code></li><li>手机号：<code>^+?[\d\s]+(?[\d\s]&#123;10,&#125;$</code></li><li>整数：<code>^-?\d+$</code></li><li>用户名：<code>^[\w\d_.]&#123;4,16&#125;$</code></li><li>数字和英文字母：<code>^[a-zA-Z0-9]*$</code></li><li>数字和应为字母和空格：<code>^[a-zA-Z0-9 ]*$</code></li><li>密码：<code>^(?=^.&#123;6,&#125;$)((?=.*[A-Za-z0-9])(?=.*[A-Z])(?=.*[a-z]))^.*$</code></li><li>邮箱：<code>^([a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]&#123;2,4&#125;)*$</code></li><li>IP4 地址：<code>^((?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))*$</code></li><li>纯小写字母：<code>^([a-z])*$</code></li><li>纯大写字母：<code>^([A-Z])*$</code></li><li>URL：<code>^(((http|https|ftp):\/\/)?([[a-zA-Z0-9]\-\.])+(\.)([[a-zA-Z0-9]])&#123;2,4&#125;([[a-zA-Z0-9]\/+=%&amp;_\.~?\-]*))*$</code></li><li>VISA 信用卡号：<code>^(4[0-9]&#123;12&#125;(?:[0-9]&#123;3&#125;)?)*$</code></li><li>日期 (MM/DD/YYYY)：<code>^(0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](19|20)?[0-9]&#123;2&#125;$</code></li><li>日期 (YYYY/MM/DD)：<code>^(19|20)?[0-9]&#123;2&#125;[- /.](0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])$</code></li><li>MasterCard 信用卡号：<code>^(5[1-5][0-9]&#123;14&#125;)*$</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 正则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IDEA注释模板</title>
      <link href="/2021/12/02/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/01.IDEA%E6%B3%A8%E9%87%8A%E6%A8%A1%E6%9D%BF/"/>
      <url>/2021/12/02/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/01.IDEA%E6%B3%A8%E9%87%8A%E6%A8%A1%E6%9D%BF/</url>
      
        <content type="html"><![CDATA[<h1 id="类注释"><a href="#类注释" class="headerlink" title="类注释"></a>类注释</h1><p>打开<code>IDEA</code>的<code>Settings</code>，点击<code>Editor--&gt;File and Code Templates</code>，点击右边<code>File</code>选项卡下面的<code>Class</code>，在其中添加图中红框内的内容：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#<span class="keyword">if</span> ($&#123;PACKAGE_NAME&#125; &amp;&amp; $&#123;PACKAGE_NAME&#125; != <span class="string">&quot;&quot;</span>)<span class="keyword">package</span> $&#123;PACKAGE_NAME&#125;;#end</span><br><span class="line">#parse(<span class="string">&quot;File Header.java&quot;</span>)</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> echo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;YEAR&#125;年 $&#123;MONTH&#125;月 $&#123;DAY&#125;日 $&#123;TIME&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">$</span>&#123;NAME&#125; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447118-cca895f6.png"></p></center><p>在我提供的示例模板中，说明了作者和时间，<code>IDEA</code>支持的所有的模板参数在下方的<code>Description</code>中被列出来。</p><p>保存后，当你创建一个新的类的时候就会自动添加类注释。如果你想对接口也生效，同时配置上图中的<code>Interface</code>项即可。</p><h1 id="方法注释"><a href="#方法注释" class="headerlink" title="方法注释"></a>方法注释</h1><p>不同于目前网络上互相复制粘贴的方法注释教程，本文将实现以下功能：</p><ul><li><p>根据形参数目自动生成<code>@param</code>注解</p></li><li><p>根据方法是否有返回值智能生成<code>@Return</code>注解</p></li></ul><p>相较于类模板，为方法添加注释模板就较为复杂，首先在 <code>Settings</code>中点击<code>Editor--&gt;Live Templates</code>。</p><p>点击最右边的<code>+</code>，首先选择<code>2. Template Group...</code>来创建一个模板分组：</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447268-7e879ed1.png"></p></center><p>在弹出的对话框中填写分组名，我这里叫做<code>userDefine</code>：</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447293-826a9a69.png"></p></center><p>然后选中刚刚创建的模板分组<code>userDefine</code>，然后点击<code>+</code>，选择<code>1. Live Template</code>：</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447312-09f1391e.png"></p></center><p>此时就会创建了一个空的模板，我们修改该模板的<code>Abbreviation、Description</code>和<code>Template text</code>。需要注意的是，<code>Abbreviation</code>必须为<code>*</code>，最后检查下<code>Expand with</code>的值是否为<code>Enter</code>键。</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447330-b80388cc.png"></p></center><p>上图中· <code>Template text</code>内容如下，需要注意首行没有 <code>/</code>，且<code>*</code>是顶格的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line"> *</span><br><span class="line"> * <span class="meta">@author</span> echo</span><br><span class="line"> * <span class="meta">@date</span> $date$ $time$$param$ $<span class="keyword">return</span>$</span><br><span class="line"> */</span><br></pre></td></tr></table></figure><p>注意到右下角的<code>No applicable contexts yet</code>了吗，这说明此时这个模板还没有指定应用的语言。</p><p>点击<code>Define</code>，在弹框中勾选<code>Java</code>，表示将该模板应用于所有的<code>Java</code>类型文件。</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447344-023bef64.png"></p></center><h2 id="设置applicable-contexts"><a href="#设置applicable-contexts" class="headerlink" title="设置applicable contexts"></a>设置<code>applicable contexts</code></h2><p>还记得我们配置<code>Template text</code>时里面包含了类似于<code>$date$</code>这样的参数，此时<code>IDEA</code>还不认识这些参数是啥玩意，下面我们对这些参数进行方法映射，让<code>IDEA</code>能够明白这些参数的含义。</p><p>点击<code>Edit variables</code>按钮：</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447361-36bb9d1a.png"></p></center><p>为每一个参数设置相对应的<code>Expression</code>：</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/1638440757/1639447378-41b78fa9.png"></p></center><h2 id="设置Expression"><a href="#设置Expression" class="headerlink" title="设置Expression"></a>设置<code>Expression</code></h2><p>需要注意的是，<code>date</code>和<code>time</code>的<code>Expression</code>使用的是<code>IDEA</code>内置的函数，直接使用下拉框选择就可以了，而<code>param</code>这个参数<code>IDEA</code>默认的实现很差，因此我们需要手动实现，代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;def result = &#x27;&#x27;;def params = \&quot;$&#123;_1&#125;\&quot;.replaceAll(&#x27;[\\\\[|\\\\]|\\\\s]&#x27;, &#x27;&#x27;).split(&#x27;,&#x27;).toList(); for(i = 0; i &lt; params.size(); i++) &#123;if(params[i] != &#x27;&#x27;)result+=&#x27;* @param &#x27; + params[i] + ((i &lt; params.size() - 1) ? &#x27;\\r\\n &#x27; : &#x27;&#x27;)&#125;; return result == &#x27;&#x27; ? null : &#x27;\\r\\n &#x27; + result&quot;, methodParameters())</span><br></pre></td></tr></table></figure><p>另外<code>return</code>这个参数也要实现了下，代码如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groovyScript(&quot;return \&quot;$&#123;_1&#125;\&quot; == &#x27;void&#x27; ? null : &#x27;\\r\\n * @return &#x27; + \&quot;$&#123;_1&#125;\&quot;&quot;, methodReturnType())</span><br></pre></td></tr></table></figure><blockquote><p>注：你还注意到我并没有勾选<code>Skip if defined</code>属性，它的意思是如果在生成注释时候如果这一项被定义了，那么鼠标光标就会直接跳过它。我并不需要这个功能，因此有被勾选该属性。</p></blockquote><p>点击<code>OK</code>保存设置，大功告成！</p><h1 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q &amp; A"></a>Q &amp; A</h1><ol><li><p>为什么模板的<code>Abbreviation</code>一定要叫<code>*</code>？<code>Expand with</code>要保证是<code>Enter</code>键？</p><blockquote><p>答：因为<code>IDEA</code>模板的生成逻辑是<code>模板名 + 生成键</code>，当生成键是<code>Enter</code>时，我们输入<code>* + Enter</code>就能够触发模板。<br> 这也同时说明了为什么注释模板首行是一个<code>*</code>了，因为当我们先输入<code>/*</code>，然后输入<code>* + Enter</code>，触发模板，首行正好拼成了<code>/**</code>，符合<code>Javadoc</code>的规范。</p></blockquote></li><li><p>注释模板中为什么有一行空的<code>*</code>？</p><blockquote><p>答：因为我习惯在这一行写方法说明，所以就预留了一行空的写，你也可以把它删掉。</p></blockquote></li><li><p>注释模板中<code>$time$$param$</code> `这两个明明不相干的东西为什么紧贴在一起？</p><blockquote><p>答：首先网上提供的大部分<code>param</code>生成函数在无参情况下仍然会生成一行空的<code>@param</code>，因此我对<code>param</code>函数的代码进行修改，使得在无参情况下不生成<code>@param</code>，但是这就要求<code>$param$</code>要和别人处在同一行中，不然没法处理退格。</p></blockquote></li><li><p>为什么<code>return</code>参数不使用<code>methodReturnType()</code>， 而要自己实现？</p><blockquote><p>答：<code>methodReturnType()</code>在无返回值的情况下会返回<code>void</code>，这并没有什么意义，因此我对<code>methodReturnType()</code>返回值进行了处理，仅在有返回值时才生成。</p></blockquote></li><li><p>为什么<code>$return$</code> `不是单独一行？</p><blockquote><p>答：因为当<code>methodReturnType()</code>返回<code>null</code>时，无法处理退格问题，原因同第三点。</p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> 开发工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IDEA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2021/12/01/%E9%9A%8F%E7%AC%94/01.Hello%20World/"/>
      <url>/2021/12/01/%E9%9A%8F%E7%AC%94/01.Hello%20World/</url>
      
        <content type="html"><![CDATA[<blockquote><h1 id="你好"><a href="#你好" class="headerlink" title="你好"></a>你好</h1></blockquote><p>欢迎来到我的博客，今天，2021年12月1日，是我的博客的出生日。</p><p>这篇文章是用来测试的，因为博客刚跟建立，所以可能会有一些小问题，还请多多包涵。如果遇到问题，可以在评论区给我留言。</p><p>如果您也有博客，欢迎前往<a href="/link/">友链</a>，在评论区中留言与我互换友链信息。</p><center><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets//blog/static/helloworld.jpg"></p></center><blockquote><h1 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World!"></a>Hello World!</h1></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> main&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello, World&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>数据卷、Dockerfile 与 Docker 网络</title>
      <link href="/2021/11/01/docker/02.%E6%95%B0%E6%8D%AE%E5%8D%B7%E3%80%81Dockerfile%E4%B8%8EDocker%E7%BD%91%E7%BB%9C/"/>
      <url>/2021/11/01/docker/02.%E6%95%B0%E6%8D%AE%E5%8D%B7%E3%80%81Dockerfile%E4%B8%8EDocker%E7%BD%91%E7%BB%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="数据卷"><a href="#数据卷" class="headerlink" title="数据卷"></a>数据卷</h1><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><code>Docker</code>将运行的环境打包成容器运行。<code>Docker</code>容器运行中产生的数据，如果不通过<code>docker commit</code>命令生成新的镜像，使数据做为镜像的一部分保存下来，当删除容器后，数据也会被删除。</p><p>为了实现数据持久化，使容器之间可以共享数据。可以使用卷来保存在<code>Docker</code>容器产生的数据，将容器内的目录，挂载到宿主机上或其他容器内，实现同步和共享的操作。即使将容器删除，挂载到本地的数据卷也不会丢失。</p><p>卷就是目录或文件，存在于一个或多个容器中，由<code>Docker</code>挂载到容器，但卷不属于联合文件系统（<code>Union FileSystem</code>），因此能够绕过联合文件系统提供一些用于持续存储或共享数据的特性:。</p><p>卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此<code>Docker</code>不会在容器删除时删除其挂载的数据卷。</p><p>数据卷的特点:</p><ol><li>数据卷可在容器之间共享或重用数据</li><li>卷中的更改可以直接生效</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ol><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>运行容器，指定挂载数据卷：<code>docker run -it -v 主机目录:容器目录</code></p><ol><li>将主机目录<code>/home/test</code>和容器<code>/home</code>建立数据卷 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># pwd</span></span><br><span class="line">/home</span><br><span class="line">[root@localhost home]<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line">[root@localhost home]<span class="comment"># docker run -it -v /home/test:/home centos /bin/bash</span></span><br></pre></td></tr></table></figure></li><li>在容器目录下创建<code>test.java</code>文件，再去主机目录下查看是否有该文件 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@f5c27ef005ad /]<span class="comment"># cd /home</span></span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># ls</span></span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># touch test.java</span></span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># cat test.java</span></span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># ls</span></span><br><span class="line">test.java</span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># touch test.java[root@localhost home]#</span></span><br><span class="line">[root@localhost home]<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">echo</span>  <span class="built_in">test</span></span><br><span class="line">[root@localhost home]<span class="comment"># cd test/</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">test.java</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># vi test.java</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat test.java</span></span><br><span class="line">Hello</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND        CREATED         STATUS         PORTS                                       NAMES</span><br><span class="line">f5c27ef005ad   centos                <span class="string">&quot;/bin/bash&quot;</span>    2 minutes ago   Up 2 minutes                                               objective_bhaskara</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># docker exec -it f5c27ef005ad /bin/bash</span></span><br><span class="line">[root@f5c27ef005ad /]<span class="comment"># cd /home</span></span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># ls</span></span><br><span class="line">test.java</span><br><span class="line">[root@f5c27ef005ad home]<span class="comment"># cat test.java</span></span><br><span class="line">Hello</span><br><span class="line">[root@f5c27ef005ad home]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><code>docker inspect 容器id</code>查看容器对应元数据，在<code>Mounts</code>节点可以查看建立的数据卷信息 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;bind&quot;</span>,</span><br><span class="line">        <span class="comment"># 主机文件夹地址</span></span><br><span class="line">        <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/home/test&quot;</span>,</span><br><span class="line">        <span class="comment"># 容器文件夹地址</span></span><br><span class="line">        <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;rprivate&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure></li></ol><p>即使容器停止运行或者容器删除，仍然可以实现数据同步，本地的数据卷不会丢失</p><h2 id="MySQL-容器建立数据卷同步数据"><a href="#MySQL-容器建立数据卷同步数据" class="headerlink" title="MySQL 容器建立数据卷同步数据"></a>MySQL 容器建立数据卷同步数据</h2><p>在<code>Linux</code>下的<code>MySQL</code>默认的数据文档存储目录为<code>/var/lib/mysql</code>，默认的配置文件的位置<code>/etc/mysql/conf.d</code>，为了确保<code>MySQL</code>镜像或容器删除后数据不丢失，建立数据卷保存<code>MySQL</code>的数据和文件。</p><ol><li>建立数据卷 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mytomcat              1.0       97a599676bbb   42 hours ago   684MB</span><br><span class="line">tomcat                latest    b0e0b0a92cf9   10 days ago    680MB</span><br><span class="line">mysql                 5.7       938b57d64674   13 days ago    448MB</span><br><span class="line">nginx                 latest    87a94228f133   2 weeks ago    133MB</span><br><span class="line">hello-world           latest    feb5d9fea6a5   5 weeks ago    13.3kB</span><br><span class="line">centos                latest    5d0da3dc9764   6 weeks ago    231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   7 months ago   79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   3 years ago    486MB</span><br><span class="line">abh1nav/dockerui      latest    6e4d05915b2a   6 years ago    470MB</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># docker run -d -p 6603:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span></span><br><span class="line">bd86b67cb648743b1871c70da061de1c43b99b0983994c4e6ffc9d7d07948619</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>查看数据 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd /home</span></span><br><span class="line">[root@localhost home]<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">echo</span>  mysql  <span class="built_in">test</span></span><br><span class="line">[root@localhost home]<span class="comment"># cd mysql/conf/</span></span><br><span class="line">[root@localhost conf]<span class="comment"># ls</span></span><br><span class="line">[root@localhost conf]<span class="comment"># cd /home/mysql/data/</span></span><br><span class="line">[root@localhost data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</span><br><span class="line">ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem</span><br></pre></td></tr></table></figure></li><li>向<code>MySQL</code>插入数据后再次查看数据 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># ls</span></span><br><span class="line">auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</span><br><span class="line">ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem   <span class="built_in">test</span></span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="创建数据卷"><a href="#创建数据卷" class="headerlink" title="创建数据卷"></a>创建数据卷</h3><p><code>docker volume create</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker volume create my-vol</span></span><br><span class="line">my-vol</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="查看所有的数据卷"><a href="#查看所有的数据卷" class="headerlink" title="查看所有的数据卷"></a>查看所有的数据卷</h3><p><code>docker volume ls</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span><br><span class="line"><span class="built_in">local</span>     b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span><br><span class="line"><span class="built_in">local</span>     c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line"><span class="built_in">local</span>     my-vol</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="查看指定数据卷的信息"><a href="#查看指定数据卷的信息" class="headerlink" title="查看指定数据卷的信息"></a>查看指定数据卷的信息</h3><p><code>docker volume inspect</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker volume inspect my-vol</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-11-01T11:02:30+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/my-vol/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;my-vol&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost data]<span class="comment"># docker volume inspect 2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-10-30T16:05:34+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost data]<span class="comment"># docker volume inspect b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-10-29T17:15:12+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="删除数据卷"><a href="#删除数据卷" class="headerlink" title="删除数据卷"></a>删除数据卷</h3><p><code>docker volume rm</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker volume rm my-vol</span></span><br><span class="line">my-vol</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="删除容器时删除相关的卷"><a href="#删除容器时删除相关的卷" class="headerlink" title="删除容器时删除相关的卷"></a>删除容器时删除相关的卷</h3><p>数据卷是被设计用来持久化数据的，它的生命周期独立于容器，<code>Docker</code>不会在容器被删除后自动删除数据卷，并且也不存在垃圾回收这样的机制来处理没有任何容器引用的数据卷。</p><p>如果需要在删除容器的同时移除数据卷，可以在删除容器的时候使用<code>docker rm -v</code>这个命令。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker rm -v --help</span></span><br><span class="line">Usage:  docker <span class="built_in">rm</span> [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line">Remove one or more containers</span><br><span class="line">Options:</span><br><span class="line">  -f, --force     Force the removal of a running container (uses SIGKILL)</span><br><span class="line">  -l, --<span class="built_in">link</span>      Remove the specified <span class="built_in">link</span></span><br><span class="line">  -v, --volumes   Remove anonymous volumes associated with the container</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>无主的数据卷可能会占据很多空间，要清理使用命令<code>docker volume prune</code>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost data]<span class="comment"># docker volume prune</span></span><br><span class="line">WARNING! This will remove all <span class="built_in">local</span> volumes not used by at least one container.</span><br><span class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N] y</span><br><span class="line">Total reclaimed space: 0B</span><br><span class="line">[root@localhost data]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h2><h3 id="匿名挂载"><a href="#匿名挂载" class="headerlink" title="匿名挂载"></a>匿名挂载</h3><p>匿名挂载就是在指定数据卷的时候，不指定容器路径对应的主机路径，这样对应映射的主机路径就是默认的路径<code>/var/lib/docker/volumes/</code>中自动生成一个随机命名的文件夹。</p><ol><li>运行并匿名挂载<code>Nginx</code>容器 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker run -d -P --name nginx01 -v /etc/nginx nginx</span></span><br><span class="line">a0b0ab7220cb20a79f49002ee57edfd991b748c23e28a71ba776b7a389876583</span><br><span class="line">[root@localhost home]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>使用<code>docker inspect</code>查看<code>Mounts</code>中显示的挂载信息 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost volumes]<span class="comment"># docker inspect a0b0ab7220cb20a79f49002ee57edfd991b748c23e28a71ba776b7a389876583</span></span><br><span class="line"><span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;/etc/nginx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">],</span><br></pre></td></tr></table></figure></li><li>查看所有的数据卷<code>volume</code>的情况，每个<code>VOLUME NAME</code>对应一个挂载的卷，由于挂载时未指定主机目录，因此无法直接找到目录 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span><br><span class="line"><span class="built_in">local</span>     683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6</span><br><span class="line"><span class="built_in">local</span>     b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span><br><span class="line"><span class="built_in">local</span>     c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line">[root@localhost home]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>查看路径<code>/var/lib/docker/volumes/</code>中的文件夹 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># cd /var/lib/docker/volumes/</span></span><br><span class="line">[root@localhost volumes]<span class="comment"># ls</span></span><br><span class="line">2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4  backingFsBlockDev</span><br><span class="line">683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6  c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line">b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c  metadata.db</span><br><span class="line">[root@localhost volumes]<span class="comment"># ll</span></span><br><span class="line">总用量 24</span><br><span class="line">drwx-----x. 3 root root     19 10月 30 16:05 2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span><br><span class="line">drwx-----x. 3 root root     19 11月  1 11:34 683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6</span><br><span class="line">drwx-----x. 3 root root     19 10月 29 17:15 b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span><br><span class="line">brw-------. 1 root root 253, 0 11月  1 10:03 backingFsBlockDev</span><br><span class="line">drwx-----x. 3 root root     19 10月 30 15:35 c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line">-rw-------. 1 root root  32768 11月  1 11:34 metadata.db</span><br><span class="line">[root@localhost volumes]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="具名挂载"><a href="#具名挂载" class="headerlink" title="具名挂载"></a>具名挂载</h3><p>具名挂载，就是指定文件夹名称，区别于指定路径挂载，这里的指定文件夹名称是在<code>Docker</code>指定的默认数据卷路径下的。</p><ol><li>通过<code>docker volume ls</code>命令查看当前数据卷的目录情况 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span></span><br><span class="line">0a2a21f561c2b3db9442bef96508413a06a6bd59a1e315226eaff6128fc66b02</span><br><span class="line">[root@localhost ~]<span class="comment"># docker volume ls</span></span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line"><span class="built_in">local</span>     2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span><br><span class="line"><span class="built_in">local</span>     683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6</span><br><span class="line"><span class="built_in">local</span>     b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span><br><span class="line"><span class="built_in">local</span>     c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line"><span class="built_in">local</span>     juming-nginx</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>查看指定的数据卷信息，命令：<code>docker volume inspect 数据卷名称</code>，可以看到主机数据卷挂载在<code>/var/lib/docker/volumes/juming-nginx/_data</code>上 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker volume inspect juming-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-11-01T15:35:29+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming-nginx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><p><code>Docker</code>所有的数据卷默认在<code>/var/lib/docker/volumes/</code>目录下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /var/lib/docker/volumes/</span></span><br><span class="line">[root@localhost volumes]<span class="comment"># ll</span></span><br><span class="line">总用量 24</span><br><span class="line">drwx-----x. 3 root root     19 10月 30 16:05 2384cfb039b29ff058617012a6883694dabf5e1047aa5b4588b05d4403a75ec4</span><br><span class="line">drwx-----x. 3 root root     19 11月  1 11:34 683898996d0153b4335e3b6c1e72451f0923155b39360facd5641ac9d31665a6</span><br><span class="line">drwx-----x. 3 root root     19 10月 29 17:15 b4309f0bc3eda0a6b8d4837a0d56c5ea3ef2d016ec4294db720b04591245489c</span><br><span class="line">brw-------. 1 root root 253, 0 11月  1 15:30 backingFsBlockDev</span><br><span class="line">drwx-----x. 3 root root     19 10月 30 15:35 c505a4ba768a4f507cc80216c13902724aec7388d6a35af6aa24e6f4fc81d68f</span><br><span class="line">drwx-----x. 3 root root     19 11月  1 15:35 juming-nginx</span><br><span class="line">-rw-------. 1 root root  32768 11月  1 15:35 metadata.db</span><br><span class="line">[root@localhost volumes]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>所有<code>Docker</code>容器内的卷，在未指定主机内目录时，都在<code>/var/lib/docker/volumes/卷名/_data</code>下，可通过具名挂载可以方便的找到卷，因此广泛使用这种方式进行挂载。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost volumes]<span class="comment"># docker volume inspect juming-nginx</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;CreatedAt&quot;</span>: <span class="string">&quot;2021-11-01T15:35:29+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Mountpoint&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/juming-nginx/_data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;juming-nginx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost volumes]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>匿名挂载，具名挂载，指定路径挂载的命令区别如下：</p><ul><li><code>-v 容器内路径</code>：匿名挂载</li><li><code>-v 卷名:容器内路径</code>：具名挂载</li><li><code>-v /宿主机路径:容器内路径</code>：指定路径挂载</li></ul><h3 id="数据卷映射相关参数"><a href="#数据卷映射相关参数" class="headerlink" title="数据卷映射相关参数"></a>数据卷映射相关参数</h3><p>指定数据卷映射的相关参数：</p><ul><li><p><code>ro</code>：<code>readonly</code>，只读，设置了只读则只能操作宿主机的路径，不能操作容器中的对应路径。</p></li><li><p><code>rw</code>：<code>readwrite</code>，可读可写</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost volumes]<span class="comment"># docker run -d -P --name nginx03 -v juming-nginx:/etc/nginx:ro nginx</span></span><br><span class="line">1c246890508f95987d5f9154e51f7a4992479829f2cd5621ddf4aa6e8b995f97</span><br><span class="line">[root@localhost volumes]<span class="comment"># docker exec -it nginx03 /bin/bash</span></span><br><span class="line">root@1c246890508f:/<span class="comment"># cd /etc/nginx/</span></span><br><span class="line">root@1c246890508f:/etc/nginx<span class="comment"># ls</span></span><br><span class="line">conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br><span class="line">root@1c246890508f:/etc/nginx<span class="comment"># touch test.txt</span></span><br><span class="line"><span class="built_in">touch</span>: cannot <span class="built_in">touch</span> <span class="string">&#x27;test.txt&#x27;</span>: Read-only file system</span><br><span class="line">root@1c246890508f:/etc/nginx<span class="comment"># </span></span><br><span class="line">[root@localhost volumes]<span class="comment">#</span></span><br><span class="line">[root@localhost volumes]<span class="comment"># docker run -d -P --name nginx04 -v juming-nginx:/etc/nginx:rw nginx</span></span><br><span class="line">1d39e0ad7fe5c7b5de1edf5d23b0269f59e15e7f25e76f058eaa9ac27461229b</span><br><span class="line">[root@localhost volumes]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="初识-Dockerfile"><a href="#初识-Dockerfile" class="headerlink" title="初识 Dockerfile"></a>初识 Dockerfile</h2><p>可以在<code>Dockerfile</code>中使用<code>VOLUME</code>指令来给镜像添加一个或多个数据卷。</p><p>下面使用<code>Dockerfile</code>构建一个新的镜像，<code>dockerfile01</code>文件的内容，匿名挂载了<code>volume01</code>和<code>volume02</code>两个目录：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos</span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="string">&quot;----end----&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure><ol><li>创建<code>Dockerfile</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost volumes]<span class="comment"># cd /home/</span></span><br><span class="line">[root@localhost home]<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">echo</span>  mysql  <span class="built_in">test</span></span><br><span class="line">[root@localhost home]<span class="comment"># mkdir docker-test-volume</span></span><br><span class="line">[root@localhost home]<span class="comment"># cd docker-test-volume/</span></span><br><span class="line">[root@localhost docker-test-volume]<span class="comment"># vi Dockerfile01</span></span><br><span class="line">[root@localhost docker-test-volume]<span class="comment"># cat Dockerfile01</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;----end----&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">[root@localhost docker-test-volume]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>构建镜像 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker build -f /home/docker-test-volume/Dockerfile01 -t mycentso:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"> ---&gt; 5d0da3dc9764</span><br><span class="line">Step 2/4 : VOLUME [<span class="string">&quot;volume01&quot;</span>,<span class="string">&quot;volume02&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> c8a9fd0dc844</span><br><span class="line">Removing intermediate container c8a9fd0dc844</span><br><span class="line"> ---&gt; 6cead4388a3b</span><br><span class="line">Step 3/4 : CMD <span class="built_in">echo</span> <span class="string">&quot;----end----&quot;</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> ebef18c40e02</span><br><span class="line">Removing intermediate container ebef18c40e02</span><br><span class="line"> ---&gt; 3e993838049c</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> adfd9b894c7d</span><br><span class="line">Removing intermediate container adfd9b894c7d</span><br><span class="line"> ---&gt; 992cbdac9cbb</span><br><span class="line">Successfully built 992cbdac9cbb</span><br><span class="line">Successfully tagged mycentso:1.0</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">mycentso              1.0       992cbdac9cbb   33 seconds ago   231MB</span><br><span class="line">mytomcat              1.0       97a599676bbb   2 days ago       684MB</span><br><span class="line">tomcat                latest    b0e0b0a92cf9   10 days ago      680MB</span><br><span class="line">mysql                 5.7       938b57d64674   13 days ago      448MB</span><br><span class="line">nginx                 latest    87a94228f133   2 weeks ago      133MB</span><br><span class="line">hello-world           latest    feb5d9fea6a5   5 weeks ago      13.3kB</span><br><span class="line">centos                latest    5d0da3dc9764   6 weeks ago      231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   7 months ago     79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   3 years ago      486MB</span><br><span class="line">abh1nav/dockerui      latest    6e4d05915b2a   6 years ago      470MB</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>运行生成的镜像，可以看到自动挂载的数据卷目录 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker run -it 992cbdac9cbb /bin/bash</span></span><br><span class="line">[root@80583205c391 /]<span class="comment"># ls -l</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root 360 Nov  1 09:29 dev</span><br><span class="line">drwxr-xr-x.   1 root root  66 Nov  1 09:29 etc</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x. 172 root root   0 Nov  1 09:29 proc</span><br><span class="line">dr-xr-x---.   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x.  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx.   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x.  13 root root   0 Nov  1 07:28 sys</span><br><span class="line">drwxrwxrwt.   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x.  20 root root 262 Sep 15 14:17 var</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  1 09:29 volume01</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  1 09:29 volume02</span><br><span class="line">[root@80583205c391 /]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>查看对应宿主机的数据卷目录，可以看到<code>Mounts</code>下有宿主机的挂载目录。因为<code>Dockerfile</code>中没有指定宿主机目录，所以属于匿名挂载，在<code>/var/lib/docker/volumes/</code>目录下生成了随机命名的路径。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">1db2a2a317a3   992cbdac9cbb   <span class="string">&quot;/bin/bash&quot;</span>   6 seconds ago   Up 5 seconds             eloquent_chatterjee</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker inspect 1db2a2a317a3</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-11-01T09:32:02.94570866Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 3235,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2021-11-01T09:32:03.131012761Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:992cbdac9cbbec0e30eeae73e43c0aff94d6512dc0adb87e73a3c6cbcb1fca76&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a/1db2a2a317a3871d4f3fcb102ea9322188e727c4aa7a48b5b4d25aea0a908f9a-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/eloquent_chatterjee&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CgroupnsMode&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: 67108864,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/24da8b17e1760fe7543bab2fb2d7f89e3b39ff94cefc040f2b85c829162df215-init/diff:/var/lib/docker/overlay2/0ab1d01f204652c7e92e556e2dd1f08093d99ee5ba7a2ee15aeb70324e819ac0/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/24da8b17e1760fe7543bab2fb2d7f89e3b39ff94cefc040f2b85c829162df215/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/24da8b17e1760fe7543bab2fb2d7f89e3b39ff94cefc040f2b85c829162df215/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/24da8b17e1760fe7543bab2fb2d7f89e3b39ff94cefc040f2b85c829162df215/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;c73887234089554752e66d136b59e2d74e18978bcebf35b2f5b3e7e11f8d0ca2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/c73887234089554752e66d136b59e2d74e18978bcebf35b2f5b3e7e11f8d0ca2/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;volume01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;volume&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;924bf9661264ca16f1ad7b6ac1e1ba9a68f823c81510d723af1e6d4222f25d43&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Source&quot;</span>: <span class="string">&quot;/var/lib/docker/volumes/924bf9661264ca16f1ad7b6ac1e1ba9a68f823c81510d723af1e6d4222f25d43/_data&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Destination&quot;</span>: <span class="string">&quot;volume02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Mode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;RW&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">&quot;Propagation&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;1db2a2a317a3&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/bash&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;992cbdac9cbb&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;volume01&quot;</span>: &#123;&#125;,</span><br><span class="line">                <span class="string">&quot;volume02&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;org.label-schema.build-date&quot;</span>: <span class="string">&quot;20210915&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.license&quot;</span>: <span class="string">&quot;GPLv2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.name&quot;</span>: <span class="string">&quot;CentOS Base Image&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.schema-version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.vendor&quot;</span>: <span class="string">&quot;CentOS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;a054eb9aafa23501d4a25121b3da1eb24b6469a07b0366e597a6bf87eb5f105a&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/a054eb9aafa2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;a3906afead5332f63df3e73509fe25b46beae553b0825cae2979566889788ec0&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;d16f04d8a8481cbd0d8a2112d724deb20e3e776be05b0ee1a669092695b148d1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;a3906afead5332f63df3e73509fe25b46beae553b0825cae2979566889788ec0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><p>　　</p><h2 id="数据卷容器"><a href="#数据卷容器" class="headerlink" title="数据卷容器"></a>数据卷容器</h2><p><code>docker run -it --name container02 --volumes-from container01 镜像名/id</code></p><p>容器数据卷是指建立数据卷，来同步多个容器间的数据，实现容器间的数据同步。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639727991-e90c6ed5.png"></p></div><ol><li>首先启动容器 $1$，<code>volume01</code>、<code>volume02</code>为挂载目录 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker run -it --name cnetos01 mycentso:1.0</span></span><br><span class="line">[root@b283552e8336 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var  volume01  volume02</span><br><span class="line">[root@b283552e8336 /]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>然后启动容器 $2$，通过参数<code>--volumes-from</code>，设置容器 $2$ 和容器 $1$ 建立数据卷挂载关系 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker run -it --name centos02 --volumes-from cnetos01 mycentso:1.0</span></span><br><span class="line">[root@50d228c45e1f /]<span class="comment"># ls -l</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root 360 Nov  1 09:39 dev</span><br><span class="line">drwxr-xr-x.   1 root root  66 Nov  1 09:39 etc</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x. 176 root root   0 Nov  1 09:39 proc</span><br><span class="line">dr-xr-x---.   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x.  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx.   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x.  13 root root   0 Nov  1 07:28 sys</span><br><span class="line">drwxrwxrwt.   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x.  20 root root 262 Sep 15 14:17 var</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  1 09:37 volume01</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  1 09:37 volume02</span><br><span class="line">[root@50d228c45e1f /]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>在容器 $2$ 中的<code>volume01</code>中添加文件 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@50d228c45e1f /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@50d228c45e1f volume01]<span class="comment"># touch test.java</span></span><br><span class="line">[root@50d228c45e1f volume01]<span class="comment"># cat test.java</span></span><br><span class="line">[root@50d228c45e1f volume01]<span class="comment"># ls</span></span><br><span class="line">test.java</span><br><span class="line">[root@50d228c45e1f volume01]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>可以看到容器 $1$ 的文件也添加上了 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker exec -it cnetos01 /bin/bash</span></span><br><span class="line">[root@b283552e8336 /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@b283552e8336 volume01]<span class="comment"># ls</span></span><br><span class="line">test.java</span><br><span class="line">[root@b283552e8336 volume01]<span class="comment"># cat test.java</span></span><br><span class="line">[root@b283552e8336 volume01]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="MySQL-数据卷容器同步数据"><a href="#MySQL-数据卷容器同步数据" class="headerlink" title="MySQL 数据卷容器同步数据"></a>MySQL 数据卷容器同步数据</h2><p>下面同步两个<code>MySQL</code>的数据库和配置文件，与前面的操作相同，首先建立数据卷，然后给另一个<code>MySQL</code>容器建立容器数据卷挂载。</p><ol><li>启动前面数据卷同步时创建的容器 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker start bd86b67cb648743b1871c70da061de1c43b99b0983994c4e6ffc9d7d07948619</span></span><br><span class="line">bd86b67cb648743b1871c70da061de1c43b99b0983994c4e6ffc9d7d07948619</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>启动容器数据卷 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost docker-test-volume]<span class="comment"># docker run -d -p 6604:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7</span></span><br><span class="line">6b96590d560acd433830a932488aa488a70541270a67bb7d377ee171a856ee46</span><br><span class="line">[root@localhost docker-test-volume]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><h2 id="Dockerfile-介绍"><a href="#Dockerfile-介绍" class="headerlink" title="Dockerfile 介绍"></a>Dockerfile 介绍</h2><p><code>Dockerfile</code>是用来构建<code>Docker</code>镜像的文本文件，也可以说是命令参数脚本。</p><p><code>docker build</code>命令用于从<code>Dockerfile</code>构建镜像。可以在<code>docker build</code>命令中使用<code>-f</code>标志指向文件系统中任何位置的<code>Dockerfile</code>。</p><p><code>Docker</code>镜像发布的步骤：</p><ol><li>编写一个<code>dockerfile</code>文件</li><li><code>docker build</code>构建成为一个镜像</li><li><code>docker run</code>镜像</li><li><code>docker push</code>镜像（发布镜像到<code>DockerHub</code>、阿里云镜像仓库）</li></ol><p>示例一个镜像的结构图：</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728052-3cb8269c.png"></p></div><h2 id="Dockerfile-指令说明"><a href="#Dockerfile-指令说明" class="headerlink" title="Dockerfile 指令说明"></a>Dockerfile 指令说明</h2><table><thead><tr><th>指令</th><th>说明</th></tr></thead><tbody><tr><td><code>FROM</code></td><td>指定基础镜像</td></tr><tr><td><code>MAINTAINER</code></td><td>镜像是谁写的，姓名+邮箱</td></tr><tr><td><code>RUN</code></td><td>镜像构建的时候需要运行的命令</td></tr><tr><td><code>ADD</code></td><td>将本地文件添加到容器中，<code>tar</code>类型文件会自动解压（网络压缩资源不会被解压），可以访问网络资源，类似<code>wget</code></td></tr><tr><td><code>WORKDIR</code></td><td>镜像的工作目录</td></tr><tr><td><code>VOLUME</code></td><td>挂载的目录</td></tr><tr><td><code>EXPOSE</code></td><td>保留端口配置</td></tr><tr><td><code>CMD</code></td><td>指定这个容器启动的时候要运行的命令（只有最后一个会生效）</td></tr><tr><td><code>EMTRYPOINT</code></td><td>指定这个容器启动的时候要运行的命令，可以追加命令</td></tr><tr><td><code>ONBUILD</code></td><td>当构建一个被继承<code>DockerFile</code>，这个时候就会运行<code>ONBUILD</code>的指令，触发指令</td></tr><tr><td><code>COPY</code></td><td>功能类似<code>ADD</code>，但是是不会自动解压文件，也不能访问网络资源</td></tr><tr><td><code>ENV</code></td><td>构建的时候设置环境变量</td></tr></tbody></table><p>一个形象的解释各个指令作用的图：</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728095-c4191b76.png"></p></div><p><code>Dockerfile</code>一般分为四部分：</p><ul><li>基础镜像信息</li><li>维护者信息</li><li>镜像操作指令</li><li>容器启动时执行指令</li></ul><p>关于<code>Dockerfile</code>文件的脚本注意点有：</p><ol><li>每个保留关键字（指令）都必须是大写字母</li><li>文件中的指令从上到下顺序执行，第一个指令必须是<code>FROM</code></li><li><code>#</code>号表示注释</li><li>每一个指令都会创建一个新的镜像层并提交</li></ol><p>关于<code>Dockerfile</code>指令的详细语法解释：<a href="https://www.cnblogs.com/panwenbin-logs/p/8007348.html">Dockerfile文件详解</a><br><code>Dockerfile</code>指令介绍的<a href="https://docs.docker.com/engine/reference/builder/">官方文档</a>：<code>https://docs.docker.com/engine/reference/builder/</code>。</p><h2 id="制作CentOS镜像"><a href="#制作CentOS镜像" class="headerlink" title="制作CentOS镜像"></a>制作CentOS镜像</h2><p>下面通过编写<code>Dockerfile</code>文件来制作<code>CentOS</code>镜像，并在官方镜像的基础上添加<code>vim</code>和<code>net-tools</code>工具。</p><ol><li><p>在<code>/home/dockfile</code>目录下新建文件<code>mydockerfile-centos</code>。然后使用上述指令编写该文件</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># mkdir dockerfile</span></span><br><span class="line">[root@localhost home]<span class="comment"># cd dockerfile/</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment"># vi mydockerfile-centos</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment"># cat mydockerfile-centos</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER ethan&lt;1258398543@qq.com&gt;</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line">CMD <span class="built_in">echo</span> <span class="string">&quot;---end---&quot;</span></span><br><span class="line">CMD /bin/bash</span><br><span class="line">[root@localhost dockerfile]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p> 逐行解释该<code>Dockerfile</code>文件的指令：</p><ul><li><code>FROM centos</code>：该<code>image</code>文件继承官方的<code>centos</code>，后面加冒号如<code>centos:7</code>，用于指定镜像的版本</li><li><code>ENV MYPATH /usr/local</code>：设置环境变量<code>MYPATH</code>，后面有用到</li><li><code>WORKDIR $MYPATH</code>：直接使用上面设置的环境变量，指定<code>/usr/local</code>为工作目录</li><li><code>RUN yum -y install vim</code>和<code>RUN yum -y install net-tools</code>：在<code>/usr/local</code>目录下，运行<code>yum -y install vim</code>和<code>yum -y install net-tools</code>命令安装工具，注意安装后的所有依赖和工具都会打包到<code>image</code>文件中</li><li><code>EXPOSE 80</code>：将容器 $80$ 端口暴露出来，允许外部连接这个端口</li><li><code>CMD</code>：指定容器启动的时候运行命令</li></ul></li><li><p>执行<code>build</code>命令生成<code>image</code>文件，构建镜像命令：<code>docker build -f dockerfile文件路径 -t 镜像名[:版本号] .</code>（这里有个小点<code>.</code>）；如果执行成功，可以通过<code>docker images</code>来查看新生成的镜像文件</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfile]<span class="comment">#  docker build -f mydockerfile-centos -t mycentos:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"> ---&gt; 5d0da3dc9764</span><br><span class="line">Step 2/10 : MAINTAINER ethan&lt;1258398543@qq.com&gt;</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 43b1033a97a4</span><br><span class="line">Removing intermediate container 43b1033a97a4</span><br><span class="line"> ---&gt; 095d1fbac30b</span><br><span class="line">Step 3/10 : ENV MYPATH /usr/local</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> ed78d9027e6b</span><br><span class="line">Removing intermediate container ed78d9027e6b</span><br><span class="line"> ---&gt; ed516bbef3f2</span><br><span class="line">Step 4/10 : WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 66194c150e8b</span><br><span class="line">Removing intermediate container 66194c150e8b</span><br><span class="line"> ---&gt; a497136254c6</span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a84eff373c59</span><br><span class="line">CentOS Linux 8 - AppStream                      1.2 MB/s | 9.5 MB     00:08</span><br><span class="line">CentOS Linux 8 - BaseOS                         2.2 MB/s | 7.5 MB     00:03</span><br><span class="line">CentOS Linux 8 - Extras                         1.8 kB/s |  10 kB     00:05</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         appstream       48 k</span><br><span class="line"> <span class="built_in">which</span>               x86_64      2.21-12.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        474 kB/s |  39 kB     00:00</span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 1.4 MB/s |  48 kB     00:00</span><br><span class="line">(3/5): which-2.21-12.el8.x86_64.rpm              70 kB/s |  49 kB     00:00</span><br><span class="line">(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  249 kB/s | 1.4 MB     00:05</span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    852 kB/s | 6.3 MB     00:07</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           949 kB/s | 7.8 MB     00:08</span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00</span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : <span class="string">&quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span></span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1</span><br><span class="line">  Installing       : which-2.21-12.el8.x86_64                               1/5</span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5</span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5</span><br><span class="line">  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5</span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5</span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5</span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5</span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5</span><br><span class="line">  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5</span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5</span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5</span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5</span><br><span class="line">  Verifying        : which-2.21-12.el8.x86_64                               5/5</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64</span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container a84eff373c59</span><br><span class="line"> ---&gt; 6408950e74f3</span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 597d5566b368</span><br><span class="line">Last metadata expiration check: 0:00:16 ago on Mon Nov  1 12:31:34 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   1.8 MB/s | 322 kB     00:00</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           423 kB/s | 322 kB     00:00</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction <span class="built_in">test</span></span><br><span class="line">Transaction <span class="built_in">test</span> succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1</span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1</span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1</span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1</span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 597d5566b368</span><br><span class="line"> ---&gt; af57346b45d9</span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 909587416a60</span><br><span class="line">Removing intermediate container 909587416a60</span><br><span class="line"> ---&gt; 0aa76c6c71d9</span><br><span class="line">Step 8/10 : CMD <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 5190b077ed5e</span><br><span class="line">Removing intermediate container 5190b077ed5e</span><br><span class="line"> ---&gt; 8895bf084511</span><br><span class="line">Step 9/10 : CMD <span class="built_in">echo</span> <span class="string">&quot;---end---&quot;</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 31128e5f3554</span><br><span class="line">Removing intermediate container 31128e5f3554</span><br><span class="line"> ---&gt; 051a1554ad1d</span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 54e5d791d01e</span><br><span class="line">Removing intermediate container 54e5d791d01e</span><br><span class="line"> ---&gt; 2b8eb73a11a5</span><br><span class="line">Successfully built 2b8eb73a11a5</span><br><span class="line">Successfully tagged mycentos:1.0</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              1.0       2b8eb73a11a5   2 minutes ago   337MB</span><br><span class="line">mycentso              1.0       992cbdac9cbb   3 hours ago     231MB</span><br><span class="line">mytomcat              1.0       97a599676bbb   2 days ago      684MB</span><br><span class="line">tomcat                latest    b0e0b0a92cf9   10 days ago     680MB</span><br><span class="line">mysql                 5.7       938b57d64674   13 days ago     448MB</span><br><span class="line">nginx                 latest    87a94228f133   2 weeks ago     133MB</span><br><span class="line">hello-world           latest    feb5d9fea6a5   5 weeks ago     13.3kB</span><br><span class="line">centos                latest    5d0da3dc9764   6 weeks ago     231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   7 months ago    79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   3 years ago     486MB</span><br><span class="line">abh1nav/dockerui      latest    6e4d05915b2a   6 years ago     470MB</span><br><span class="line">[root@localhost dockerfile]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p> 上面命令中，<code>-t</code>参数用来指定<code>image</code>文件的名字，后面还可以用冒号指定标签。如果不指定，默认的标签就是<code>latest</code>。最后的那个点表示<code>Dockerfile</code>文件所在的路径，上例是当前路径，所以是一个点。</p></li><li><p>生成容器，测试相关命令，查看默认工作目录是否设置成功，<code>vim</code>和<code>net-tools</code>工具是否下载成功</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfile]<span class="comment"># docker run -it mycentos:1.0</span></span><br><span class="line">[root@ebcc9cd49fd2 <span class="built_in">local</span>]<span class="comment"># pwd</span></span><br><span class="line">/usr/local</span><br><span class="line">[root@ebcc9cd49fd2 <span class="built_in">local</span>]<span class="comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.6  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:06  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 8  bytes 656 (656.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">[root@ebcc9cd49fd2 <span class="built_in">local</span>]<span class="comment"># vi test.txt</span></span><br><span class="line">[root@ebcc9cd49fd2 <span class="built_in">local</span>]<span class="comment"># cat test.txt</span></span><br><span class="line">Hello World!</span><br><span class="line">[root@ebcc9cd49fd2 <span class="built_in">local</span>]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>通过<code>docker history 镜像id</code>命令来查看镜像的构建步骤</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfile]<span class="comment"># docker history 2b8eb73a11a5</span></span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">2b8eb73a11a5   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B</span></span><br><span class="line">051a1554ad1d   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span></span><br><span class="line">8895bf084511   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo…   0B</span></span><br><span class="line">0aa76c6c71d9   6 minutes ago   /bin/sh -c <span class="comment">#(nop)  EXPOSE 80                    0B</span></span><br><span class="line">af57346b45d9   6 minutes ago   /bin/sh -c yum -y install net-tools             32.6MB</span><br><span class="line">6408950e74f3   6 minutes ago   /bin/sh -c yum -y install vim                   73.1MB</span><br><span class="line">a497136254c6   7 minutes ago   /bin/sh -c <span class="comment">#(nop) WORKDIR /usr/local            0B</span></span><br><span class="line">ed516bbef3f2   7 minutes ago   /bin/sh -c <span class="comment">#(nop)  ENV MYPATH=/usr/local        0B</span></span><br><span class="line">095d1fbac30b   7 minutes ago   /bin/sh -c <span class="comment">#(nop)  MAINTAINER ethan&lt;12583985…   0B</span></span><br><span class="line">5d0da3dc9764   6 weeks ago     /bin/sh -c <span class="comment">#(nop)  CMD [&quot;/bin/bash&quot;]            0B</span></span><br><span class="line">&lt;missing&gt;      6 weeks ago     /bin/sh -c <span class="comment">#(nop)  LABEL org.label-schema.sc…   0B</span></span><br><span class="line">&lt;missing&gt;      6 weeks ago     /bin/sh -c <span class="comment">#(nop) ADD file:805cb5e15fb6e0bb0…   231MB</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="RUN，CMD和ENTRYPOINT的区别"><a href="#RUN，CMD和ENTRYPOINT的区别" class="headerlink" title="RUN，CMD和ENTRYPOINT的区别"></a>RUN，CMD和ENTRYPOINT的区别</h2><ul><li><p><code>RUN</code>命令与<code>CMD</code>命令的区别</p><ul><li><code>RUN</code>命令在<code>image</code>文件的构建阶段执行，执行结果都会打包进入<code>image</code>文件</li><li><code>CMD</code>命令则是在容器启动后执行</li><li>一个<code>Dockerfile</code>可以包含多个<code>RUN</code>命令，但是只能有一个<code>CMD</code>命令</li><li>指定了<code>CMD</code>命令以后，<code>docker container run</code>命令就不能附加命令了（比如前面的<code>/bin/bash</code>），否则它会覆盖<code>CMD</code>命令</li></ul></li><li><p><code>CMD</code>和<code>ENTRYPOINT</code>的区别</p><ul><li><p><code>CMD</code>：指定容器启动的时候要运行的命令，只有最后一个会生效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfile]<span class="comment"># vi dockerfile-cmd-test</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment"># cat dockerfile-cmd-test</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker build -f dockerfile-cmd-test -t cmdtest:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 5d0da3dc9764</span><br><span class="line">Step 2/2 : CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 9ca0b5024460</span><br><span class="line">Removing intermediate container 9ca0b5024460</span><br><span class="line"> ---&gt; 38015602d8a7</span><br><span class="line">Successfully built 38015602d8a7</span><br><span class="line">Successfully tagged cmdtest:1.0</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker run cmdtest:1.0</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="comment"># 由于使用的是 CMD 指令，命令无追加，-l 取代了原本的 ls -a，而 -l 命令不存在所以报错</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker run cmdtest:1.0 -l</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: <span class="built_in">exec</span>: <span class="string">&quot;-l&quot;</span>: executable file not found <span class="keyword">in</span> <span class="variable">$PATH</span>: unknown.</span><br><span class="line">ERRO[0000] error waiting <span class="keyword">for</span> container: context canceled</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># </span></span><br></pre></td></tr></table></figure><p>可以看到追加命令<code>-l</code> 出现了报错。</p></li><li><p><code>ENTRYPOINT</code>：指定容器启动的时候要运行的命令,命令可以追加</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost dockerfile]<span class="comment"># vi dockerfile-entrypoint-test</span></span><br><span class="line">[root@localhost dockerfile]<span class="comment"># cat dockerfile-entrypoint-test</span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker build -f dockerfile-entrypoint-test -t entrypointtest:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"> ---&gt; 5d0da3dc9764</span><br><span class="line">Step 2/2 : ENTRYPOINT [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> f4eae0dcc32f</span><br><span class="line">Removing intermediate container f4eae0dcc32f</span><br><span class="line"> ---&gt; 407fa467dbb2</span><br><span class="line">Successfully built 407fa467dbb2</span><br><span class="line">Successfully tagged entrypointtest:1.0</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker run entrypointtest:1.0</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">[root@localhost dockerfile]<span class="comment"># docker run entrypointtest:1.0 -l</span></span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.   1 root root   6 Nov  1 13:23 .</span><br><span class="line">drwxr-xr-x.   1 root root   6 Nov  1 13:23 ..</span><br><span class="line">-rwxr-xr-x.   1 root root   0 Nov  1 13:23 .dockerenv</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root 340 Nov  1 13:23 dev</span><br><span class="line">drwxr-xr-x.   1 root root  66 Nov  1 13:23 etc</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x. 175 root root   0 Nov  1 13:23 proc</span><br><span class="line">dr-xr-x---.   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x.  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx.   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x.  13 root root   0 Nov  1 07:28 sys</span><br><span class="line">drwxrwxrwt.   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x.  20 root root 262 Sep 15 14:17 var</span><br><span class="line">[root@localhost dockerfile]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="制作-Tomcat-镜像并发布"><a href="#制作-Tomcat-镜像并发布" class="headerlink" title="制作 Tomcat 镜像并发布"></a>制作 Tomcat 镜像并发布</h2><h3 id="制作-Tomcat-镜像"><a href="#制作-Tomcat-镜像" class="headerlink" title="制作 Tomcat 镜像"></a>制作 Tomcat 镜像</h3><ol><li><p>准备镜像文件<code>tomcat</code>、<code>jdk</code>压缩包</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]<span class="comment"># pwd</span></span><br><span class="line">/home/dockerfile/tomcat</span><br><span class="line">[root@localhost tomcat]<span class="comment"># vi readme.md</span></span><br><span class="line">[root@localhost tomcat]<span class="comment"># ll</span></span><br><span class="line">总用量 153496</span><br><span class="line">-rw-r--r--. 1 root root  10371538 11月  1 21:48 apache-tomcat-8.5.55.tar.gz</span><br><span class="line">-rw-r--r--. 1 root root 146799982 11月  1 21:48 jdk-8u311-linux-x64.tar.gz</span><br><span class="line">-rw-r--r--. 1 root root         9 11月  1 21:28 readme.md</span><br><span class="line">[root@localhost tomcat]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>编写<code>dockerfile</code>文件，文件名使用官方命名：<code>Dockerfile</code> ，<code>build</code>的时候就会默认寻找当前目录下的文件，不需要使用<code>-f</code>参数指定</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]<span class="comment"># vim Dockerfile</span></span><br><span class="line">[root@localhost tomcat]<span class="comment"># cat Dockerfile</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER <span class="built_in">echo</span>&lt;3153896464@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.md /usr/local/readme.md</span><br><span class="line"></span><br><span class="line">ADD jdk-8u311-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-8.5.55.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_311</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.55</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-8.5.55</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-8.5.55/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/apache-tomcat-8.5.55/bin/logs/catalina.out</span><br><span class="line">[root@localhost tomcat]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>使用该<code>Dockerfile</code>构建镜像</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]<span class="comment"># docker build -t diytomcat:1.0 .</span></span><br><span class="line">Sending build context to Docker daemon  157.2MB</span><br><span class="line">Step 1/15 : FROM centos</span><br><span class="line"> ---&gt; 5d0da3dc9764</span><br><span class="line">Step 2/15 : MAINTAINER <span class="built_in">echo</span>&lt;3153896464@qq.com&gt;</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 988b7c14fa96</span><br><span class="line">Removing intermediate container 988b7c14fa96</span><br><span class="line"> ---&gt; 6e0311b858c9</span><br><span class="line">Step 3/15 : COPY readme.md /usr/local/readme.md</span><br><span class="line"> ---&gt; f92145359284</span><br><span class="line">Step 4/15 : ADD jdk-8u311-linux-x64.tar.gz /usr/local/</span><br><span class="line"> ---&gt; d53b12117404</span><br><span class="line">Step 5/15 : ADD apache-tomcat-8.5.55.tar.gz /usr/local/</span><br><span class="line"> ---&gt; fdd0092e4339</span><br><span class="line">Step 6/15 : RUN yum -y install vim</span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64</span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64</span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container ec335e3411bb</span><br><span class="line"> ---&gt; 1377af46cd65</span><br><span class="line">Step 7/15 : ENV MYPATH /usr/local</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 555def29db17</span><br><span class="line">Removing intermediate container 555def29db17</span><br><span class="line"> ---&gt; 25267120e30d</span><br><span class="line">Step 8/15 : WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 818a61866bba</span><br><span class="line">Removing intermediate container 818a61866bba</span><br><span class="line"> ---&gt; 0ed85871370b</span><br><span class="line">Step 9/15 : ENV JAVA_HOME /usr/local/jdk1.8.0_311</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> aa6de69dc2a5</span><br><span class="line">Removing intermediate container aa6de69dc2a5</span><br><span class="line"> ---&gt; 81dd801c3581</span><br><span class="line">Step 10/15 : ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 4fdfce5e2045</span><br><span class="line">Removing intermediate container 4fdfce5e2045</span><br><span class="line"> ---&gt; 1d41f7e74c58</span><br><span class="line">Step 11/15 : ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.55</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 84625d8d36af</span><br><span class="line">Removing intermediate container 84625d8d36af</span><br><span class="line"> ---&gt; d30f19634463</span><br><span class="line">Step 12/15 : ENV CATALINA_BASH /usr/local/apache-tomcat-8.5.55</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 2843ec285371</span><br><span class="line">Removing intermediate container 2843ec285371</span><br><span class="line"> ---&gt; 39c1dbf31a63</span><br><span class="line">Step 13/15 : ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 62c8b67ea09d</span><br><span class="line">Removing intermediate container 62c8b67ea09d</span><br><span class="line"> ---&gt; b4ca5a701807</span><br><span class="line">Step 14/15 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 3595d16f3ca0</span><br><span class="line">Removing intermediate container 3595d16f3ca0</span><br><span class="line"> ---&gt; 8dc48ca6d1fe</span><br><span class="line">Step 15/15 : CMD /usr/local/apache-tomcat-8.5.55/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/apache-tomcat-8.5.55/bin/logs/catalina.out</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> e8bbb9e7e0c5</span><br><span class="line">Removing intermediate container e8bbb9e7e0c5</span><br><span class="line"> ---&gt; 3c423f22b8ed</span><br><span class="line">Successfully built 3c423f22b8ed</span><br><span class="line">Successfully tagged diytomcat:1.0</span><br><span class="line">[root@localhost tomcat]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>启动生成的镜像，构建<code>Tomcat</code>容器<br> 这里设置了数据卷，宿主机的<code>/home/dockerfile/tomcat/test</code>对应该容器的<code>/usr/local/apache-tomcat-8.5.55/webapps/test</code>。这样关于<code>test</code>项目的修复只需要在宿主机上修改就可以了，不需要进入到容器中修改</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]<span class="comment"># docker run -d -p 8088:8080 --name diytomcat -v /home/dockerfile/tomcat/test:/usr/local/apache-tomcat-8.5.55/webapps/test diytomcat:1.0</span></span><br><span class="line">5e3707f7e7692dad464e7d39e040ef512d103265ed0ed0b236c5a6d631d17e44</span><br><span class="line">[root@localhost tomcat]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>在<code>/home/dockerfile/tomcat/test</code>的目录下，新建<code>index.html</code>测试<code>Tomcat</code>是否能正常使用</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost tomcat]<span class="comment"># cd test/</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># ls</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># vi index.html</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cat index.html</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">         &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span><br><span class="line">        &lt;title&gt;这是个标题&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;h1&gt;这是一个一个简单的HTML&lt;/h1&gt;</span><br><span class="line">        &lt;p&gt;Hello World！&lt;/p&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># mkdir WEB-INF</span></span><br><span class="line">[root@localhost <span class="built_in">test</span>]<span class="comment"># cd WEB-INF/</span></span><br><span class="line">[root@localhost WEB-INF]<span class="comment"># vi web.xml</span></span><br><span class="line">[root@localhost WEB-INF]<span class="comment"># cat web.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee</span></span><br><span class="line"><span class="string">                      http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;</span></span><br><span class="line">         version=<span class="string">&quot;4.0&quot;</span></span><br><span class="line">         metadata-complete=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">        &lt;welcome-file-list&gt;</span><br><span class="line">                &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;</span><br><span class="line">        &lt;/welcome-file-list&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line">[root@localhost WEB-INF]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>访问测试，浏览器访问查看是否能正常访问<br> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728189-9c5034c9.png"></p><p> 如果页面显示乱码，就需要修改<code>tomcat</code>的<code>server.xml</code>文件</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span> </span></span><br><span class="line"><span class="tag">             <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p> 这里添加了一个属性：<code>URIEncoding</code>，将该属性值设置为<code>UTF-8</code>，即可让<code>Tomcat</code>（默认<code>ISO-8859-1</code>编码）以<code>UTF-8</code>的编码处理<code>get</code>请求。</p></li></ol><h3 id="发布镜像到-DockerHub"><a href="#发布镜像到-DockerHub" class="headerlink" title="发布镜像到 DockerHub"></a>发布镜像到 DockerHub</h3><ol><li><p>登录<code>DockerHub</code><a href="https://hub.docker.com/">官网</a><code>https://hub.docker.com/</code> 进行注册</p></li><li><p>进行登录，<code>docker login -u 用户名</code></p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost WEB-INF]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line">[root@localhost WEB-INF]#</span><br></pre></td></tr></table></figure></li><li><p>使用<code>docker push</code>命令推送镜像到<code>DockerHub</code>上的仓库</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost WEB-INF]# docker push arrebols/diytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/arrebols/diytomcat]</span><br><span class="line">5ae6f0025e05: Pushed</span><br><span class="line">e99deaf1aa3c: Pushed</span><br><span class="line">e698a7f407c0: Pushed</span><br><span class="line">ccf9c9482e50: Pushed</span><br><span class="line">74ddd0ec08fa: Mounted from library/centos</span><br></pre></td></tr></table></figure><p> 因为<code>push</code>的时候，镜像名前面需要加上用户名（<code>arrebol</code>是用户名。如果用户名不是当前登录用户则会拒绝<code>push</code>请求），所以需要使用命令<code>docker tag 镜像名 新的镜像名</code>复制出一份镜像重新打个<code>Tag</code>。</p></li></ol><h3 id="发布镜像到阿里云容器服务"><a href="#发布镜像到阿里云容器服务" class="headerlink" title="发布镜像到阿里云容器服务"></a>发布镜像到阿里云容器服务</h3><ol><li>登录阿里云，找到容器镜像服务</li><li>创建命名空间</li><li>与上面<code>DockerHub</code>的操作类似，按官方提供的操作指南操作即可</li></ol><h1 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h1><h2 id="理解-Docker"><a href="#理解-Docker" class="headerlink" title="理解 Docker"></a>理解 Docker</h2><ol><li><p>查看本机的<code>ip addr</code><br> 通过命令<code>ip addr</code>查看本地<code>ip</code>地址，发现除了本机回环地址和内网地址外，还多了一个网卡：<code>Docker0</code>，这是<code>Docker</code>服务启动后自动生成的。<br> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728368-754cc587.png"></p></li><li><p>启动<code>tomcat</code>，并查看容器内部的<code>ip addr</code><br> 进入一个正在后台运行的<code>tomcat</code>容器，同样使用<code>ip addr</code>命令，发现容器得到了一个新的网络：<code>6: eth0@if7</code>，<code>ip</code>地址：$172.17.0.3/16$。这是<code>Docker</code>在容器启动时为其分配的。</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -it -P --name tomcat01 tomcat</span></span><br><span class="line">Unable to find image <span class="string">&#x27;tomcat:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">...</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> tomcat:latest</span><br><span class="line">b8f8e90162f789577b678ea020e54e5e091b62081b2ed34580288761b1c6c55a</span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat01 /bin/bash</span></span><br><span class="line">root@b8f8e90162f7:/usr/local/tomcat<span class="comment"># apt-get update</span></span><br><span class="line">Get:1 http://deb.debian.org/debian bullseye InRelease [116 kB]</span><br><span class="line">Get:2 http://security.debian.org/debian-security bullseye-security InRelease [44.1 kB]</span><br><span class="line">Get:3 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [85.2 kB]</span><br><span class="line">Get:4 http://deb.debian.org/debian bullseye-updates InRelease [39.4 kB]</span><br><span class="line">Get:5 http://deb.debian.org/debian bullseye/main amd64 Packages [8180 kB]</span><br><span class="line">Get:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [2592 B]</span><br><span class="line">Fetched 8467 kB <span class="keyword">in</span> 8min 23s (16.8 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">root@b8f8e90162f7:/usr/local/tomcat<span class="comment"># apt-get -y  install iproute2 iproute2-doc</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  libatm1 libbpf0 libcap2 libcap2-bin libelf1 libmnl0 libpam-cap libxtables12</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  iproute2 iproute2-doc libatm1 libbpf0 libcap2 libcap2-bin libelf1 libmnl0 libpam-cap libxtables12</span><br><span class="line">0 upgraded, 10 newly installed, 0 to remove and 1 not upgraded.</span><br><span class="line">Need to get 1424 kB of archives.</span><br><span class="line">After this operation, 4734 kB of additional disk space will be used.</span><br><span class="line">Get:1 http://deb.debian.org/debian bullseye/main amd64 libelf1 amd64 0.183-1 [165 kB]</span><br><span class="line">Get:2 http://deb.debian.org/debian bullseye/main amd64 libbpf0 amd64 1:0.3-2 [98.3 kB]</span><br><span class="line">Get:3 http://deb.debian.org/debian bullseye/main amd64 libcap2 amd64 1:2.44-1 [23.6 kB]</span><br><span class="line">Get:4 http://deb.debian.org/debian bullseye/main amd64 libmnl0 amd64 1.0.4-3 [12.5 kB]</span><br><span class="line">Get:5 http://deb.debian.org/debian bullseye/main amd64 libxtables12 amd64 1.8.7-1 [45.1 kB]</span><br><span class="line">Get:6 http://deb.debian.org/debian bullseye/main amd64 libcap2-bin amd64 1:2.44-1 [32.6 kB]</span><br><span class="line">Get:7 http://deb.debian.org/debian bullseye/main amd64 iproute2 amd64 5.10.0-4 [930 kB]</span><br><span class="line">Get:8 http://deb.debian.org/debian bullseye/main amd64 iproute2-doc all 5.10.0-4 [30.1 kB]</span><br><span class="line">Get:9 http://deb.debian.org/debian bullseye/main amd64 libatm1 amd64 1:2.5.1-4 [71.3 kB]</span><br><span class="line">Get:10 http://deb.debian.org/debian bullseye/main amd64 libpam-cap amd64 1:2.44-1 [15.4 kB]</span><br><span class="line">Fetched 1424 kB <span class="keyword">in</span> 17s (83.3 kB/s)</span><br><span class="line">debconf: delaying package configuration, since apt-utils is not installed</span><br><span class="line">Selecting previously unselected package libelf1:amd64.</span><br><span class="line">(Reading database ... 12676 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../0-libelf1_0.183-1_amd64.deb ...</span><br><span class="line">Unpacking libelf1:amd64 (0.183-1) ...</span><br><span class="line">Selecting previously unselected package libbpf0:amd64.</span><br><span class="line">Preparing to unpack .../1-libbpf0_1%3a0.3-2_amd64.deb ...</span><br><span class="line">Unpacking libbpf0:amd64 (1:0.3-2) ...</span><br><span class="line">Selecting previously unselected package libcap2:amd64.</span><br><span class="line">Preparing to unpack .../2-libcap2_1%3a2.44-1_amd64.deb ...</span><br><span class="line">Unpacking libcap2:amd64 (1:2.44-1) ...</span><br><span class="line">Selecting previously unselected package libmnl0:amd64.</span><br><span class="line">Preparing to unpack .../3-libmnl0_1.0.4-3_amd64.deb ...</span><br><span class="line">Unpacking libmnl0:amd64 (1.0.4-3) ...</span><br><span class="line">Selecting previously unselected package libxtables12:amd64.</span><br><span class="line">Preparing to unpack .../4-libxtables12_1.8.7-1_amd64.deb ...</span><br><span class="line">Unpacking libxtables12:amd64 (1.8.7-1) ...</span><br><span class="line">Selecting previously unselected package libcap2-bin.</span><br><span class="line">Preparing to unpack .../5-libcap2-bin_1%3a2.44-1_amd64.deb ...</span><br><span class="line">Unpacking libcap2-bin (1:2.44-1) ...</span><br><span class="line">Selecting previously unselected package iproute2.</span><br><span class="line">Preparing to unpack .../6-iproute2_5.10.0-4_amd64.deb ...</span><br><span class="line">Unpacking iproute2 (5.10.0-4) ...</span><br><span class="line">Selecting previously unselected package iproute2-doc.</span><br><span class="line">Preparing to unpack .../7-iproute2-doc_5.10.0-4_all.deb ...</span><br><span class="line">Unpacking iproute2-doc (5.10.0-4) ...</span><br><span class="line">Selecting previously unselected package libatm1:amd64.</span><br><span class="line">Preparing to unpack .../8-libatm1_1%3a2.5.1-4_amd64.deb ...</span><br><span class="line">Unpacking libatm1:amd64 (1:2.5.1-4) ...</span><br><span class="line">Selecting previously unselected package libpam-cap:amd64.</span><br><span class="line">Preparing to unpack .../9-libpam-cap_1%3a2.44-1_amd64.deb ...</span><br><span class="line">Unpacking libpam-cap:amd64 (1:2.44-1) ...</span><br><span class="line">Setting up iproute2-doc (5.10.0-4) ...</span><br><span class="line">Setting up libatm1:amd64 (1:2.5.1-4) ...</span><br><span class="line">Setting up libcap2:amd64 (1:2.44-1) ...</span><br><span class="line">Setting up libcap2-bin (1:2.44-1) ...</span><br><span class="line">Setting up libmnl0:amd64 (1.0.4-3) ...</span><br><span class="line">Setting up libxtables12:amd64 (1.8.7-1) ...</span><br><span class="line">Setting up libelf1:amd64 (0.183-1) ...</span><br><span class="line">Setting up libpam-cap:amd64 (1:2.44-1) ...</span><br><span class="line">debconf: unable to initialize frontend: Dialog</span><br><span class="line">debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)</span><br><span class="line">debconf: falling back to frontend: Readline</span><br><span class="line">Setting up libbpf0:amd64 (1:0.3-2) ...</span><br><span class="line">Setting up iproute2 (5.10.0-4) ...</span><br><span class="line">debconf: unable to initialize frontend: Dialog</span><br><span class="line">debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)</span><br><span class="line">debconf: falling back to frontend: Readline</span><br><span class="line">Processing triggers <span class="keyword">for</span> libc-bin (2.31-13+deb11u2) ...</span><br><span class="line">root@b8f8e90162f7:/usr/local/tomcat<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">6: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">root@b8f8e90162f7:/usr/local/tomcat<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>在主机中再次<code>ip addr</code>，发现多了一个 网卡</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:69:13:06 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.61.131/24 brd 192.168.61.255 scope global dynamic noprefixroute ens160</span><br><span class="line">       valid_lft 1074sec preferred_lft 1074sec</span><br><span class="line">    inet6 fe80::20c:29ff:fe69:1306/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:8d:e3:44:c9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:8dff:fee3:44c9/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: vethb7bc992@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 16:80:<span class="built_in">dd</span>:50:8e:<span class="built_in">dd</span> brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::1480:ddff:fe50:8edd/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="comment"># 这是多出来的网卡</span></span><br><span class="line">7: veth3686f69@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 86:4b:1c:e0:25:97 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::844b:1cff:fee0:2597/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>宿主机<code>ping</code>通容器内部<br> <code>linux</code>可以<code>ping</code>通<code>docker</code>容器内部，因为<code>docker0</code>的<code>ip</code>地址为 $172.17.0.1$，容器为 $172.17.0.3$</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ping 172.17.0.3</span></span><br><span class="line">PING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=0.051 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=2 ttl=64 time=0.035 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=3 ttl=64 time=0.035 ms</span><br><span class="line">64 bytes from 172.17.0.3: icmp_seq=4 ttl=64 time=0.033 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.3 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3061ms</span><br><span class="line">rtt min/avg/max/mdev = 0.033/0.038/0.051/0.009 ms</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>再次启动第二个<code>tomcat</code>容器后，又多了一对网卡</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -it -P --name tomcat02 tomcat</span></span><br><span class="line">e7a9c8acb5fadde4aa70d8027dcd922e15c42d2c261255ac5bc837a1cdca22db</span><br><span class="line">[root@localhost ~]<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:0c:29:69:13:06 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.61.131/24 brd 192.168.61.255 scope global dynamic noprefixroute ens160</span><br><span class="line">       valid_lft 1136sec preferred_lft 1136sec</span><br><span class="line">    inet6 fe80::20c:29ff:fe69:1306/64 scope <span class="built_in">link</span> noprefixroute</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:8d:e3:44:c9 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:8dff:fee3:44c9/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: veth3686f69@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 86:4b:1c:e0:25:97 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::844b:1cff:fee0:2597/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: veth1399007@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 56:08:3f:19:95:f9 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::5408:3fff:fe19:95f9/64 scope <span class="built_in">link</span></span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>测试两个容器之间的通信</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat02 /bin/bash</span></span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment"># apt-get update</span></span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment"># apt-get -y  install iproute2 iproute2-doc</span></span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment"># ip addr</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">8: eth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment"># apt-get -y install iputils-ping</span></span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment"># ping 172.17.0.2</span></span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.037 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.023 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.023 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.045 ms</span><br><span class="line">^C</span><br><span class="line">--- 172.17.0.2 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 received, 0% packet loss, time 3087ms</span><br><span class="line">rtt min/avg/max/mdev = 0.023/0.032/0.045/0.009 ms</span><br><span class="line">root@e7a9c8acb5fa:/usr/local/tomcat<span class="comment">#</span></span><br></pre></td></tr></table></figure><p> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728436-051bd6c8.png"></p></li><li><p>小结</p><ul><li>原理：每启动一个<code>docker</code>容器，<code>docker</code>就会给容器分配一个默认的可用<code>ip</code>，只要安装了<code>docker</code>，就会有一个网卡<code>docker0(bridge)</code>。网卡采用桥接模式，并使用<code>veth-pair</code>技术<ul><li><code>veth-pair</code>就是一堆虚拟设备接口，成对出现，一段连着协议，一段彼此相连，充当一个桥梁</li></ul></li><li>容器 $1$→<code>Docker0</code>→容器 $2$<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728469-ca82b588.png"></li><li><code>tomcat01</code>和<code>tomcat02</code>是公用的一个路由器, <code>docker0</code>所有的容器不指定网络的情况下，都是<code>docker0</code>路由的，<code>docker</code>会给容器分配一个默认的可用</li><li><code>docker</code>中的所有网络接口都是虚拟的 ，转发效率高。删除容器后，对应的网桥也随之删除</li><li>只要容器删除，对应网桥一对就没了</li></ul></li></ol><h2 id="–link"><a href="#–link" class="headerlink" title="–link"></a>–link</h2><h3 id="单向联通"><a href="#单向联通" class="headerlink" title="单向联通"></a>单向联通</h3><p>若编写一个微服务并连接数据库，如果数据库<code>ip</code>改变，如何根据容器名而不是<code>ip</code>访问容器？显然，直接使用容器名是无法<code>ping</code>通容器内部的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat01 ping tomcat02</span></span><br><span class="line">ping: tomcat02: Name or service not known</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这时可以在容器启动命令中加入一个选项：<code>link</code>，使得可以根据容器名来访问容器：<code>docker run -d -P --link 容器名/id 镜像名/id</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -it -P --name tomcat03 --link tomcat01 tomcat</span></span><br><span class="line">13e1188a87a82c545770e00eaa7f263d300c8515b3037de51d4d915599ba3d6c</span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat03 /bin/bash</span></span><br><span class="line">root@13e1188a87a8:/usr/local/tomcat<span class="comment"># apt-get update</span></span><br><span class="line">root@13e1188a87a8:/usr/local/tomcat<span class="comment"># apt-get -y  install iproute2 iproute2-doc</span></span><br><span class="line">root@13e1188a87a8:/usr/local/tomcat<span class="comment"># apt-get -y install iputils-ping</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat03 ping tomcat01</span></span><br><span class="line">PING tomcat01 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01 (172.17.0.3): icmp_seq=1 ttl=64 time=0.097 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.3): icmp_seq=2 ttl=64 time=0.049 ms</span><br><span class="line">64 bytes from tomcat01 (172.17.0.3): icmp_seq=3 ttl=64 time=0.061 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2030ms</span><br><span class="line">rtt min/avg/max/mdev = 0.049/0.069/0.097/0.020 ms</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>然而反向就不可以<code>ping</code>通：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat01 ping tomcat03</span></span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p><code>link</code>就是在<code>tomcat03</code>的<code>hosts</code>配置中增加了一个<code>172.17.0.3 tomcat01 b8f8e90162f7</code></p><ul><li><code>tomcat03</code>中直接指明了<code>tomcat01</code>的<code>ip</code></li><li><code>tomcat01</code>中没有<code>tomcat03</code>的地址</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat03 cat /etc/hosts</span></span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line"><span class="comment">#  tomcat03 中直接指明了  tomcat01 的ip</span></span><br><span class="line">172.17.0.3      tomcat01 b8f8e90162f7</span><br><span class="line">172.17.0.4      13e1188a87a8</span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat01 cat /etc/hosts</span></span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.17.0.3      b8f8e90162f7</span><br><span class="line"><span class="comment">#  tomcat01 中没有 tomcat03的地址</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>查看所有的<code>docker</code>网络：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">4086aaa171e8   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">092a8a93c45e   host      host      <span class="built_in">local</span></span><br><span class="line">176ae67894b3   none      null      <span class="built_in">local</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><code>docker</code>中的网络模式有：</p><ul><li><code>bridge</code>：桥接<code>docker</code>（默认，自己创建也使用<code>bridge</code>模式）</li><li><code>none</code>：不配置网络</li><li><code>host</code>：和宿主机共享网络</li><li><code>container</code>：容器网络连通（用的少，局限很大）</li></ul><p><code>docker run</code>命令默认带有一个参数<code>–net bridge</code>，此处的<code>bridge</code>指的就是<code>docker0</code>。</p><p><code>docker0</code>特点：默认，域名不能访问，<code>--link</code>可以打通连接</p><p>如果不想使用<code>docker0</code>，可以创建一个新的网络：<code>docker  network create --driver 网络模式 --subnet 子网ip --gateway 网关 网络名</code></p><ul><li>桥接：<code>--driver bridge</code></li><li>子网的地址：<code>--subnet 192.168.0.0/16</code></li><li>范围：<code>192.168.0.2  -- 192.168.255.255</code></li><li>网关地址（路由器）：<code>--gateway 192.168.0.1 mynet</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span></span><br><span class="line">f21a60d02f90fd464ce95db06c8a7ea4c7895a17c9d282208a6f773d52d0f2dc</span><br><span class="line">[root@localhost ~]<span class="comment"># docker network ls</span></span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">4086aaa171e8   bridge    bridge    <span class="built_in">local</span></span><br><span class="line">092a8a93c45e   host      host      <span class="built_in">local</span></span><br><span class="line">f21a60d02f90   mynet     bridge    <span class="built_in">local</span></span><br><span class="line">176ae67894b3   none      null      <span class="built_in">local</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;f21a60d02f90fd464ce95db06c8a7ea4c7895a17c9d282208a6f773d52d0f2dc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-11-02T11:29:54.296389266+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h3><p>只要两个容器启动时都通过<code>–net</code>选用同一个已创建的网络，不同容器间即可通过<code>ip</code>地址或<code>容器名/id</code>连通。</p><ol><li>在自定义的网络里启动两个<code>tomcat</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d -P --name tomcat-net-01 --net mynet tomcat</span></span><br><span class="line">3246acdb17e3363a725c8a930c83ffdd634e086846a8445a88b04765f12c2cac</span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -d -P --name tomcat-net-02 --net mynet tomcat</span></span><br><span class="line">8f3db1f3d2132c98d960da9dba551a309d6e0c26e5b87a1cfd48a29a5c65612a</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>查看自定义的网络，发现里面多了两个容器的信息 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;f21a60d02f90fd464ce95db06c8a7ea4c7895a17c9d282208a6f773d52d0f2dc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-11-02T11:29:54.296389266+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;3246acdb17e3363a725c8a930c83ffdd634e086846a8445a88b04765f12c2cac&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;4d6c7d3af887105c3211c911b05d34eecebb9774ec01053d7eba93f28e171fac&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;8f3db1f3d2132c98d960da9dba551a309d6e0c26e5b87a1cfd48a29a5c65612a&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;d0391a5a208420f2ce935a78f7031b612085519bb94eb8cb7b7af8de8bddd7c1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>两个容器之间相互用名称<code>ping</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat-net-01 /bin/bash</span></span><br><span class="line">root@3246acdb17e3:/usr/local/tomcat<span class="comment"># apt-get update</span></span><br><span class="line">root@3246acdb17e3:/usr/local/tomcat<span class="comment"># apt-get -y install iproute2 iproute2-doc</span></span><br><span class="line">root@3246acdb17e3:/usr/local/tomcat<span class="comment"># apt-get -y install iputils-ping</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat-net-02 /bin/bash</span></span><br><span class="line">root@8f3db1f3d213:/usr/local/tomcat<span class="comment"># apt update</span></span><br><span class="line">root@8f3db1f3d213:/usr/local/tomcat<span class="comment"># apt-get -y install iproute2 iproute2-doc</span></span><br><span class="line">root@8f3db1f3d213:/usr/local/tomcat<span class="comment"># apt-get -y install iputils-ping</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec tomcat-net-01 ping tomcat-net-02</span></span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.073 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.066 ms</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec tomcat-net-02 ping tomcat-net-01</span></span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.055 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.078 ms</span><br></pre></td></tr></table></figure></li></ol><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p><code>docker</code>已经帮自定义网络维护好了对应的关系，推荐平时这样使用网络!</p><p>好处：</p><ul><li><code>redis</code>不同的集群使用不同的网络，保证<strong>集群是安全和健康的</strong></li><li><code>mysql</code>不同的集群使用不同的网络，保证<strong>集群是安全和健康的</strong></li></ul><h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>对于建立在不同网络下（<code>docker0</code>，<code>mynet</code>）的两个容器<code>tomcat01</code>和<code>tomcat-net-02</code>，他们的网段不同，因此是无法彼此<code>ping</code>通容器内部的：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat01 ping tomcat-net-02</span></span><br><span class="line">ping: tomcat-net-02: Name or service not known</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这时需要通过<code>docker network connect</code>命令打通容器与网络之间的连接：<code>docker network connect 网络名 容器名/id</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker network connect --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker network connect [OPTIONS] NETWORK CONTAINER</span><br><span class="line"></span><br><span class="line">Connect a container to a network</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --<span class="built_in">alias</span> strings           Add network-scoped <span class="built_in">alias</span> <span class="keyword">for</span> the container</span><br><span class="line">      --driver-opt strings      driver options <span class="keyword">for</span> the network</span><br><span class="line">      --ip string               IPv4 address (e.g., 172.30.100.104)</span><br><span class="line">      --ip6 string              IPv6 address (e.g., 2001:db8::33)</span><br><span class="line">      --<span class="built_in">link</span> list               Add <span class="built_in">link</span> to another container</span><br><span class="line">      --link-local-ip strings   Add a link-local address <span class="keyword">for</span> the container</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="连接-1"><a href="#连接-1" class="headerlink" title="连接"></a>连接</h3><ol><li>使用<code>docker network connect</code>将容器和网络联通<br> 可以发现容器<code>tomcat01</code>有两个<code>ip</code>地址，就好比阿里云服务器：公网<code>ip</code>和私网<code>ip</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker network connect mynet tomcat01</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker network inspect mynet</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;mynet&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;f21a60d02f90fd464ce95db06c8a7ea4c7895a17c9d282208a6f773d52d0f2dc&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-11-02T11:29:54.296389266+08:00&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Scope&quot;</span>: <span class="string">&quot;local&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;bridge&quot;</span>,</span><br><span class="line">        <span class="string">&quot;EnableIPv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;IPAM&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;Config&quot;</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="string">&quot;Subnet&quot;</span>: <span class="string">&quot;192.168.0.0/16&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;192.168.0.1&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Internal&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Attachable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Ingress&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;ConfigFrom&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Network&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;ConfigOnly&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&quot;Containers&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;3246acdb17e3363a725c8a930c83ffdd634e086846a8445a88b04765f12c2cac&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;4d6c7d3af887105c3211c911b05d34eecebb9774ec01053d7eba93f28e171fac&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.2/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;8f3db1f3d2132c98d960da9dba551a309d6e0c26e5b87a1cfd48a29a5c65612a&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat-net-02&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;d0391a5a208420f2ce935a78f7031b612085519bb94eb8cb7b7af8de8bddd7c1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:03&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.3/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">             <span class="comment"># 发现此处多了一个容器，即 tomcat01，它有两个地址，一个在网络 docker0，一个在是 mynet</span></span><br><span class="line">            <span class="string">&quot;b8f8e90162f789577b678ea020e54e5e091b62081b2ed34580288761b1c6c55a&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;tomcat01&quot;</span>,</span><br><span class="line">                <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;32d7e1c2fc6773e2704262ab2926047008b8f09fe8a426419e870e26063685be&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:04&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;192.168.0.4/16&quot;</span>,</span><br><span class="line">                <span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>再次测试两者之间的联通情况：成功<code>ping</code>通，相互均可访问 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec tomcat01 ping tomcat-net-02</span></span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.107 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=4 ttl=64 time=0.048 ms</span><br><span class="line">^C</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker exec tomcat-net-01 ping tomcat01</span></span><br><span class="line">PING tomcat01 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.4): icmp_seq=1 ttl=64 time=0.076 ms</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.4): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line"></span><br><span class="line"><span class="comment"># tomcat02 依旧打不通</span></span><br><span class="line">[root@localhost /]<span class="comment"># docker exec -it tomcat-net-01 ping tomcat02</span></span><br><span class="line">ping: tomcat02: Temporary failure <span class="keyword">in</span> name resolution</span><br></pre></td></tr></table></figure></li></ol><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>假设要跨网操作，就需要使用<code>docker network connect</code>连通。</p><h2 id="部署-Redis-集群"><a href="#部署-Redis-集群" class="headerlink" title="部署 Redis 集群"></a>部署 Redis 集群</h2><p>优点：快速部署，高可用，主机故障后从机可以使用。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635729252/1639728604-8d2decfa.png"></p></div><ol><li>创建网卡   <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost redis]<span class="comment"># docker network create redis --subnet 172.38.0.0/16</span></span><br><span class="line">74feee91cddf96bc654464db39700a317f5265c18c0a5d30d5147ec06f6e6dd9</span><br><span class="line">[root@localhost redis]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>准备<code>shell</code>脚本，通过脚本创建六个<code>redis</code>配置<ul><li>准备<code>shell</code>脚本<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly ye</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li><li>通过脚本创建六个<code>redis</code>配置<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># for port in $(seq 1 6);\</span></span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line"><span class="built_in">mkdir</span> -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span><br><span class="line"><span class="built_in">touch</span> /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span><br><span class="line"><span class="string">port 6379</span></span><br><span class="line"><span class="string">bind 0.0.0.0</span></span><br><span class="line"><span class="string">cluster-enabled yes</span></span><br><span class="line"><span class="string">cluster-config-file nodes.conf</span></span><br><span class="line"><span class="string">cluster-node-timeout 5000</span></span><br><span class="line"><span class="string">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span></span><br><span class="line"><span class="string">cluster-announce-port 6379</span></span><br><span class="line"><span class="string">cluster-announce-bus-port 16379</span></span><br><span class="line"><span class="string">appendonly ye</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cd /mydata/redis/</span></span><br><span class="line">[root@localhost redis]<span class="comment"># ls</span></span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line">[root@localhost redis]<span class="comment"># cat node-1/conf/redis.conf</span></span><br><span class="line">port 6379</span><br><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.11</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly ye</span><br><span class="line">[root@localhost redis]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li><li>准备<code>shell</code>脚本，通过脚本创建六个<code>redis</code>容器<ul><li>准备<code>shell</code>脚本<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker run -d -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf;  </span><br><span class="line">done</span><br></pre></td></tr></table></figure></li><li>通过脚本创建六个<code>redis</code>容器<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost home]<span class="comment"># for port in $(seq 1 6);\</span></span><br><span class="line"><span class="keyword">do</span> \</span><br><span class="line">docker run -p 637<span class="variable">$&#123;port&#125;</span>:6379 -p 1637<span class="variable">$&#123;port&#125;</span>:16379 --name redis-<span class="variable">$&#123;port&#125;</span> \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/data:/data \</span><br><span class="line">-v /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1<span class="variable">$&#123;port&#125;</span> redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">Unable to find image <span class="string">&#x27;redis:5.0.9-alpine3.11&#x27;</span> locally</span><br><span class="line">5.0.9-alpine3.11: Pulling from library/redis</span><br><span class="line">cbdbe7a5bc2a: Already exists</span><br><span class="line">dc0373118a0d: Already exists</span><br><span class="line">cfd369fe6256: Already exists</span><br><span class="line">3e45770272d9: Already exists</span><br><span class="line">558de8ea3153: Already exists</span><br><span class="line">a2c652551612: Already exists</span><br><span class="line">Digest: sha256:83a3af36d5e57f2901b4783c313720e5fa3ecf0424ba86ad9775e06a9a5e35d0</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> redis:5.0.9-alpine3.11</span><br><span class="line">b6cc24c4e437bb76adb626d410f3e0a28e0e4b7b664aee512846413c9e57a7b8</span><br><span class="line">c0dc8e64df033dd763bfe840fe5421e4e181960ef66e0d41088529a3a363b7ab</span><br><span class="line">3889a96d8939cfbcd90b02588a8ebe22a06f9ed1954d61b47768d46723bbd477</span><br><span class="line">b6e5081783943a7c3e29770903a37d637b612b5c59a7161af3cedcd883f1f490</span><br><span class="line">8c0727fad4a4cb44387f88f9067029a248645f7df757867502e1d771c098ced4</span><br><span class="line">e74d9e9633bd4e9546c2201af3d68cdc33888317142cad911267f44bc933161a</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul></li><li>创建集群 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it redis-1 /bin/sh</span></span><br><span class="line">[root@b6cc24c4e data]<span class="comment"># redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span></span><br></pre></td></tr></table></figure></li><li>连接集群 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@b6cc24c4e data]<span class="comment"># redis-cli -c</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br></pre></td></tr></table></figure></li><li>测试 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> a b</span><br></pre></td></tr></table></figure></li><li>主服务器宕机测试 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    ```</span><br><span class="line"></span><br><span class="line"><span class="comment"># Springboot 微服务打包镜像</span></span><br><span class="line"></span><br><span class="line">1. 构建`Springboot`项目并打包为`jar`包：`demo-0.0.1-SNAPSHOT.jar`</span><br><span class="line">2. 创建`Dockerfile`</span><br><span class="line">    ```bash</span><br><span class="line">    FROM java:8</span><br><span class="line"></span><br><span class="line">    COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">    CMD [<span class="string">&quot;server.port=8080&quot;</span>]</span><br><span class="line"></span><br><span class="line">    EXPOSE 8080</span><br><span class="line"></span><br><span class="line">    ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span><br></pre></td></tr></table></figure></li><li>生成镜像 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost idea]<span class="comment"># ls</span></span><br><span class="line">demo-0.0.1-SNAPSHOT.jar  Dockerfile</span><br><span class="line">[root@localhost idea]<span class="comment"># docker build -t demo.</span></span><br><span class="line">Sending build context to Docker daemon  17.64MB</span><br><span class="line">Step 1/5 : FROM java:8</span><br><span class="line">8: Pulling from library/java</span><br><span class="line">5040bd298390: Pull complete </span><br><span class="line">fce5728aad85: Pull complete </span><br><span class="line">76610ec20bf5: Pull complete </span><br><span class="line">60170fec2151: Pull complete </span><br><span class="line">e98f73de8f0d: Pull complete </span><br><span class="line">11f7af24ed9c: Pull complete </span><br><span class="line">49e2d6393f32: Pull complete </span><br><span class="line">bb9cdec9c7f3: Pull complete </span><br><span class="line">Digest: sha256:c1ff613e8ba25833d2e1940da0940c3824f03f802c449f3d1815a66b7f8c0e9d</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> java:8</span><br><span class="line"> ---&gt; d23bdf5b1b1b</span><br><span class="line">Step 2/5 : COPY *.jar /app.jar</span><br><span class="line"> ---&gt; e42a797c0b05</span><br><span class="line">Step 3/5 : CMD [<span class="string">&quot;--server.port=8080&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 03599b100a83</span><br><span class="line">Removing intermediate container 03599b100a83</span><br><span class="line"> ---&gt; 13ec0d67a13b</span><br><span class="line">Step 4/5 : EXPOSE 8080</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> b3ba4dbc3fef</span><br><span class="line">Removing intermediate container b3ba4dbc3fef</span><br><span class="line"> ---&gt; 00af26b78234</span><br><span class="line">Step 5/5 : ENTRYPOINT [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> b6e654da4ebe</span><br><span class="line">Removing intermediate container b6e654da4ebe</span><br><span class="line"> ---&gt; c8a4d6157a3c</span><br><span class="line">Successfully built c8a4d6157a3c</span><br><span class="line">Successfully tagged demo:latest</span><br><span class="line">[root@localhost idea]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">demo          latest    c8a4d6157a3c   56 seconds ago   661MB</span><br><span class="line">tomcat        latest    bd431ca8553c   7 days ago       667MB</span><br><span class="line">hello-world   latest    d1165f221234   6 weeks ago      13.3kB</span><br><span class="line">java          8         d23bdf5b1b1b   4 years ago      643MB</span><br></pre></td></tr></table></figure></li><li>发布运行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost idea]<span class="comment"># docker run -d -P --name idea-hello demo</span></span><br><span class="line">4121f0b3b285bf7035302a6c54386423fc8c59179abde75038c4c7b51a8e23fd</span><br><span class="line">[root@kk idea]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED             STATUS             PORTS                                         NAMES</span><br><span class="line">4121f0b3b285   my-idea-demo   <span class="string">&quot;java -jar /app.jar …&quot;</span>   17 seconds ago      Up 12 seconds      0.0.0.0:49160-&gt;8080/tcp, :::49160-&gt;8080/tcp   idea-hello</span><br></pre></td></tr></table></figure></li><li>访问 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost idea]<span class="comment"># curl localhost:49160</span></span><br><span class="line">hello,docker...</span><br><span class="line">[root@localhost idea]<span class="comment"># curl localhost:49160/hello</span></span><br><span class="line">&#123;<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2021-04-16T14:28:24.866+00:00&quot;</span>,<span class="string">&quot;status&quot;</span>:404,<span class="string">&quot;error&quot;</span>:<span class="string">&quot;Not Found&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;/hello&quot;</span>&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockcer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>镜像与容器</title>
      <link href="/2021/10/26/docker/01.%E9%95%9C%E5%83%8F%E4%B8%8E%E5%AE%B9%E5%99%A8/"/>
      <url>/2021/10/26/docker/01.%E9%95%9C%E5%83%8F%E4%B8%8E%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><code>Docker</code>是一个开源的应用容器引擎，基于<code>Go</code>语言并遵从<code>Apache2.0</code>协议开源。</p><p><code>Docker</code>可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的<code>Linux</code>机器上，也可以实现虚拟化。</p><p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似<code>iPhone</code>的<code>app</code>）,更重要的是容器性能开销极低。</p><p><code>Docker</code>从 $17.03$ 版本之后分为<code>CE</code>（<code>Community Edition</code>：社区版） 和<code>EE</code>（<code>Enterprise Edition</code>：企业版），一般用社区版就可以了。</p><p><a href="https://docs.docker.com/">官网</a>：<code>https://docs.docker.com/</code>。</p><h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul><li><code>Web</code>应用的自动化打包和发布</li><li>自动化测试和持续集成、发布</li><li>在服务型环境中部署和调整数据库或其他的后台应用</li><li>从头编译或者扩展现有的<code>OpenShift</code>或<code>Cloud Foundry</code>平台来搭建自己的<code>PaaS</code>环境</li></ul><h2 id="Docker-的优势"><a href="#Docker-的优势" class="headerlink" title="Docker 的优势"></a>Docker 的优势</h2><p><code>Docker</code>是一个用于开发，交付和运行应用程序的开放平台。<code>Docker</code>能够将应用程序与基础架构分开，从而可以快速交付软件。借助<code>Docker</code>，可以与管理应用程序相同的方式来管理基础架构。通过利用<code>Docker</code>的方法来快速交付，测试和部署代码，可以大大减少编写代码和在生产环境中运行代码之间的延迟。</p><ol><li>快速，一致地交付您的应用程序。<br> <code>Docker</code>允许开发人员使用提供的应用程序或服务的本地容器在标准化环境中工作，从而简化了开发的生命周期。<br> 容器非常适合持续集成和持续交付（<code>CI / CD</code>）工作流程，考虑以下示例方案：<br> 开发人员在本地编写代码，并使用 Docker 容器与同事共享他们的工作。他们使用<code>Docker</code>将其应用程序推送到测试环境中，并执行自动或手动测试。<br> 当开发人员发现错误时，他们可以在开发环境中对其进行修复，然后将其重新部署到测试环境中，以进行测试和验证。<br> 测试完成后，将修补程序推送给生产环境，就像将更新的镜像推送到生产环境一样简单。</li><li>响应式部署和扩展<br> <code>Docker</code>是基于容器的平台，允许高度可移植的工作负载。<code>Docker</code>容器可以在开发人员的本机上，数据中心的物理或虚拟机上，云服务上或混合环境中运行。<br> <code>Docker</code>的可移植性和轻量级的特性，还可以轻松地完成动态管理的工作负担，并根据业务需求指示，实时扩展或拆除应用程序和服务。</li><li>在同一硬件上运行更多工作负载<br> <code>Docker</code>轻巧快速。它为基于虚拟机管理程序的虚拟机提供了可行、经济、高效的替代方案，因此您可以利用更多的计算能力来实现业务目标。<br> <code>Docker</code>非常适合于高密度环境以及中小型部署，可以用更少的资源做更多的事情。</li></ol><h1 id="虚拟化技术和容器化技术"><a href="#虚拟化技术和容器化技术" class="headerlink" title="虚拟化技术和容器化技术"></a>虚拟化技术和容器化技术</h1><h2 id="容器化技术"><a href="#容器化技术" class="headerlink" title="容器化技术"></a>容器化技术</h2><h3 id="容器官方解释"><a href="#容器官方解释" class="headerlink" title="容器官方解释"></a>容器官方解释</h3><p>一句话概括容器：容器就是将软件打包成标准化单元，以用于开发、交付和部署。</p><ul><li>容器镜像是轻量的、可执行的独立软件包，包含软件运行所需的所有内容：代码、运行时环境、系统工具、系统库和设置。</li><li>容器化软件适用于基于<code>Linux</code>和<code>Windows</code>的应用，在任何环境中都能够始终如一地运行。</li><li>容器赋予了软件独立性，使其免受外在环境差异（例如，开发和预演环境的差异）的影响，从而有助于减少团队间在相同基础设施上运行不同软件时的冲突。</li></ul><h3 id="容器通俗解释"><a href="#容器通俗解释" class="headerlink" title="容器通俗解释"></a>容器通俗解释</h3><p>容器化技术不是模拟的一个完整的操作系统。</p><p>通俗地描述容器，容器就是一个存放东西的地方，就像书包可以装各种文具、衣柜可以放各种衣服、鞋架可以放各种鞋子一样。现在所说的容器存放的东西可能更偏向于应用比如网站、程序甚至是系统环境。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639726617-7503696c.png"></p></div><h2 id="虚拟化技术"><a href="#虚拟化技术" class="headerlink" title="虚拟化技术"></a>虚拟化技术</h2><p><code>Docker</code>容器虚拟化技术为基础的软件，什么是虚拟化技术呢？</p><p>简单的说，虚拟化技术可以这样定义：</p><blockquote><p>虚拟化技术是一种资源管理技术，是将计算机的各种实体资源（<code>CPU</code>、内存、磁盘空间、网络适配器等），予以抽象、转换后呈现出来并可供分割、组合为一个或多个电脑配置环境。由此，打破实体结构间的不可切割的障碍，使用户可以比原本的配置更好的方式来应用这些电脑硬件资源。这些资源的新虚拟部分是不受现有资源的架设方式，地域或物理配置所限制。一般所指的虚拟化资源包括计算能力和数据存储。</p></blockquote><p>虚拟化技术特点：</p><ol><li>资源占用多</li><li>冗余步骤多</li><li>启动很慢</li></ol><h2 id="Docker-基于-LXC-虚拟容器技术"><a href="#Docker-基于-LXC-虚拟容器技术" class="headerlink" title="Docker 基于 LXC 虚拟容器技术"></a>Docker 基于 LXC 虚拟容器技术</h2><p><code>Docker</code>技术是基于<code>LXC</code>（<code>Linux container</code>：<code>Linux</code>容器）虚拟容器技术的。</p><blockquote><p><code>LXC</code>，其名称来自<code>Linux</code>软件容器（<code>Linux Containers</code>）的缩写，一种操作系统层虚拟化（<code>Operating system–level virtualization</code>）技术，为<code>Linux</code>内核容器功能的一个用户空间接口。它将应用软件系统打包成一个软件容器（<code>Container</code>），内含应用软件本身的代码，以及所需要的操作系统核心和库。通过统一的名字空间和共用<code>API</code>来分配不同软件容器的可用硬件资源，创造出应用程序的独立沙箱运行环境，使得<code>Linux</code>用户可以容易的创建和管理系统或应用容器。</p></blockquote><p><code>LXC</code>技术主要是借助<code>Linux</code>内核中提供的<code>CGroup</code>功能和<code>namespace</code>来实现的，通过<code>LXC</code>可以为软件提供一个独立的操作系统运行环境。</p><p><code>Docker</code>和虚拟机的不同：</p><ol><li>传统虚拟机，虚拟出硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</li><li><code>Docker</code>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟硬件。</li><li>每个容器都是相互隔离的，每个容器都有属于自己的文件系统，互不影响。</li></ol><h3 id="cgroup-和-namespace"><a href="#cgroup-和-namespace" class="headerlink" title="cgroup 和 namespace"></a>cgroup 和 namespace</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><ul><li><code>namespace</code>是<code>Linux</code>内核用来隔离内核资源的方式。 通过<code>namespace</code>可以让一些进程只能看到与自己相关的一部分资源，而另外一些进程也只能看到与它们自己相关的资源，这两拨进程根本就感觉不到对方的存在。具体的实现方式是把一个或多个进程的相关资源指定在同一个<code>namespace</code>中。<code>Linux namespaces</code>是对全局系统资源的一种封装隔离，使得处于不同<code>namespace</code>的进程拥有独立的全局系统资源，改变一个<code>namespace</code>中的系统资源只会影响当前 <code>namespace</code>里的进程，对其他<code>namespace</code>中的进程没有影响。<br>（更多关于<code>namespace</code>的呢内容可以查看”Namespace 简介”[^1]）</li><li><code>CGroup</code>是<code>Control Groups</code>的缩写，是<code>Linux</code>内核提供的一种可以限制、记录、隔离进程组 （<code>process groups</code>）所使用的物力资源（如<code>cpu</code>、<code>memory</code>、<code>i/o</code>等）的机制。</li></ul><h4 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h4><p>两者都是将进程进行分组，但是两者的作用还是有本质区别。<code>namespace</code>是为了隔离进程组之间的资源，而<code>cgroup</code>是为了对一组进程进行统一的资源监控和限制。</p><h3 id="容器化的好处"><a href="#容器化的好处" class="headerlink" title="容器化的好处"></a>容器化的好处</h3><ol><li>应用更快速的交互和部署<ul><li>传统：一堆帮助文档，安装程序</li><li><code>Docker</code>：打包镜像发布测试，一键运行</li></ul></li><li>更便捷的升级和扩容<br> 使用<code>Docker</code>之后，项目打包为一个镜像，部署应用就像搭积木一样</li><li>更简单的系统运维<br> 在容器化之后，开发、测试环境都是高度统一的</li><li>更高效的计算资源利用<br> <code>Docker</code>是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例，服务器的性能可以被压榨到极致</li></ol><h1 id="Docker-基本组成"><a href="#Docker-基本组成" class="headerlink" title="Docker 基本组成"></a>Docker 基本组成</h1><p><code>Docker</code>中有非常重要的三个基本概念，理解了这三个概念，就理解了<code>Docker</code>的整个生命周期。</p><ul><li>镜像（<code>Image</code>）<br><code>Docker</code>镜像就好比是一个模板，可以通过这个模板来创建容器服务，运行<code>tomcat</code>镜像 ===&gt; <code>tomcat01</code>容器提供<code>web</code>服务器服务</li><li>容器（<code>Container</code>）<br><code>Docker</code>利用容器技术，独立运行一个或者一组通过镜像创建的应用</li><li>仓库（<code>Repository</code>）<ul><li>仓库就是存放镜像的地方</li><li>仓库分为公有仓库（<code>Docker Hub</code>）和私有仓库</li></ul></li></ul><h1 id="Docker-的安装与卸载"><a href="#Docker-的安装与卸载" class="headerlink" title="Docker 的安装与卸载"></a>Docker 的安装与卸载</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol><li><p>查看系统内核和系统信息</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看系统内核版本</span></span><br><span class="line"><span class="built_in">uname</span> -r   </span><br><span class="line"><span class="comment"># 查看系统版本</span></span><br><span class="line"><span class="built_in">cat</span> /etc/os-release</span><br></pre></td></tr></table></figure></li><li><p>卸载旧版本</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">           docker-client \</span><br><span class="line">           docker-client-latest \</span><br><span class="line">           docker-common \</span><br><span class="line">           docker-latest \</span><br><span class="line">           docker-latest-logrotate \</span><br><span class="line">           docker-logrotate \</span><br><span class="line">           docker-engine</span><br></pre></td></tr></table></figure></li><li><p>下载依赖安装包</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure></li><li><p>配置镜像仓库</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 国外的地址</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置阿里云的Docker镜像仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></li><li><p>更新<code>yum</code>软件包</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum makecache</span><br></pre></td></tr></table></figure></li><li><p>下载<code>Docker</code></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装社区版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io   </span><br><span class="line"><span class="comment"># 安装企业版</span></span><br><span class="line">yum install docker-ee docker-ee-cli containerd.io </span><br></pre></td></tr></table></figure><p> 一般情况下安装社区版</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CentOS 8 安装 Docker 会和 podman 冲突</span></span><br><span class="line">yum erase podman buildah</span><br></pre></td></tr></table></figure></li><li><p>启动<code>Docker</code></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 Docker</span></span><br><span class="line">systemctl start docker   </span><br><span class="line"><span class="comment"># 查看当前版本号，是否启动成功</span></span><br><span class="line">docker version   </span><br><span class="line"><span class="comment"># 设置开机自启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker  </span><br></pre></td></tr></table></figure></li><li><p><code>Docker</code>的<code>HelloWorld</code></p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br><span class="line"><span class="comment"># 查看下载的hello world镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure></li></ol><h2 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 卸载依赖</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io  </span><br><span class="line"><span class="comment"># 删除资源  . /var/lib/docker 是 docker 的默认工作路径</span></span><br><span class="line"><span class="built_in">rm</span> -rf /var/lib/docker   </span><br></pre></td></tr></table></figure><h2 id="Docker-容器运行流程和原理"><a href="#Docker-容器运行流程和原理" class="headerlink" title="Docker 容器运行流程和原理"></a>Docker 容器运行流程和原理</h2><h3 id="运行流程"><a href="#运行流程" class="headerlink" title="运行流程"></a>运行流程</h3><p>启动一个容器，<code>Docker</code>的运行流程如下图：</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639726767-6adcda81.png"></p></div><h2 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h2><p><code>Docker</code>是一个<code>Client-Server</code>结构的系统，<code>Docker</code>的守护进程运行在主机上，通过<code>Socker</code>从客户端访问！<code>Docker Server</code>接收到<code>Docker-Client</code>的指令，就会执行这个指令！</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639726823-8afc62d6.png"></p></div><h3 id="Docker-整体架构"><a href="#Docker-整体架构" class="headerlink" title="Docker 整体架构"></a>Docker 整体架构</h3><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639726844-2cd2733e.png">v</p></div><p><code>Docker</code>为什么比<code>VM Ware</code>快？</p><ol><li><code>Docker</code>比虚拟机更少的抽象层</li><li><code>Docker</code>利用宿主机的内核，<code>VM</code>需要的是<code>Guest OS</code></li></ol><p><code>Docker</code>新建一个容器的时候，不需要像虚拟机一样重新加载一个操作系统内核，直接利用宿主机的操作系统，而虚拟机是需要加载<code>Guest OS</code>。<code>Docker</code>和<code>VM</code>的对比如下：</p><table><thead><tr><th></th><th>Docker 容器</th><th>LXC</th><th>VM</th></tr></thead><tbody><tr><td>虚拟化类型</td><td><code>OS</code>虚拟化</td><td><code>OS</code>虚拟化</td><td>硬件虚拟化</td></tr><tr><td>性能</td><td>物理机性能</td><td>物理机性能</td><td>$5 %-20 %$损耗</td></tr><tr><td>隔离性</td><td><code>NS</code>隔离</td><td><code>NS</code>隔离</td><td>强</td></tr><tr><td><code>Qos</code></td><td><code>Cgroup</code>弱</td><td><code>Cgroup</code>弱</td><td>强</td></tr><tr><td>安全性</td><td>中</td><td>差</td><td>强</td></tr><tr><td><code>GuestOS</code></td><td>只支持<code>Linux</code></td><td>只支持<code>Linux</code></td><td>全部</td></tr></tbody></table><h1 id="配置阿里云镜像"><a href="#配置阿里云镜像" class="headerlink" title="配置阿里云镜像"></a>配置阿里云镜像</h1><ol><li>进入阿里云官网，搜索容器镜像服务</li><li>执行命令 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /etc/docker</span><br><span class="line">sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://axvfsf7e.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></li></ol><h1 id="Docker-常用命令"><a href="#Docker-常用命令" class="headerlink" title="Docker 常用命令"></a>Docker 常用命令</h1><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ol><li>查看<code>Docker</code>的版本信息：<code>docker version</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker version</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.10</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.16.9</span><br><span class="line"> Git commit:        b485636</span><br><span class="line"> Built:             Mon Oct 25 07:42:56 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.10</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.16.9</span><br><span class="line">  Git commit:       e2f740d</span><br><span class="line">  Built:            Mon Oct 25 07:41:17 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.11</span><br><span class="line">  GitCommit:        5b46e404f6b9f661a205e28d59c982d3634148f8</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.2</span><br><span class="line">  GitCommit:        v1.0.2-0-g52b36a2</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure></li><li>查看<code>Docker</code>的系统信息，包括镜像和容器的数量：<code>docker info</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker info</span></span><br><span class="line">Client:</span><br><span class="line"> Context:    default</span><br><span class="line"> Debug Mode: <span class="literal">false</span></span><br><span class="line"> Plugins:</span><br><span class="line">  app: Docker App (Docker Inc., v0.9.1-beta3)</span><br><span class="line">  buildx: Build with BuildKit (Docker Inc., v0.6.3-docker)</span><br><span class="line">  scan: Docker Scan (Docker Inc., v0.9.0)</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Containers: 1</span><br><span class="line">  Running: 0</span><br><span class="line">  Paused: 0</span><br><span class="line">  Stopped: 1</span><br><span class="line"> Images: 2</span><br><span class="line"> Server Version: 20.10.10</span><br><span class="line"> Storage Driver: overlay2</span><br><span class="line">  Backing Filesystem: xfs</span><br><span class="line">  Supports d_type: <span class="literal">true</span></span><br><span class="line">  Native Overlay Diff: <span class="literal">true</span></span><br><span class="line">  userxattr: <span class="literal">false</span></span><br><span class="line"> Logging Driver: json-file</span><br><span class="line"> Cgroup Driver: cgroupfs</span><br><span class="line"> Cgroup Version: 1</span><br><span class="line"> Plugins:</span><br><span class="line">  Volume: <span class="built_in">local</span></span><br><span class="line">  Network: bridge host ipvlan macvlan null overlay</span><br><span class="line">  Log: awslogs fluentd gcplogs gelf journald json-file <span class="built_in">local</span> logentries splunk syslog</span><br><span class="line"> Swarm: inactive</span><br><span class="line"> Runtimes: io.containerd.runc.v2 io.containerd.runtime.v1.linux runc</span><br><span class="line"> Default Runtime: runc</span><br><span class="line"> Init Binary: docker-init</span><br><span class="line"> containerd version: 5b46e404f6b9f661a205e28d59c982d3634148f8</span><br><span class="line"> runc version: v1.0.2-0-g52b36a2</span><br><span class="line"> init version: de40ad0</span><br><span class="line"> Security Options:</span><br><span class="line">  seccomp</span><br><span class="line">   Profile: default</span><br><span class="line"> Kernel Version: 4.18.0-305.19.1.el8_4.x86_64</span><br><span class="line"> Operating System: CentOS Linux 8</span><br><span class="line"> OSType: linux</span><br><span class="line"> Architecture: x86_64</span><br><span class="line"> CPUs: 2</span><br><span class="line"> Total Memory: 1.748GiB</span><br><span class="line"> Name: localhost.localdomain</span><br><span class="line"> ID: B5XT:RYL7:BWKX:PBVC:P4UM:VECG:ITI7:S4GJ:J3GP:DR5E:KXT7:III4</span><br><span class="line"> Docker Root Dir: /var/lib/docker</span><br><span class="line"> Debug Mode: <span class="literal">false</span></span><br><span class="line"> Registry: https://index.docker.io/v1/</span><br><span class="line"> Labels:</span><br><span class="line"> Experimental: <span class="literal">false</span></span><br><span class="line"> Insecure Registries:</span><br><span class="line">  127.0.0.0/8</span><br><span class="line"> Registry Mirrors:</span><br><span class="line">  https://axvfsf7e.mirror.aliyuncs.com/</span><br><span class="line"> Live Restore Enabled: <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li>帮助命令（可查看可选的参数）：<code>docker 命令 --help</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker info --help</span></span><br><span class="line">Usage:  docker info [OPTIONS]</span><br><span class="line">Display system-wide information</span><br><span class="line">Options:</span><br><span class="line">  -f, --format string   Format the output using the given Go template</span><br></pre></td></tr></table></figure></li></ol><p>命令<a href="https://docs.docker.com/engine/reference/commandline/docker/">帮助文档</a>：<code>https://docs.docker.com/engine/reference/commandline/docker/</code>。</p><h2 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h2><h3 id="查看本地主机的所有镜像"><a href="#查看本地主机的所有镜像" class="headerlink" title="查看本地主机的所有镜像"></a>查看本地主机的所有镜像</h3><p><code>docker images</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   5 months ago   13.3kB</span><br></pre></td></tr></table></figure><p>列表参数介绍：</p><ul><li><code>REPOSITORY</code>： 镜像的仓库源</li><li><code>TAG</code>：镜像的标签</li><li><code>IMAGE ID</code>：镜像的<code>id</code></li><li><code>CREATED</code>：镜像的创建时间</li><li><code>SIZE</code>：镜像的大小</li></ul><p>可选参数：</p><ul><li><code>-a/--all</code>：列出所有镜像</li><li><code>-q/--quiet</code>：只显示镜像的<code>id</code></li></ul><h3 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h3><p><code>docker search</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search mysql</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relation…   10308     [OK]</span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MyS…   3819      [OK]</span><br><span class="line">mysql/mysql-server                Optimized MySQL Server Docker images. Create…   754                  [OK]</span><br><span class="line">percona                           Percona Server is a fork of the MySQL relati…   517       [OK]</span><br><span class="line">centos/mysql-57-centos7           MySQL 5.7 SQL database server                   86</span><br><span class="line">mysql/mysql-cluster               Experimental MySQL Cluster Docker images. Cr…   79</span><br><span class="line">centurylink/mysql                 Image containing mysql. Optimized to be <span class="built_in">link</span>…   60                   [OK]</span><br></pre></td></tr></table></figure><p>可选参数：</p><ul><li><code>-f, --filter filter</code>：根据提供的条件过滤输出<ul><li>搜索收藏数大于 $3000$ 的镜像<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search mysql --filter=STARS=3000</span></span><br><span class="line">NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql     MySQL is a widely used, open-source relation…   11603     [OK]</span><br><span class="line">mariadb   MariaDB Server is a high performing open sou…   4414      [OK]</span><br></pre></td></tr></table></figure></li></ul></li><li><code>--format string</code>：使用<code>Go</code>模板的漂亮打印搜索</li><li><code>--limit int</code>：最大搜索结果数量（默认为 $25$）</li><li><code>--no-trunc</code>：不截断输出</li></ul><h3 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h3><p><code>docker pull 镜像名[:tag]</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果不写 tag 默认就是 latest，写上 tag 就下载指定版本</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker pull mysql:5.7</span></span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line"><span class="comment"># 分层下载，docker image 的核心-联合文件系统</span></span><br><span class="line">33847f680f63: Pull complete </span><br><span class="line">5cb67864e624: Pull complete </span><br><span class="line">1a2b594783f5: Pull complete </span><br><span class="line">b30e406dd925: Pull complete </span><br><span class="line">48901e306e4c: Pull complete </span><br><span class="line">603d2b7147fd: Pull complete </span><br><span class="line">802aa684c1c4: Pull complete </span><br><span class="line">5b5a19178915: Pull complete </span><br><span class="line">f9ce7411c6e4: Pull complete </span><br><span class="line">f51f6977d9b2: Pull complete </span><br><span class="line">aeb6b16ce012: Pull complete </span><br><span class="line">Digest: sha256:be70d18aedc37927293e7947c8de41ae6490ecd4c79df1db40d1b5b5af7d9596</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure><h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p><code>docker rmi</code></p><ol><li>查看镜像<ul><li>查看全部镜像<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">mysql         5.7       938b57d64674   10 days ago   448MB</span><br><span class="line">hello-world   latest    feb5d9fea6a5   5 weeks ago   13.3kB</span><br></pre></td></tr></table></figure></li><li>查看全部镜像（只显示<code>id</code>）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker images -aq</span></span><br><span class="line">938b57d64674</span><br><span class="line">feb5d9fea6a5</span><br></pre></td></tr></table></figure></li></ul></li><li>删除镜像<ul><li>删除指定的镜像<code>id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi -f  镜像id</span></span><br></pre></td></tr></table></figure></li><li>删除多个镜像<code>id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi -f  镜像id 镜像id 镜像id</span></span><br></pre></td></tr></table></figure></li><li>删除全部的镜像<code>id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker rmi -f  $(docker images -aq)</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h2><h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><p><code>docker run [可选参数] image</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]<span class="comment"># docker run 8cf625070931</span></span><br><span class="line">2021-08-03 06:48:07+00:00 [Note] [Entrypoint]: Entrypoint script <span class="keyword">for</span> MySQL Server 5.7.35-1debian10 started.</span><br><span class="line">2021-08-03 06:48:07+00:00 [Note] [Entrypoint]: Switching to dedicated user <span class="string">&#x27;mysql&#x27;</span></span><br><span class="line">2021-08-03 06:48:07+00:00 [Note] [Entrypoint]: Entrypoint script <span class="keyword">for</span> MySQL Server 5.7.35-1debian10 started.</span><br><span class="line">2021-08-03 06:48:07+00:00 [ERROR] [Entrypoint]: Database is uninitialized and password option is not specified</span><br><span class="line">    You need to specify one of the following:</span><br><span class="line">    - MYSQL_ROOT_PASSWORD</span><br><span class="line">    - MYSQL_ALLOW_EMPTY_PASSWORD</span><br><span class="line">    - MYSQL_RANDOM_ROOT_PASSWORD</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>--name=&quot;名字&quot;</code>：指定容器名字</li><li><code>-d</code>：后台方式运行</li><li><code>-it</code>：使用交互方式运行,进入容器查看内容</li><li><code>-p</code>：指定容器的端口<ul><li><code>-p ip:主机端口:容器端口</code>： 配置主机端口映射到容器端口<ul><li>简化版：<code>-p 主机端口:容器端口</code>或<code>-p 容器端口</code></li></ul></li></ul></li><li><code>-P</code>：随机指定端口（大写的<code>P</code>）<br /></li></ul><h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><p><code>docker run</code></p><p><code>docker run -it [容器ID] /bin/bash</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># </span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -it centos /bin/bash</span></span><br><span class="line">Unable to find image <span class="string">&#x27;centos:latest&#x27;</span> locally</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">a1d0c7532777: Pull complete</span><br><span class="line">Digest: sha256:a27fd8080b517143cbbbab9dfb7c8571c40d67d534bbdee55bd6c473f432b177</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> centos:latest</span><br><span class="line">[root@25027261f0db /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@25027261f0db /]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h3><ul><li><code>exit</code>：停止并退出容器（后台方式运行则仅退出）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@950ba2403e4c /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@950ba2403e4c /]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><code>Ctrl+P+Q</code>：不停止容器，直接退出<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@25027261f0db /]<span class="comment"># [root@localhost ~]#</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="列出容器"><a href="#列出容器" class="headerlink" title="列出容器"></a>列出容器</h3><p><code>docker ps</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">25027261f0db   centos    <span class="string">&quot;/bin/bash&quot;</span>   6 minutes ago   Up 6 minutes             hardcore_galileo</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-a</code>：列出所有容器的运行记录</li><li><code>-n=?</code>：显示最近创建的<code>n</code>个容器</li><li><code>-q</code>：只显示容器的编号</li></ul><h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h3><p><code>docker rm</code></p><ul><li>删除指定的容器，不能删除正在运行的容器，强制删除使用<code>rm -f</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> 容器<span class="built_in">id</span></span><br></pre></td></tr></table></figure></li><li>删除所有的容器<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f $(docker ps -aq)</span><br></pre></td></tr></table></figure></li><li>删除所有的容器<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a -q|xargs docker <span class="built_in">rm</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="启动和重启容器命令"><a href="#启动和重启容器命令" class="headerlink" title="启动和重启容器命令"></a>启动和重启容器命令</h4><ul><li>启动容器：<code>docker start 容器id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker start 25027261f0db</span></span><br><span class="line">25027261f0db</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>重启容器：<code>docker restart 容器id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker restart 25027261f0db</span></span><br><span class="line">25027261f0db</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>停止当前运行的容器：<code>docker stop 容器id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker stop 25027261f0db</span></span><br><span class="line">25027261f0db</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>强制停止当前容器：<code>docker kill 容器id</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker kill 25027261f0db</span></span><br><span class="line">25027261f0db</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><h3 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h3><p><code>docker logs</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker logs --help</span></span><br><span class="line"></span><br><span class="line">Usage:  docker logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">Fetch the logs of a container</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow <span class="built_in">log</span> output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br><span class="line">  -n, --<span class="built_in">tail</span> string    Number of lines to show from the end of the logs (default <span class="string">&quot;all&quot;</span>)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37Z) or relative (e.g. 42m <span class="keyword">for</span> 42 minutes)</span><br></pre></td></tr></table></figure><p>常用：</p><ul><li><code>docker logs -tf 容器id</code></li><li><code>docker logs --tail number 容器id</code><ul><li><code>num</code>为要显示的日志条数</li></ul></li></ul><p><code>Docker</code>容器后台运行必须要有一个前台的进程，否则会自动停止；编写<code>shell</code>脚本循环执行，使<code>centos</code>容器保持运行状态。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d centos /bin/sh -c &quot;while true;do echo hi;sleep 5;done&quot;</span></span><br><span class="line">4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082</span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">4c57edbf7922   centos    <span class="string">&quot;/bin/sh -c &#x27;while t…&quot;</span>   12 seconds ago   Up 11 seconds             xenodochial_lalande</span><br><span class="line">[root@localhost ~]<span class="comment"># docker logs -tf --tail 10 4c57edbf7922</span></span><br><span class="line">2021-10-29T07:12:38.680645208Z hi</span><br><span class="line">2021-10-29T07:12:43.682316339Z hi</span><br><span class="line">2021-10-29T07:12:48.684010465Z hi</span><br><span class="line">2021-10-29T07:12:53.686100268Z hi</span><br><span class="line">2021-10-29T07:12:58.687727415Z hi</span><br><span class="line">2021-10-29T07:13:03.689642682Z hi</span><br><span class="line">2021-10-29T07:13:08.691281535Z hi</span><br><span class="line">2021-10-29T07:13:13.692534177Z hi</span><br><span class="line">2021-10-29T07:13:18.693935678Z hi</span><br><span class="line">2021-10-29T07:13:23.695554000Z hi</span><br><span class="line">^C</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="查看容器中进程信息"><a href="#查看容器中进程信息" class="headerlink" title="查看容器中进程信息"></a>查看容器中进程信息</h3><p><code>docker top</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker top 4c57edbf7922</span></span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                2523                2504                0                   15:12               ?                   00:00:00            /bin/sh -c <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> hi;<span class="built_in">sleep</span> 5;<span class="keyword">done</span></span><br><span class="line">root                2595                2523                0                   15:14               ?                   00:00:00            /usr/bin/coreutils --coreutils-prog-shebang=<span class="built_in">sleep</span> /usr/bin/sleep 5</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="查看容器的元数据"><a href="#查看容器的元数据" class="headerlink" title="查看容器的元数据"></a>查看容器的元数据</h3><p><code>docker inspect 容器id</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker inspect 4c57edbf7922</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-10-29T07:12:38.500368814Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">            <span class="string">&quot;while true;do echo hi;sleep 5;done&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 2523,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2021-10-29T07:12:38.681818995Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ResolvConfPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082/resolv.conf&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostnamePath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082/hostname&quot;</span>,</span><br><span class="line">        <span class="string">&quot;HostsPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082/hosts&quot;</span>,</span><br><span class="line">        <span class="string">&quot;LogPath&quot;</span>: <span class="string">&quot;/var/lib/docker/containers/4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082/4c57edbf79227f256452ebb719716ed2b4b9dcd5170fce1a8a1da10dff225082-json.log&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;/xenodochial_lalande&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RestartCount&quot;</span>: 0,</span><br><span class="line">        <span class="string">&quot;Driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Platform&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;MountLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ProcessLabel&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;AppArmorProfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ExecIDs&quot;</span>: null,</span><br><span class="line">        <span class="string">&quot;HostConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Binds&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;ContainerIDFile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LogConfig&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">                <span class="string">&quot;Config&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;NetworkMode&quot;</span>: <span class="string">&quot;default&quot;</span>,</span><br><span class="line">            <span class="string">&quot;PortBindings&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;RestartPolicy&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;no&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MaximumRetryCount&quot;</span>: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;AutoRemove&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;VolumeDriver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;VolumesFrom&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CapDrop&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CgroupnsMode&quot;</span>: <span class="string">&quot;host&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Dns&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsOptions&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DnsSearch&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;ExtraHosts&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;GroupAdd&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;IpcMode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Cgroup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomScoreAdj&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;PidMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Privileged&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PublishAllPorts&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ReadonlyRootfs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;SecurityOpt&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;UTSMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;UsernsMode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ShmSize&quot;</span>: 67108864,</span><br><span class="line">            <span class="string">&quot;Runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ConsoleSize&quot;</span>: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Isolation&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpuShares&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Memory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;NanoCpus&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CgroupParent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;BlkioWeight&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;BlkioWeightDevice&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteBps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceReadIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;BlkioDeviceWriteIOps&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuPeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuQuota&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimePeriod&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuRealtimeRuntime&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpusetCpus&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;CpusetMems&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Devices&quot;</span>: [],</span><br><span class="line">            <span class="string">&quot;DeviceCgroupRules&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;DeviceRequests&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;KernelMemory&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;KernelMemoryTCP&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemoryReservation&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwap&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MemorySwappiness&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OomKillDisable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;PidsLimit&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Ulimits&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;CpuCount&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;CpuPercent&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumIOps&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IOMaximumBandwidth&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;MaskedPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/asound&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/acpi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/kcore&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/keys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/latency_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_list&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/timer_stats&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sched_debug&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/scsi&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/sys/firmware&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;ReadonlyPaths&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/proc/bus&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/fs&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/irq&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sys&quot;</span>,</span><br><span class="line">                <span class="string">&quot;/proc/sysrq-trigger&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/294a9e60f30995ad07636a45030fc9ac104cfe0f35d3197a6bc7171186f5fe5f-init/diff:/var/lib/docker/overlay2/0ab1d01f204652c7e92e556e2dd1f08093d99ee5ba7a2ee15aeb70324e819ac0/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/294a9e60f30995ad07636a45030fc9ac104cfe0f35d3197a6bc7171186f5fe5f/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/294a9e60f30995ad07636a45030fc9ac104cfe0f35d3197a6bc7171186f5fe5f/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/294a9e60f30995ad07636a45030fc9ac104cfe0f35d3197a6bc7171186f5fe5f/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Mounts&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;4c57edbf7922&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;while true;do echo hi;sleep 5;done&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;centos&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;org.label-schema.build-date&quot;</span>: <span class="string">&quot;20210915&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.license&quot;</span>: <span class="string">&quot;GPLv2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.name&quot;</span>: <span class="string">&quot;CentOS Base Image&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.schema-version&quot;</span>: <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;org.label-schema.vendor&quot;</span>: <span class="string">&quot;CentOS&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;NetworkSettings&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SandboxID&quot;</span>: <span class="string">&quot;0a7fdfc5a908ad18bf51398c0328cf7b4e515286df97592d367d80d9290e5033&quot;</span>,</span><br><span class="line">            <span class="string">&quot;HairpinMode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;LinkLocalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Ports&quot;</span>: &#123;&#125;,</span><br><span class="line">            <span class="string">&quot;SandboxKey&quot;</span>: <span class="string">&quot;/var/run/docker/netns/0a7fdfc5a908&quot;</span>,</span><br><span class="line">            <span class="string">&quot;SecondaryIPAddresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;SecondaryIPv6Addresses&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;c68d2781bd2dc7144ea44e21b3c72ebf3058eb0dde2b6523e303dfc9dc3edb0c&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">            <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Networks&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;bridge&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;IPAMConfig&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Links&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;Aliases&quot;</span>: null,</span><br><span class="line">                    <span class="string">&quot;NetworkID&quot;</span>: <span class="string">&quot;70b9319ee22c471f91a2b307d7444a3e0ffe8ddb4b22340b2e62684cf59fd26d&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;c68d2781bd2dc7144ea44e21b3c72ebf3058eb0dde2b6523e303dfc9dc3edb0c&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Gateway&quot;</span>: <span class="string">&quot;172.17.0.1&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPAddress&quot;</span>: <span class="string">&quot;172.17.0.2&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class="line">                    <span class="string">&quot;IPv6Gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6Address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class="line">                    <span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:ac:11:00:02&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;DriverOpts&quot;</span>: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h4 id="进入当前正在运行的容器"><a href="#进入当前正在运行的容器" class="headerlink" title="进入当前正在运行的容器"></a>进入当前正在运行的容器</h4><ol><li><code>docker exec</code>：进入容器后开启一个新的终端，可以在里面操作 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it  4c57edbf7922 /bin/bash</span></span><br><span class="line">[root@4c57edbf7922 /]<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@4c57edbf7922 /]<span class="comment"># ps -es</span></span><br><span class="line">  UID     PID          PENDING          BLOCKED          IGNORED           CAUGHT STAT TTY        TIME COMMAND</span><br><span class="line">    0      66 0000000000000000 0000000000010000 0000000000380004 000000004b817efb Ss   pts/0      0:00 /bin/bash PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/b</span><br><span class="line">    0      84 0000000000000000 0000000000000000 0000000000000000 00000001f3d1fef9 R+   pts/0      0:00 ps -es LANG=en_US.UTF-8 HOSTNAME=4c57edbf7922 PWD=/ HOME=/root</span><br><span class="line">[root@4c57edbf7922 /]<span class="comment"># ps -ef</span></span><br><span class="line">UID          PID    PPID  C STIME TTY          TIME CMD</span><br><span class="line">root           1       0  0 07:12 ?        00:00:00 /bin/sh -c <span class="keyword">while</span> <span class="literal">true</span>;<span class="keyword">do</span> <span class="built_in">echo</span> hi;<span class="built_in">sleep</span> 5;<span class="keyword">done</span></span><br><span class="line">root          66       0  0 07:17 pts/0    00:00:00 /bin/bash</span><br><span class="line">root          85       1  0 07:17 ?        00:00:00 /usr/bin/coreutils --coreutils-prog-shebang=<span class="built_in">sleep</span> /usr/bin/sleep 5</span><br><span class="line">root          86      66  0 07:17 pts/0    00:00:00 ps -ef</span><br><span class="line">[root@4c57edbf7922 /]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><code>docker attach</code>：进入容器正在执行的终端，不会启动新的进程 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker attach 4c57edbf7922</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="拷贝容器文件到主机"><a href="#拷贝容器文件到主机" class="headerlink" title="拷贝容器文件到主机"></a>拷贝容器文件到主机</h3><p><code>docker cp 容器id:容器内路径 目的主机路径</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it 4c57edbf7922 /bin/bash</span></span><br><span class="line">[root@4c57edbf7922 /]<span class="comment"># cd home</span></span><br><span class="line">[root@4c57edbf7922 home]<span class="comment"># ls</span></span><br><span class="line">[root@4c57edbf7922 home]<span class="comment"># touch text.java</span></span><br><span class="line">[root@4c57edbf7922 home]<span class="comment"># ls</span></span><br><span class="line">text.java</span><br><span class="line">[root@4c57edbf7922 home]<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">4c57edbf7922   centos    <span class="string">&quot;/bin/sh -c &#x27;while t…&quot;</span>   11 minutes ago   Up 11 minutes             xenodochial_lalande</span><br><span class="line">[root@localhost ~]<span class="comment"># docker cp 4c57edbf7922:/home/text.java /home</span></span><br><span class="line">[root@localhost ~]<span class="comment"># ls /home</span></span><br><span class="line"><span class="built_in">echo</span>  text.java</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="常用命令小结"><a href="#常用命令小结" class="headerlink" title="常用命令小结"></a>常用命令小结</h2><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727166-4edd5755.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727185-a7af770b.png"></p></div><h2 id="Docker-图形化管理工具"><a href="#Docker-图形化管理工具" class="headerlink" title="Docker 图形化管理工具"></a>Docker 图形化管理工具</h2><h3 id="Docker-UI"><a href="#Docker-UI" class="headerlink" title="Docker UI"></a>Docker UI</h3><ol><li>查找 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search dockerui</span></span><br><span class="line">NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">uifd/ui-for-docker             A web interface <span class="keyword">for</span> Docker, formerly known a…   108                  [OK]</span><br><span class="line">abh1nav/dockerui               An updated version of crosbymichael/dockerui…   98                   [OK]</span><br><span class="line">kevan/dockerui                 Deprecated: Use  uifd/ui-for-docker             15                   [OK]</span><br><span class="line">microbox/dockerui              Trusted Automated dockerui image (16MB size)    9</span><br><span class="line">madhavkobal/dockerui           Docker Updated Version having Search, Pull, …   7</span><br><span class="line">mgtsai/dockerui.base-xpra      Provide base docker images <span class="keyword">for</span> X application…   2</span><br><span class="line">rediceli/dockerui              Dockerui with nginx <span class="keyword">for</span> basic auth              1</span><br><span class="line">navionics/dockerui             Docker UI                                       1                    [OK]</span><br><span class="line">elegoev/dockerui               dockerui image based on crosbymichael/docker…   1                    [OK]</span><br><span class="line">levkov/dockerui                dockerui                                        0</span><br><span class="line">yungsang/dockerui              Docker API Version: v1.8 UI Version: v0.4 Bu…   0</span><br><span class="line">david510c/dockerui.base-xpra   dockerui.base-xpra with Firefox                 0                    [OK]</span><br><span class="line">winking/dockerui               The latest DockerUI build, see https://githu…   0</span><br><span class="line">bbdinc/dockerui                A rebuild of the dockerui-with-auth             0</span><br><span class="line">devalih/dockerui               To run :  docker pull devalih/dockerui  dock…   0</span><br><span class="line">bettse/dockerui                Fork of crosbymichael/dockerui                  0</span><br><span class="line">alexerm/dockerui-auth                                                          0</span><br><span class="line">drakin/dockerui                                                                0</span><br><span class="line">cloudaku/dockerui                                                              0                    [OK]</span><br><span class="line">allincloud/dockerui                                                            0                    [OK]</span><br><span class="line">psychemedia/dockerui_patch                                                     0</span><br><span class="line">c0710204/dockerui                                                              0                    [OK]</span><br><span class="line">pemcconnell/dockerui                                                           0</span><br><span class="line">biibds/dockerui                                                                0</span><br><span class="line">wansc/dockerui                                                                 0                    [OK]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>下载 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull abh1nav/dockerui</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from abh1nav/dockerui</span><br><span class="line">Image docker.io/abh1nav/dockerui:latest uses outdated schema1 manifest format. Please upgrade to a schema2 image <span class="keyword">for</span> better future compatibility. More information at https://docs.docker.com/registry/spec/deprecated-schema-v1/</span><br><span class="line">a3ed95caeb02: Pull complete</span><br><span class="line">5d3df020ecd3: Pull complete</span><br><span class="line">bebf5a3b4dfb: Pull complete</span><br><span class="line">e4452c0fe72b: Pull complete</span><br><span class="line">6167d9726b07: Pull complete</span><br><span class="line">53ebae19a314: Pull complete</span><br><span class="line">Digest: sha256:a9c6c5393f561a0f42f41cfa80572b666e745d9b419569c42bac1e5cf9ceda32</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> abh1nav/dockerui:latest</span><br><span class="line">docker.io/abh1nav/dockerui:latest</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>运行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d --privileged --name dockerui -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock abh1nav/dockerui</span></span><br><span class="line">ee4f62f8a2da81a3f3d7ccf105fb263e9b2bacea0f65e2693e8893e1d87bf6b7</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>测试<br> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727226-687c000d.png"></li></ol><h3 id="Shipyard"><a href="#Shipyard" class="headerlink" title="Shipyard"></a>Shipyard</h3><h3 id="Portainer"><a href="#Portainer" class="headerlink" title="Portainer"></a>Portainer</h3><ol><li>查找 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search portainer</span></span><br><span class="line">NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">portainer/portainer              This Repo is now deprecated, use portainer/p…   2136</span><br><span class="line">portainer/portainer-ce           Portainer CE - Making Docker and Kubernetes …   818</span><br><span class="line">portainer/agent                  An agent used to manage all the resources <span class="keyword">in</span>…   120</span><br><span class="line">portainer/templates              App Templates <span class="keyword">for</span> Portainer http://portainer…   23</span><br><span class="line">lihaixin/portainer               docker ui                                       15                   [OK]</span><br><span class="line">greenled/portainer-stack-utils   Bash scripts to deploy/undeploy stacks <span class="keyword">in</span> a …   6                    [OK]</span><br><span class="line">portainer/portainer-k8s-beta     Portainer <span class="keyword">for</span> Kubernetes BETA                   5</span><br><span class="line">portainerci/portainer            Portainer images automatically created via P…   5</span><br><span class="line">portainer/golang-builder         Utility to build Golang binaries.               4                    [OK]</span><br><span class="line">hassioaddons/portainer                                                           2</span><br><span class="line">portainer/portainer-ee           Portainer EE - Making Docker and Kubernetes …   2</span><br><span class="line">portainer/base                   Multi-stage build image to create the Portai…   2                    [OK]</span><br><span class="line">portainer/agent-k8s-beta         Portainer <span class="keyword">for</span> Kubernetes BETA (agent)           1</span><br><span class="line">cqkz/portainer-zh                portainer-ce:2.1.1-alpine，汉化文件来自恩山…             1</span><br><span class="line">softonic/portainer-endpoint      Allows auto register all the swarm nodes <span class="keyword">in</span> …   1                    [OK]</span><br><span class="line">portainerci/portainer-ee         Portainer EE CI repository                      0</span><br><span class="line">xanderstrike/portainer-issue     <span class="keyword">for</span> illustrating a portainer issue              0</span><br><span class="line">iconviet/portainer                                                               0</span><br><span class="line">hassioaddons/portainer-amd64                                                     0</span><br><span class="line">6053537/portainer-ce             portainer-ce中文汉化版                               0</span><br><span class="line">portainerci/agent                Portainer agent images automatically created…   0</span><br><span class="line">helloysd/portainer                                                               0</span><br><span class="line">antsoftxyz/portainer-api         A portainer api wrapper <span class="built_in">which</span> can <span class="built_in">help</span> you C…   0</span><br><span class="line">11384eb/portainer                                                                0</span><br><span class="line">nenadilic84/portainer                                                            0</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>下载 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull portainer/portainer</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">94cfa856b2b1: Pull complete</span><br><span class="line">49d59ee0881a: Pull complete</span><br><span class="line">a2300fd28637: Pull complete</span><br><span class="line">Digest: sha256:fb45b43738646048a0a0cc74fcee2865b69efde857e710126084ee5de9be0f3f</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> portainer/portainer:latest</span><br><span class="line">docker.io/portainer/portainer:latest</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>运行 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d --name portainerui -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span></span><br><span class="line">fb7e6dd2e3296b05868cf17f00902d3da598abde5e9959a0db39c84bb28cdcf6</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>测试<ol><li>第一次登录设置<code>admin</code>用户的密码<br> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727261-a31a260c.png"></li><li>如果是阿里云服务器记得设置安全组，选择连接本地的<code>Docker</code><br> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727290-b8214680.png"></li></ol></li></ol><h2 id="Docker-镜像详解"><a href="#Docker-镜像详解" class="headerlink" title="Docker 镜像详解"></a>Docker 镜像详解</h2><h3 id="什么是镜像"><a href="#什么是镜像" class="headerlink" title="什么是镜像"></a>什么是镜像</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需要的所有内容，包括代码，运行时（一个程序在运行或者在被执行的依赖）、库，环境变量和配置文件。</p><h3 id="UnionFS（联合文件系统）"><a href="#UnionFS（联合文件系统）" class="headerlink" title="UnionFS（联合文件系统）"></a>UnionFS（联合文件系统）</h3><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727320-7d07ca30.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727339-7761f7cb.png"></p></div><ul><li>联合文件系统（<code>UnionFS</code>）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。联合文件系统是<code>Docker</code>镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</li><li>特性：一次同时加载多个文件系统，但从外面看起来只能看到一个文件系统。联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</li></ul><h3 id="镜像加载原理"><a href="#镜像加载原理" class="headerlink" title="镜像加载原理"></a>镜像加载原理</h3><p><code>Docker</code>的镜像实际由一层一层的文件系统组成：</p><ul><li><code>bootfs</code>（<code>boot file system</code>）主要包含<code>bootloader</code>和<code>kernel</code>。<code>bootloader</code>主要是引导加载<code>kernel</code>，完成后整个内核就都在内存中了。此时内存的使用权已由<code>bootfs</code>转交给内核，系统卸载<code>bootfs</code>。可以被不同的<code>Linux</code>发行版公用。</li><li><code>rootfs</code>（<code>root file system</code>），包含典型<code>Linux</code>系统中的<code>/dev</code>，<code>/proc</code>，<code>/bin</code>，<code>/etc</code>等标准目录和文件。<code>rootfs</code>就是各种不同操作系统发行版（<code>Ubuntu</code>，<code>Centos</code>等）。因为底层直接用<code>Host</code>的<code>kernel</code>，<code>rootfs</code>只包含最基本的命令，工具和程序就可以了。</li></ul><h3 id="分层理解"><a href="#分层理解" class="headerlink" title="分层理解"></a>分层理解</h3><p>所有的<code>Docker</code>镜像都起始于一个基础镜像层，当进行修改或增加新的内容时，就会在当前镜像层之上，创建新的容器层。</p><p>容器在启动时会在镜像最外层上建立一层可读写的容器层（<code>R/W</code>），而镜像层是只读的（<code>R/O</code>）。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727391-8a4db6f8.png"></p></div>　查看镜像分层的方式可以通过`docker image inspect`命令：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker image inspect tomcat:latest</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;sha256:b0e0b0a92cf96022059ea14d7c0bee5f51cc856f21be4566d435125d6b261a6b&quot;</span>,</span><br><span class="line">        <span class="string">&quot;RepoTags&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;tomcat:latest&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;RepoDigests&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;tomcat@sha256:509cf786b26a8bd43e58a90beba60bdfd6927d2ce9c7902cfa675d3ea9f4c631&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Parent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Comment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2021-10-22T00:23:10.031482334Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Container&quot;</span>: <span class="string">&quot;3910543988c25e096c2ed3920ba0fd86a1d227fad82651cd6c8176d1427e3cbb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ContainerConfig&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;3910543988c2&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/tomcat/bin:/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class="line">                <span class="string">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JAVA_VERSION=11.0.13&quot;</span>,</span><br><span class="line">                <span class="string">&quot;CATALINA_HOME=/usr/local/tomcat&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_NATIVE_LIBDIR=/usr/local/tomcat/native-jni-lib&quot;</span>,</span><br><span class="line">                <span class="string">&quot;LD_LIBRARY_PATH=/usr/local/tomcat/native-jni-lib&quot;</span>,</span><br><span class="line">                <span class="string">&quot;GPG_KEYS=A9C5DF4D22E99998D9875A5110C01C5A2F6059E7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_MAJOR=10&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_VERSION=10.0.12&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_SHA512=e084fc0cc243c0a9ac7de85ffd4b96d00b40b5493ed7ef276d91373fe8036bc953406cd3c48db6b5ae116f2af162fd1bfb13ecdddf5d64523fdd69a9463de8a3&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;/bin/sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;-c&quot;</span>,</span><br><span class="line">                <span class="string">&quot;#(nop) &quot;</span>,</span><br><span class="line">                <span class="string">&quot;CMD [\&quot;catalina.sh\&quot; \&quot;run\&quot;]&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:9b2ff315119c435ad9053c0af16ad0e7b888bb8c78f54428b83de6edac04d00a&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/usr/local/tomcat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;DockerVersion&quot;</span>: <span class="string">&quot;20.10.7&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Config&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Hostname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Domainname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;User&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStdout&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;AttachStderr&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Tty&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OpenStdin&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;StdinOnce&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Env&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;PATH=/usr/local/tomcat/bin:/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class="line">                <span class="string">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class="line">                <span class="string">&quot;JAVA_VERSION=11.0.13&quot;</span>,</span><br><span class="line">                <span class="string">&quot;CATALINA_HOME=/usr/local/tomcat&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_NATIVE_LIBDIR=/usr/local/tomcat/native-jni-lib&quot;</span>,</span><br><span class="line">                <span class="string">&quot;LD_LIBRARY_PATH=/usr/local/tomcat/native-jni-lib&quot;</span>,</span><br><span class="line">                <span class="string">&quot;GPG_KEYS=A9C5DF4D22E99998D9875A5110C01C5A2F6059E7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_MAJOR=10&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_VERSION=10.0.12&quot;</span>,</span><br><span class="line">                <span class="string">&quot;TOMCAT_SHA512=e084fc0cc243c0a9ac7de85ffd4b96d00b40b5493ed7ef276d91373fe8036bc953406cd3c48db6b5ae116f2af162fd1bfb13ecdddf5d64523fdd69a9463de8a3&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Cmd&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;catalina.sh&quot;</span>,</span><br><span class="line">                <span class="string">&quot;run&quot;</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:9b2ff315119c435ad9053c0af16ad0e7b888bb8c78f54428b83de6edac04d00a&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Volumes&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;WorkingDir&quot;</span>: <span class="string">&quot;/usr/local/tomcat&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Entrypoint&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;OnBuild&quot;</span>: null,</span><br><span class="line">            <span class="string">&quot;Labels&quot;</span>: null</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Architecture&quot;</span>: <span class="string">&quot;amd64&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Os&quot;</span>: <span class="string">&quot;linux&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Size&quot;</span>: 679601323,</span><br><span class="line">        <span class="string">&quot;VirtualSize&quot;</span>: 679601323,</span><br><span class="line">        <span class="string">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;LowerDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/d790d6db212523ea1193ce0b069697c847cf1f46dd7ee49426dbcd7143e6c178/diff:/var/lib/docker/overlay2/92a2c12ab39fe48f706f82bb5676d1864f599e9ab599d9db39cccbfe92039638/diff:/var/lib/docker/overlay2/407eb8f0c69437754677107d8fd7f17f4a1860145be1efc8b42346ce0fd4dbfe/diff:/var/lib/docker/overlay2/463c9c2a46ab7dd277bd856e02fa289c79c35ec8448d5bd928b9cc5f8c135c20/diff:/var/lib/docker/overlay2/4fece198c14710f63376f1cbad8eeb9d6d96ef2bc0abae8f0151e6f747860e4a/diff:/var/lib/docker/overlay2/bea7f4174b9fed08da36a6410fda3c8ac58f435775b9c421cd99728fff3e9886/diff:/var/lib/docker/overlay2/7067926d50fd10ed3aa0640305af85fa6dcc06a97a5673d7a5e6bc18a0e22fc9/diff:/var/lib/docker/overlay2/f7216c6e8ddb0119daa9c817454fe291cbe2ffdda129215ae36ce4c75f211b3d/diff:/var/lib/docker/overlay2/821accbe6656f334993170bbd8d3eddeef16b7b6aa257612b8dd7f829bbf2786/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;MergedDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/196ca3b125c83355469032ec19738aa2dc468a29d3ae7877904abc5a06b967a5/merged&quot;</span>,</span><br><span class="line">                <span class="string">&quot;UpperDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/196ca3b125c83355469032ec19738aa2dc468a29d3ae7877904abc5a06b967a5/diff&quot;</span>,</span><br><span class="line">                <span class="string">&quot;WorkDir&quot;</span>: <span class="string">&quot;/var/lib/docker/overlay2/196ca3b125c83355469032ec19738aa2dc468a29d3ae7877904abc5a06b967a5/work&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;Name&quot;</span>: <span class="string">&quot;overlay2&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Layers&quot;</span>: [</span><br><span class="line">                <span class="string">&quot;sha256:62a747bf1719d2d37fff5670ed40de6900a95743172de1b4434cb019b56f30b4&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:0b3c02b5d746e8cc8d537922b7c2abc17b22da7de268d068f2a4ebd55ac4f6d7&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:9f9f651e9303146e4dd98aca7da21fd8e21dd1a47d71da3d6d187da7691a6dc9&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:ba6e5ff31f235bbfd34aae202da4e6d4dc759f266f284d79018cae755f36f9e3&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:36e0782f115904773d06f7d03af94a1ec9ca9ad42736ec55baae8823c457ba69&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:62a5b8741e8334844625c513016da47cf2b61afb1145f6317edacb4c13ab010e&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:78700b6b35d0ab6e70befff1d26c5350222a8fea49cc874916bce950eeae35a1&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:cb80689c9aefc3f455b35b0110fa04a7c13e21a25f342ee2bb27c28f618a0eb5&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:5122793ce9cb2007fe52ae7bb8ff25001e7c29c04d081a0a4bb1986d1b06a4cb&quot;</span>,</span><br><span class="line">                <span class="string">&quot;sha256:450346f29d28210054da70889add4cf59f9c9f3964a94cfa213f905620ade8e2&quot;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Metadata&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;LastTagTime&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>这里指示了分层信息：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;RootFS&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Type&quot;</span>: <span class="string">&quot;layers&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Layers&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;sha256:62a747bf1719d2d37fff5670ed40de6900a95743172de1b4434cb019b56f30b4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:0b3c02b5d746e8cc8d537922b7c2abc17b22da7de268d068f2a4ebd55ac4f6d7&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:9f9f651e9303146e4dd98aca7da21fd8e21dd1a47d71da3d6d187da7691a6dc9&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:ba6e5ff31f235bbfd34aae202da4e6d4dc759f266f284d79018cae755f36f9e3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:36e0782f115904773d06f7d03af94a1ec9ca9ad42736ec55baae8823c457ba69&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:62a5b8741e8334844625c513016da47cf2b61afb1145f6317edacb4c13ab010e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:78700b6b35d0ab6e70befff1d26c5350222a8fea49cc874916bce950eeae35a1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:cb80689c9aefc3f455b35b0110fa04a7c13e21a25f342ee2bb27c28f618a0eb5&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:5122793ce9cb2007fe52ae7bb8ff25001e7c29c04d081a0a4bb1986d1b06a4cb&quot;</span>,</span><br><span class="line">        <span class="string">&quot;sha256:450346f29d28210054da70889add4cf59f9c9f3964a94cfa213f905620ade8e2&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>举一个简单的例子，加入基于<code>Ubuntu Linux 16.04</code>创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加<code>Python</code>包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727453-772dd27c.png"></p></div><p>在添加额外镜像层的同时，镜像始终保持是当前所有镜像的组合。下图举了一个简单的例子，每个镜像层包含三个文件，而镜像包含了来自两个镜像层的六个文件。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727478-140d1457.png"></p></div><p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件，这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p><p><code>Docker</code>通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p><p><code>Linux</code>上可用的存储引擎有<code>AUFS</code>、<code>Overlay2</code>、<code>Device Mapper</code>、<code>Btrfs</code>以及<code>ZFS</code>。顾名思义，每种存储引擎都基于<code>Linux</code>中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p><p><code>Docker</code>在<code>Windows</code>上仅支持<code>windowsfilter</code>一种存储引擎，该引擎基于<code>NTFS</code>文件系统之上实现了分层和<code>CoW</code>。</p><p>下图展示了与系统显示相同的三层镜像，所有镜像层堆叠并合并，对外提供统一的试图。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727537-aa627b9c.png"></p></div><p><code>Docker</code>镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的底部，这一层就是通常说的容器层，容器层之下都叫镜像层.</p><h3 id="提交镜像"><a href="#提交镜像" class="headerlink" title="提交镜像"></a>提交镜像</h3><p>使用<code>docker commit</code>命令提交容器成为一个新的版本，<code>docker commit -m=“提交的描述信息”  -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]</code>。</p><p>由于默认的<code>Tomcat</code>镜像的<code>webapps</code>文件夹中没有任何内容，需要从<code>webapps.dist</code>中拷贝文件到<code>webapps</code>文件夹。下面自行制作镜像：就是从<code>webapps.dist</code>中拷贝文件到<code>webapps</code>文件夹下，并提交该镜像作为一个新的镜像。使得该镜像默认的<code>webapps</code>文件夹下就有文件。具体命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -it tomcat /bin/bash</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat/webapps<span class="comment"># cd ../</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat<span class="comment"># cp -r webapps.dist/* webapps</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@36d34cc37920:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@36d34cc37920:/usr/local/tomcat/webapps<span class="comment"># [root@localhost ~]#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED              STATUS              PORTS      NAMES</span><br><span class="line">36d34cc37920   tomcat    <span class="string">&quot;/bin/bash&quot;</span>   About a minute ago   Up About a minute   8080/tcp   sweet_meninsky</span><br><span class="line">[root@localhost ~]<span class="comment"># docker commit -m=&quot;add files to  webapps&quot; -a=&quot;echo&quot; 36d34cc37920 mytomcat:1.0</span></span><br><span class="line">sha256:97a599676bbb23fb8ee80fc9872c07660893560cc5af3450d53b6967cb516611</span><br><span class="line">[root@localhost ~]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mytomcat              1.0       97a599676bbb   4 seconds ago   684MB</span><br><span class="line">tomcat                latest    b0e0b0a92cf9   8 days ago      680MB</span><br><span class="line">mysql                 5.7       938b57d64674   11 days ago     448MB</span><br><span class="line">nginx                 latest    87a94228f133   2 weeks ago     133MB</span><br><span class="line">hello-world           latest    feb5d9fea6a5   5 weeks ago     13.3kB</span><br><span class="line">centos                latest    5d0da3dc9764   6 weeks ago     231MB</span><br><span class="line">portainer/portainer   latest    580c0e4e98b0   7 months ago    79.1MB</span><br><span class="line">elasticsearch         latest    5acf0e8da90b   3 years ago     486MB</span><br><span class="line">abh1nav/dockerui      latest    6e4d05915b2a   6 years ago     470MB</span><br><span class="line">[root@localhost ~]<span class="comment"># docker run -it mytomcat:1.0 /bin/bash</span></span><br><span class="line">root@3821c6f35992:/usr/local/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@3821c6f35992:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@3821c6f35992:/usr/local/tomcat/webapps<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>　　参数说明：</p><ul><li><code>-m</code>：提交的描述信息</li><li><code>-a</code>：作者</li><li><code>:[TAG]</code>：版本号</li></ul><h1 id="常见容器部署"><a href="#常见容器部署" class="headerlink" title="常见容器部署"></a>常见容器部署</h1><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><ol><li><p>查找</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search nginx</span></span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        15725     [OK]</span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   2088                 [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   818                  [OK]</span><br><span class="line">jc21/nginx-proxy-manager          Docker container <span class="keyword">for</span> managing Nginx proxy ho…   266</span><br><span class="line">linuxserver/nginx                 An Nginx container, brought to you by LinuxS…   159</span><br><span class="line">tiangolo/nginx-rtmp               Docker image with Nginx using the nginx-rtmp…   142                  [OK]</span><br><span class="line">jlesage/nginx-proxy-manager       Docker container <span class="keyword">for</span> Nginx Proxy Manager        142                  [OK]</span><br><span class="line">alfg/nginx-rtmp                   NGINX, nginx-rtmp-module and FFmpeg from sou…   110                  [OK]</span><br><span class="line">nginxdemos/hello                  NGINX webserver that serves a simple page co…   76                   [OK]</span><br><span class="line">privatebin/nginx-fpm-alpine       PrivateBin running on an Nginx, php-fpm &amp; Al…   59                   [OK]</span><br><span class="line">nginx/nginx-ingress               NGINX and  NGINX Plus Ingress Controllers fo…   55</span><br><span class="line">nginxinc/nginx-unprivileged       Unprivileged NGINX Dockerfiles                  54</span><br><span class="line">staticfloat/nginx-certbot         Opinionated setup <span class="keyword">for</span> automatic TLS certs lo…   25                   [OK]</span><br><span class="line">nginxproxy/nginx-proxy            Automated Nginx reverse proxy <span class="keyword">for</span> docker con…   23</span><br><span class="line">nginx/nginx-prometheus-exporter   NGINX Prometheus Exporter <span class="keyword">for</span> NGINX and NGIN…   21</span><br><span class="line">schmunk42/nginx-redirect          A very simple container to redirect HTTP tra…   19                   [OK]</span><br><span class="line">centos/nginx-112-centos7          Platform <span class="keyword">for</span> running nginx 1.12 or building …   15</span><br><span class="line">centos/nginx-18-centos7           Platform <span class="keyword">for</span> running nginx 1.8 or building n…   13</span><br><span class="line">bitwarden/nginx                   The Bitwarden nginx web server acting as a r…   11</span><br><span class="line">flashspys/nginx-static            Super Lightweight Nginx Image                   11                   [OK]</span><br><span class="line">mailu/nginx                       Mailu nginx frontend                            9                    [OK]</span><br><span class="line">sophos/nginx-vts-exporter         Simple server that scrapes Nginx vts stats a…   7                    [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb   An APB to deploy NGINX                          2                    [OK]</span><br><span class="line">wodby/nginx                       Generic nginx                                   1                    [OK]</span><br><span class="line">arnau/nginx-gate                  Docker image with Nginx with Lua enabled on …   1                    [OK]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>下载</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull nginx</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">b380bbd43752: Already exists</span><br><span class="line">fca7e12d1754: Pull complete</span><br><span class="line">745ab57616cb: Pull complete</span><br><span class="line">a4723e260b6f: Pull complete</span><br><span class="line">1c84ebdff681: Pull complete</span><br><span class="line">858292fd2e56: Pull complete</span><br><span class="line">Digest: sha256:644a70516a26004c97d0d85c7fe1d0c3a67ea8ab7ddf4aff193d9f301670cf36</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>启动</p><ul><li><code>-d</code>：后台运行</li><li><code>--name</code>：给容器命名</li><li><code>-p 3334:80</code>：将宿主机的端口 $3334$ 映射到该容器的 $80$ 端口</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d --name nginx -p 9000:80 nginx</span></span><br><span class="line">e8eb3635abc7f90fe9e7c75cf863f60682c9220550b76041177e4080292438c3</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p> <img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727793-8af40eeb.png"></p></li><li><p>配置文件<br> 进入容器，自定义配置文件</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it nginx /bin/bash</span></span><br><span class="line">root@e8eb3635abc7:/<span class="comment"># whereis nginx</span></span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@e8eb3635abc7:/<span class="comment"># cd /etc/nginx</span></span><br><span class="line">root@e8eb3635abc7:/etc/nginx<span class="comment"># ls</span></span><br><span class="line">conf.d  fastcgi_params  mime.types  modules  nginx.conf  scgi_params  uwsgi_params</span><br><span class="line">root@e8eb3635abc7:/etc/nginx<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>访问测试</p><ul><li>本地主机访问测试，<code>curl</code>命令发起请求，如果使用阿里云服务器需要设置安全组<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                                   NAMES</span><br><span class="line">e8eb3635abc7   nginx     <span class="string">&quot;/docker-entrypoint.…&quot;</span>   19 minutes ago   Up 19 minutes   0.0.0.0:9000-&gt;80/tcp, :::9000-&gt;80/tcp   nginx</span><br><span class="line">[root@localhost ~]<span class="comment"># curl localhost:9000</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html &#123; color-scheme: light dark; &#125;</span><br><span class="line">body &#123; width: 35em; margin: 0 auto;</span><br><span class="line">font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.org/&quot;</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">&quot;http://nginx.com/&quot;</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>浏览器访问<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727832-3b5adcba.png"></li></ul></li></ol><h2 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h2><ol><li><p>查找</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search tomcat</span></span><br><span class="line">NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat is an open <span class="built_in">source</span> implementati…   3161      [OK]</span><br><span class="line">tomee                         Apache TomEE is an all-Apache Java EE certif…   93        [OK]</span><br><span class="line">dordoka/tomcat                Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   58                   [OK]</span><br><span class="line">kubeguide/tomcat-app          Tomcat image <span class="keyword">for</span> Chapter 1                      31</span><br><span class="line">consol/tomcat-7.0             Tomcat 7.0.57, 8080, <span class="string">&quot;admin/admin&quot;</span>              18                   [OK]</span><br><span class="line">cloudesire/tomcat             Tomcat server, 6/7/8                            15                   [OK]</span><br><span class="line">aallam/tomcat-mysql           Debian, Oracle JDK, Tomcat &amp; MySQL              13                   [OK]</span><br><span class="line">arm32v7/tomcat                Apache Tomcat is an open <span class="built_in">source</span> implementati…   11</span><br><span class="line">andreptb/tomcat               Debian Jessie based image with Apache Tomcat…   10                   [OK]</span><br><span class="line">rightctrl/tomcat              CentOS , Oracle Java, tomcat application ssl…   7                    [OK]</span><br><span class="line">arm64v8/tomcat                Apache Tomcat is an open <span class="built_in">source</span> implementati…   6</span><br><span class="line">unidata/tomcat-docker         Security-hardened Tomcat Docker container.      5                    [OK]</span><br><span class="line">amd64/tomcat                  Apache Tomcat is an open <span class="built_in">source</span> implementati…   3</span><br><span class="line">cfje/tomcat-resource          Tomcat Concourse Resource                       2</span><br><span class="line">fabric8/tomcat-8              Fabric8 Tomcat 8 Image                          2                    [OK]</span><br><span class="line">oobsri/tomcat8                Testing CI Jobs with different names.           2</span><br><span class="line">jelastic/tomcat               An image of the Tomcat Java application serv…   2</span><br><span class="line">chenyufeng/tomcat-centos      tomcat基于centos6的镜像                              1                    [OK]</span><br><span class="line">picoded/tomcat7               tomcat7 with jre8 and MANAGER_USER / MANAGER…   1                    [OK]</span><br><span class="line">ppc64le/tomcat                Apache Tomcat is an open <span class="built_in">source</span> implementati…   1</span><br><span class="line">99taxis/tomcat7               Tomcat7                                         1                    [OK]</span><br><span class="line">camptocamp/tomcat-logback     Docker image <span class="keyword">for</span> tomcat with logback integra…   1                    [OK]</span><br><span class="line">secoresearch/tomcat-varnish   Tomcat and Varnish 5.0                          0                    [OK]</span><br><span class="line">s390x/tomcat                  Apache Tomcat is an open <span class="built_in">source</span> implementati…   0</span><br><span class="line">softwareplant/tomcat          Tomcat images <span class="keyword">for</span> jira-cloud testing            0                    [OK]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>下载</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull tomcat</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/tomcat</span><br><span class="line">bb7d5a84853b: Pull complete</span><br><span class="line">f02b617c6a8c: Pull complete</span><br><span class="line">d32e17419b7e: Pull complete</span><br><span class="line">c9d2d81226a4: Pull complete</span><br><span class="line">fab4960f9cd2: Pull complete</span><br><span class="line">da1c1e7baf6d: Pull complete</span><br><span class="line">1d2ade66c57e: Pull complete</span><br><span class="line">ea2ad3f7cb7c: Pull complete</span><br><span class="line">d75cb8d0a5ae: Pull complete</span><br><span class="line">76c37a4fffe6: Pull complete</span><br><span class="line">Digest: sha256:509cf786b26a8bd43e58a90beba60bdfd6927d2ce9c7902cfa675d3ea9f4c631</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> tomcat:latest</span><br><span class="line">docker.io/library/tomcat:latest</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>启动</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d --name tomcat -p 9000:8080 tomcat</span></span><br><span class="line">3b86e8c4255c9d42448e50cae8b6fd528ab0b801a20e66d2bb79dc702be17fb5</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>进入容器</p><ul><li>容器中的命令少了</li><li>阿里云镜像默认下载的是最小的镜像，保证最小的运行环境</li></ul> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it tomcat /bin/bash</span></span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat<span class="comment"># ls</span></span><br><span class="line">BUILDING.txt  CONTRIBUTING.md  LICENSE  NOTICE  README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  native-jni-lib  temp  webapps  webapps.dist  work</span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat<span class="comment"># cd webapps.dist</span></span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps.dist<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps.dist<span class="comment"># cd ../webapps</span></span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps<span class="comment"># cp -r /usr/local/tomcat/webapps.dist/* /usr/local/tomcat/webapps/</span></span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@3b86e8c4255c:/usr/local/tomcat/webapps<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><p>访问测试</p><ul><li>本地主机访问测试，<code>curl</code>命令发起请求，如果使用阿里云服务器需要设置安全组<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># curl localhost:9000</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">    &lt;<span class="built_in">head</span>&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/10.0.12&lt;/title&gt;</span><br><span class="line">        &lt;<span class="built_in">link</span> href=<span class="string">&quot;favicon.ico&quot;</span> rel=<span class="string">&quot;icon&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;image/x-icon&quot;</span> /&gt;</span><br><span class="line">        &lt;<span class="built_in">link</span> href=<span class="string">&quot;tomcat.css&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span> <span class="built_in">type</span>=<span class="string">&quot;text/css&quot;</span> /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>浏览器访问<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727903-4973d00f.png"></li></ul></li></ol><h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><ol><li>查找 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker search elasticsearch</span></span><br><span class="line">NAME                                         DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">elasticsearch                                Elasticsearch is a powerful open <span class="built_in">source</span> sear…   5289      [OK]</span><br><span class="line">nshou/elasticsearch-kibana                   Elasticsearch-7.15.1 Kibana-7.15.1              132                  [OK]</span><br><span class="line">mobz/elasticsearch-head                      elasticsearch-head front-end and standalone …   81</span><br><span class="line">elastichq/elasticsearch-hq                   Official Docker image <span class="keyword">for</span> ElasticHQ: Elastic…   76                   [OK]</span><br><span class="line">itzg/elasticsearch                           Provides an easily configurable Elasticsearc…   71                   [OK]</span><br><span class="line">elastic/elasticsearch                        The Elasticsearch Docker image maintained by…   56</span><br><span class="line">taskrabbit/elasticsearch-dump                Import and <span class="built_in">export</span> tools <span class="keyword">for</span> elasticsearch       27                   [OK]</span><br><span class="line">lmenezes/elasticsearch-kopf                  elasticsearch kopf                              18                   [OK]</span><br><span class="line">barnybug/elasticsearch                       Latest Elasticsearch 1.7.2 and previous rele…   17                   [OK]</span><br><span class="line">justwatch/elasticsearch_exporter             Elasticsearch stats exporter <span class="keyword">for</span> Prometheus     17</span><br><span class="line">blacktop/elasticsearch                       Alpine Linux based Elasticsearch Docker Image   16                   [OK]</span><br><span class="line">esystemstech/elasticsearch                   Debian based Elasticsearch packing <span class="keyword">for</span> Lifer…   15</span><br><span class="line">monsantoco/elasticsearch                     ElasticSearch Docker image                      11                   [OK]</span><br><span class="line">mesoscloud/elasticsearch                     [UNMAINTAINED] Elasticsearch                    9                    [OK]</span><br><span class="line">dtagdevsec/elasticsearch                     elasticsearch                                   4                    [OK]</span><br><span class="line">centerforopenscience/elasticsearch           Elasticsearch                                   4                    [OK]</span><br><span class="line">barchart/elasticsearch-aws                   Elasticsearch AWS node                          3</span><br><span class="line">jetstack/elasticsearch-pet                   An elasticsearch image <span class="keyword">for</span> kubernetes PetSets   1                    [OK]</span><br><span class="line">axway/elasticsearch-docker-beat              <span class="string">&quot;Beat&quot;</span> extension to <span class="built_in">read</span> logs of containers …   1                    [OK]</span><br><span class="line">thingswise/elasticsearch                     Elasticsearch + etcd2 peer discovery            1                    [OK]</span><br><span class="line">kuzzleio/elasticsearch                       Elasticsearch container based on Alpine Linu…   1                    [OK]</span><br><span class="line">phenompeople/elasticsearch                   Elasticsearch is a powerful open <span class="built_in">source</span> sear…   1                    [OK]</span><br><span class="line">dsteinkopf/elasticsearch-ingest-attachment   elasticsearch + ingest-attachment to be used…   1                    [OK]</span><br><span class="line">wreulicke/elasticsearch                      elasticsearch                                   0                    [OK]</span><br><span class="line">travix/elasticsearch-kubernetes              To run ElasticSearch <span class="keyword">in</span> kubernetes and expor…   0                    [OK]</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>下载 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker pull elasticsearch</span></span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/elasticsearch</span><br><span class="line">05d1a5232b46: Pull complete</span><br><span class="line">5cee356eda6b: Pull complete</span><br><span class="line">89d3385f0fd3: Pull complete</span><br><span class="line">65dd87f6620b: Pull complete</span><br><span class="line">78a183a01190: Pull complete</span><br><span class="line">1a4499c85f97: Pull complete</span><br><span class="line">2c9d39b4bfc1: Pull complete</span><br><span class="line">1b1cec2222c9: Pull complete</span><br><span class="line">59ff4ce9df68: Pull complete</span><br><span class="line">1976bc3ee432: Pull complete</span><br><span class="line">5af49e8af381: Pull complete</span><br><span class="line">42c8b75ff7af: Pull complete</span><br><span class="line">7e6902915254: Pull complete</span><br><span class="line">99853874fa54: Pull complete</span><br><span class="line">596fbad6fcff: Pull complete</span><br><span class="line">Digest: sha256:a8081d995ef3443dc6d077093172a5931e02cdb8ffddbf05c67e01d348a9770e</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> elasticsearch:latest</span><br><span class="line">docker.io/library/elasticsearch:latest</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>运行<ol><li>添加 <code>-e ES_JAVA_OPTS=&quot;-Xms128m -Xmx512m&quot;</code> 配置<code>ElasticSearch</code>的虚拟机占用的内存大小 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms128m -Xmx512m&quot; elasticsearch</span></span><br><span class="line">f0df576e243ccb3d0fffdd85924f3241a9490876783440c5fe237d283c76b82f</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li><code>docker stats</code>：查看资源占用情况 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE           COMMAND                  CREATED              STATUS              PORTS                                                                                  NAMES</span><br><span class="line">f0df576e243c   elasticsearch   <span class="string">&quot;/docker-entrypoint.…&quot;</span>   About a minute ago   Up About a minute   0.0.0.0:9200-&gt;9200/tcp, :::9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp, :::9300-&gt;9300/tcp   elasticsearch</span><br><span class="line">[root@localhost ~]<span class="comment"># docker stats</span></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O     PIDS</span><br><span class="line">f0df576e243c   elasticsearch   0.05%     280.3MiB / 1.748GiB   15.66%    976B / 0B   0B / 48.1kB   31</span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O     BLOCK I/O     PIDS</span><br><span class="line">f0df576e243c   elasticsearch   0.05%     280.3MiB / 1.748GiB   15.66%    976B / 0B   0B / 48.1kB   31</span><br><span class="line">^C</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol></li><li>进入容器 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># docker exec -it elasticsearch /bin/bash</span></span><br><span class="line">root@f0df576e243c:/usr/share/elasticsearch<span class="comment"># ls</span></span><br><span class="line">NOTICE.txt  README.textile  bin  config  data  lib  logs  modules  plugins</span><br><span class="line">root@f0df576e243c:/usr/share/elasticsearch<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>访问<ul><li>本地主机访问测试，<code>curl</code>命令发起请求，如果使用阿里云服务器需要设置安全组<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@f0df576e243c:/usr/share/elasticsearch<span class="comment"># curl localhost:9200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span> : <span class="string">&quot;6F1a2UH&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_name&quot;</span> : <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cluster_uuid&quot;</span> : <span class="string">&quot;D_t1vzAURlmAP6TwqcjKPA&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span> : <span class="string">&quot;5.6.12&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_hash&quot;</span> : <span class="string">&quot;cfe3d9f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_date&quot;</span> : <span class="string">&quot;2018-09-10T20:12:43.732Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build_snapshot&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">    <span class="string">&quot;lucene_version&quot;</span> : <span class="string">&quot;6.6.1&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;tagline&quot;</span> : <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">root@f0df576e243c:/usr/share/elasticsearch<span class="comment">#</span></span><br></pre></td></tr></table></figure></li><li>浏览器访问<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1635214301/1639727935-092f9793.png"></li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Dockcer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitLab服务器</title>
      <link href="/2021/04/28/git/06.GitLab%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2021/04/28/git/06.GitLab%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="官网"><a href="#官网" class="headerlink" title="官网"></a>官网</h1><ul><li><a href="https://about.gitlab.com/">首页</a></li><li><a href="https://about.gitlab.com/installation/">安装说明</a></li></ul><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y curl policycoreutils-python openssh-server cronie</span><br><span class="line">sudo lokkit -s http -s ssh</span><br><span class="line">sudo yum install postfix</span><br><span class="line">sudo service postfix start</span><br><span class="line">sudo chkconfig postfix on</span><br><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.rpm.sh | sudo bash</span><br><span class="line">sudo EXTERNAL_URL=<span class="string">&quot;http://gitlab.example.com&quot;</span> yum -y install gitlab-ee</span><br></pre></td></tr></table></figure><p>　　<code>yum</code>安装<code>gitlab-ee</code>（或<code>ce</code>）时，需要联网下载安装文件，非常耗时，所以应提前把所需<code>RPM</code>包下载并安装好，<a href="https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-10.8.2-ce.0.el7.x86_64.rpm">下载地址</a>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh /opt/gitlab-ce-10.8.2-ce.0.el7.x86_64.rpm</span><br><span class="line">sudo yum install -y curl policycoreutils-python openssh-server cronie</span><br><span class="line">sudo lokkit -s http -s ssh</span><br><span class="line">sudo yum install postfix</span><br><span class="line">sudo service postfix start</span><br><span class="line">sudo chkconfig postfix on</span><br><span class="line">curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh | sudo bash</span><br><span class="line">sudo EXTERNAL_URL=<span class="string">&quot;http://gitlab.example.com&quot;</span> yum -y install gitlab-ce</span><br></pre></td></tr></table></figure><p>　　步骤完成后重启。</p><h1 id="GitLab-服务操作"><a href="#GitLab-服务操作" class="headerlink" title="GitLab 服务操作"></a>GitLab 服务操作</h1><ul><li>初始化配置<code>GitLab</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl reconfigure</span><br></pre></td></tr></table></figure></li><li>启动<code>GitLab</code>服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl start</span><br></pre></td></tr></table></figure></li><li>停止<code>GitLab</code>服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl stop</span><br></pre></td></tr></table></figure></li></ul><h1 id="浏览器访问"><a href="#浏览器访问" class="headerlink" title="浏览器访问"></a>浏览器访问</h1><p>访问<code>Linux</code>服务器<code>IP</code>地址即可，如果想访问<code>EXTERNAL_URL</code>指定的域名还需要配置域名服务器或本地<code>hosts</code> 文件。</p><p>初次登录时需要为<code>GitLab</code>的<code>root</code>用户设置密码：</p><div align="center">  <p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619601545/1639558817-412aea69.png"></p></div><p>应该会需要停止防火墙服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service firewalld stop</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git工作流</title>
      <link href="/2021/04/28/git/05.Git%E5%B7%A5%E4%BD%9C%E6%B5%81/"/>
      <url>/2021/04/28/git/05.Git%E5%B7%A5%E4%BD%9C%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>在项目开发过程中使用<code>Git</code>的方式。</p><h1 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h1><h2 id="集中式工作流"><a href="#集中式工作流" class="headerlink" title="集中式工作流"></a>集中式工作流</h2><p>像<code>SVN</code>一样，集中式工作流以中央仓库作为项目所有修改的单点实体。所有修改都提交到<code>Master</code>这个分支上。</p><p>这种方式与<code>SVN</code>的主要区别就是开发人员有本地库。<code>Git</code>很多特性并没有用到。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619590959/1639558390-b72865e1.png"></p></div><h2 id="GitFlow-工作流"><a href="#GitFlow-工作流" class="headerlink" title="GitFlow 工作流"></a>GitFlow 工作流</h2><p><code>Gitflow</code>工作流通过为功能开发、发布准备和维护设立了独立的分支，让发布迭代过程更流畅。严格的分支模型也为大型项目提供了一些非常必要的结构。</p><div align="center">  <p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619590959/1639558431-f7b6600c.png"></p></div><h1 id="Forking-工作流"><a href="#Forking-工作流" class="headerlink" title="Forking 工作流"></a>Forking 工作流</h1><p><code>Forking</code>工作流是在<code>GitFlow</code>基础上，充分利用了<code>Git</code>的<code>Fork</code>和<code>pull request</code>的功能以达到代码审核的目的。 更适合安全可靠地管理大团队的开发者， 而且能接受不信任贡献者的提交。</p><div align="center">  <p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619590959/1639558453-4cbe2bfa.png"></p></div><h1 id="GitFlow-工作流详解"><a href="#GitFlow-工作流详解" class="headerlink" title="GitFlow 工作流详解"></a>GitFlow 工作流详解</h1><h2 id="分支种类"><a href="#分支种类" class="headerlink" title="分支种类"></a>分支种类</h2><ul><li>主干分支<code>master</code><ul><li>主要负责管理正在运行的生产环境代码。 永远保持与正在运行的生产环境完全一致</li></ul></li><li>开发分支<code>develop</code><ul><li>主要负责管理正在开发过程中的代码，一般情况下应该是最新的代码</li></ul></li><li><code>bug</code>修理分支<code>hotfix</code><ul><li>主要负责管理生产环境下出现的紧急修复的代码</li><li>从主干分支分出，修理完毕并测试上线后，并回主干分支；并回后，视情况可以删除该分支</li></ul></li><li>准生产分支（预发布分支）<code>release</code><ul><li>较大的版本上线前， 会从开发分支中分出准生产分支， 进行最后阶段的集成测试</li><li>该版本上线后，会合并到主干分支。生产环境运行一段阶段较稳定后可以视情况删除</li></ul></li><li>功能分支<code>feature</code><ul><li>为了不影响较短周期的开发工作， 一般把中长期开发模块， 会从开发分支中独立出来</li><li>开发完成后会合并到开发分支</li></ul></li></ul><h2 id="GitFlow-工作流举例"><a href="#GitFlow-工作流举例" class="headerlink" title="GitFlow 工作流举例"></a>GitFlow 工作流举例</h2><div align="center">  <p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619590959/1639558487-8d9fd995.png"></p></div><h2 id="分支实战"><a href="#分支实战" class="headerlink" title="分支实战"></a>分支实战</h2><div align="center">  <p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619590959/1639558505-1736076b.png"></p></div>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GitHub</title>
      <link href="/2021/04/28/git/04.GitHub/"/>
      <url>/2021/04/28/git/04.GitHub/</url>
      
        <content type="html"><![CDATA[<h1 id="账号信息"><a href="#账号信息" class="headerlink" title="账号信息"></a>账号信息</h1><p><a href="https://github.com/"><code>GitHub</code>首页</a>就是注册页面。</p><h1 id="创建远程库"><a href="#创建远程库" class="headerlink" title="创建远程库"></a>创建远程库</h1><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557218-5af0e8b3.png"></p></div><h1 id="创建远程库地址别名"><a href="#创建远程库地址别名" class="headerlink" title="创建远程库地址别名"></a>创建远程库地址别名</h1><ul><li>查看当前所有远程地址别名<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure></li><li>创建远程库地址别名<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add [别名] [远程地址]</span><br></pre></td></tr></table></figure></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/huashan]$ gitt remote add origin https://github.com/atguigu2018ybuq/huashan.git</span><br><span class="line">[root@centos /home/huashan (master)]$ git remote -v</span><br><span class="line">origin https://github.com/atguigu2018ybuq/huashan.git (fetch)</span><br><span class="line">origin https://github.com/atguigu2018ybuq/huashan.git (push)</span><br></pre></td></tr></table></figure><h1 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h1><p>开发修改完把本地库的文件推送到远程仓库，前提是提交到了本地库才可以推送。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push [别名] [分支名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/huashan (master)]$ git push origin master</span><br></pre></td></tr></table></figure><h1 id="克隆"><a href="#克隆" class="headerlink" title="克隆"></a>克隆</h1><p>完整的把远程库克隆到本地，克隆下来后不要在主分支里面做开发。<code>clone</code>进行一次，从无到有的过程，更新用<code>pull</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> [远程地址]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/huashan]$ git <span class="built_in">clone</span> https://github.com/atguigu2018ybuq/huashan.git</span><br></pre></td></tr></table></figure><p>效果：</p><ul><li>完整的把远程库下载到本地</li><li>创建<code>origin</code>远程地址别名</li><li>初始化本地库</li></ul><h1 id="团队成员邀请"><a href="#团队成员邀请" class="headerlink" title="团队成员邀请"></a>团队成员邀请</h1><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557651-9a390d49.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557663-a076fc64.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557676-32257b87.png"></p></div><p>“岳不群”把邀请链接发送给“令狐冲”，令狐冲”登录自己的<code>GitHub</code>账号，访问邀请链接。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557711-64b05b32.png"></p></div><h1 id="拉取"><a href="#拉取" class="headerlink" title="拉取"></a>拉取</h1><p><code>pull=fetch+merge</code></p><ul><li><code>fetch</code>只是抓取远程库，不会修改本地，想要查看可以<code>git checkout origin/master</code></li><li>将<code>fetch</code>和<code>merge</code>分开来做，可以更方便，先将远程库抓取，查看之后再合并，合并使用<code>git merge origin/master</code></li><li>直接使用<code>pull</code>可能会在其中的<code>merge</code>操作发生冲突</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git fetch [远程库地址别名] [远程分支名]</span><br><span class="line">git merge [远程库地址别名/远程分支名]</span><br><span class="line">git pull [远程库地址别名] [远程分支名]</span><br></pre></td></tr></table></figure><h1 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h1><p><code>A</code>和<code>B</code>原本都是同样的文件，<code>A</code>修改后推送到<code>GitHub</code>上，<code>B</code>再修改后推送就不允许了。</p><ul><li>要点<ul><li>如果不是基于<code>GitHub</code>远程库的最新版所做的修改，不能推送，必须先拉取</li><li>拉取下来后如果进入冲突状态，则按照“分支冲突解决”操作解决即可</li><li>解决冲突后的提交是不能带文件名的</li></ul></li><li>类比<ul><li>债权人：老王</li><li>债务人：小刘</li><li>老王说：10 天后归还。小刘接受，双方达成一致</li><li>老王媳妇说：5 天后归还。小刘不能接受。老王媳妇需要找老王确认后再执行</li></ul></li></ul><h1 id="跨团队协作"><a href="#跨团队协作" class="headerlink" title="跨团队协作"></a>跨团队协作</h1><ul><li><p>Fork</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557754-87fca229.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557765-5461c3c0.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557780-1e770727.png"></p></div></li><li><p>本地修改，然后推送到远程</p></li><li><p><code>Pull Request</code></p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557862-447a0f29.png"></p></div><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557916-ebe49a0b.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557886-18db53f1.png"></p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557932-f58d4579.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557946-b390062f.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557962-38ab0f68.png"></p></div></li><li><p>对话</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557977-2b0b667b.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557986-cce3aaa4.png"></p></div></li><li><p>审核代码</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639557999-1259ec27.png"></p></div></li><li><p>合并代码</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639558016-53f4e673.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639558024-8fbb202c.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619577686/1639558033-b1ca4f8c.png"></p></div></li><li><p>将远程库修改拉取到本地</p></li></ul><h1 id="SSH-登录"><a href="#SSH-登录" class="headerlink" title="SSH 登录"></a>SSH 登录</h1><p>缺点：每台电脑只能登陆一个账号。</p><ul><li>进入当前用户的家目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br></pre></td></tr></table></figure></li><li>删除<code>.ssh</code>目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> -rvf .ssh</span><br></pre></td></tr></table></figure></li><li>运行命令生成<code>.ssh</code>密钥目录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意：这里 -C 参数是大写的 C</span></span><br><span class="line">ssh-keygen -t rsa -C atguigu2018ybuq@aliyun.com</span><br></pre></td></tr></table></figure></li><li>进入<code>.ssh</code>目录查看文件列表<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line"> <span class="built_in">ls</span> -lF</span><br></pre></td></tr></table></figure></li><li>查看<code>id_rsa.pub</code>文件内容<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> id_rsa.pub</span><br></pre></td></tr></table></figure></li><li>复制<code>id_rsa.pub</code>文件内容， 登录<code>GitHub</code>，点击用户头像→<code>Settings</code>→<code>SSH and GPG keys</code></li><li><code>New SSH Key</code></li><li>输入复制的密钥信息</li><li>回到<code>Git bash</code>创建远程地址别名<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin_ssh git@github.com:atguigu2018ybuq/huashan.git</span><br></pre></td></tr></table></figure></li><li>推送文件进行测试</li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git基本原理</title>
      <link href="/2021/04/27/git/03.Git%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
      <url>/2021/04/27/git/03.Git%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="哈希"><a href="#哈希" class="headerlink" title="哈希"></a>哈希</h1><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490272-1d560d57.png"></p></div><p>哈希是一个系列的加密算法， 各个不同的哈希算法虽然加密强度不同， 但是有以下几个共同点：</p><ol><li>不管输入数据的数据量有多大， 输入同一个哈希算法， 得到的加密结果长度固定</li><li>哈希算法确定，输入数据确定，输出数据能够保证不变</li><li>哈希算法确定，输入数据有变化，输出数据一定有变化，而且通常变化很大</li><li>哈希算法不可逆</li></ol><p><code>Git</code>底层采用的是<code>SHA-1</code>算法。</p><p>哈希算法可以被用来验证文件。原理如下图所示：</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490341-897d5c2a.png"></p></div><p><code>Git</code>就是靠这种机制来从根本上保证数据完整性的。</p><h1 id="Git-保存版本的机制"><a href="#Git-保存版本的机制" class="headerlink" title="Git 保存版本的机制"></a>Git 保存版本的机制</h1><h2 id="集中式版本控制工具的文件管理机制"><a href="#集中式版本控制工具的文件管理机制" class="headerlink" title="集中式版本控制工具的文件管理机制"></a>集中式版本控制工具的文件管理机制</h2><p>以文件变更列表的方式存储信息。 这类系统将它们保存的信息看作是一组基本文件和每个文件随时间逐步累积的差异。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490364-7adebb8f.png"></p></div><h2 id="Git-的文件管理机制"><a href="#Git-的文件管理机制" class="headerlink" title="Git 的文件管理机制"></a>Git 的文件管理机制</h2><p><code>Git</code>把数据看作是小型文件系统的一组快照。每次提交更新时<code>Git</code>都会对当前的全部文件制作一个快照并保存这个快照的索引。为了高效，如果文件没有修改，<code>Git</code>不再重新存储该文件，而是只保留一个链接指向之前存储的文件。所以<code>Git</code>的工作方式可以称之为快照流。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490395-56476f26.png"></p></div><h2 id="Git-文件管理机制细节"><a href="#Git-文件管理机制细节" class="headerlink" title="Git 文件管理机制细节"></a>Git 文件管理机制细节</h2><ul><li>Git 的“提交对象”<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490419-85847034.png"></li><li>提交对象及其父对象形成的链条<br><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490437-9e8efdf9.png"></li></ul><h1 id="Git-分支管理机制"><a href="#Git-分支管理机制" class="headerlink" title="Git 分支管理机制"></a>Git 分支管理机制</h1><h2 id="分支的创建"><a href="#分支的创建" class="headerlink" title="分支的创建"></a>分支的创建</h2><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490458-8c349184.png"></p></div>　## 分支的切换<div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490479-cb2a878d.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490492-39e44130.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490618-b22f8098.png"></p><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619531566/1639490628-a44465ab.png"></p></div>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git操作</title>
      <link href="/2021/04/23/git/02.Git%E6%93%8D%E4%BD%9C/"/>
      <url>/2021/04/23/git/02.Git%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="本地库初始化"><a href="#本地库初始化" class="headerlink" title="本地库初始化"></a>本地库初始化</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><p>注意：<code>.git</code>目录中存放的是本地库相关的子目录和文件，不要删除，也不要胡乱修改。</p><h1 id="设置签名"><a href="#设置签名" class="headerlink" title="设置签名"></a>设置签名</h1><ul><li><p>形式</p><ul><li>用户名：<code>tom</code></li><li><code>Email</code>地址：<code>goodMorning@atguigu.com</code></li></ul></li><li><p>作用：区分不同开发人员的身份</p></li><li><p>辨析：这里设置的签名和登录远程库（代码托管中心）的账号、密码没有任何关系。</p></li><li><p>命令</p><ul><li><p>项目级别/仓库级别：仅在当前本地库范围内有效</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.name tom_pro</span><br><span class="line">git config user.email goodMorning_pro@atguigu.com</span><br></pre></td></tr></table></figure><p>信息保存位置：<code>./.git/config</code>文件</p></li><li><p>系统用户级别：登录当前操作系统的用户范围</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name tom_glb</span><br><span class="line">git config --global goodMorning_pro@atguigu.com</span><br></pre></td></tr></table></figure><p>信息保存位置：<code>~/.gitconfig</code>文件</p></li></ul></li><li><p>级别优先级</p><ul><li>就近原则： 项目级别优先于系统用户级别， 二者都有时采用项目级别的签名</li><li>如果只有系统用户级别的签名，就以系统用户级别的签名为准</li><li>不允许二者都没有</li></ul></li></ul><h1 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h1><h2 id="状态查看"><a href="#状态查看" class="headerlink" title="状态查看"></a>状态查看</h2><p>查看工作区、暂存区状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><p>将工作区的“新建/修改”添加到暂存区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add [file name]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ vi test.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add test.txt</span><br></pre></td></tr></table></figure><h2 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h2><p>将暂存区的内容提交到本地库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&quot;commit message&quot;</span> [file name]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git commit -m <span class="string">&quot;first commit&quot;</span> test.txt</span><br></pre></td></tr></table></figure><h2 id="查看历史记录"><a href="#查看历史记录" class="headerlink" title="查看历史记录"></a>查看历史记录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git <span class="built_in">log</span></span><br><span class="line">commit f60cd6c (HEAD -&gt; master)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --oneline</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HEAD@&#123;移动到当前版本需要多少步&#125;</span></span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure><p>多屏显示控制方式：</p><ul><li>空格向下翻页</li><li><code>b</code>向上翻页</li><li><code>q</code>退出</li></ul><h2 id="前进后退"><a href="#前进后退" class="headerlink" title="前进后退"></a>前进后退</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git reflog</span><br><span class="line">ee9b643 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: <span class="built_in">test</span> add h</span><br><span class="line">bea03f7 HEAD@&#123;1&#125;: commit: <span class="built_in">test</span> add g</span><br><span class="line">2237de4 HEAD@&#123;2&#125;: commit: <span class="built_in">test</span> add f</span><br><span class="line">4e8b43b HEAD@&#123;3&#125;: commit: <span class="built_in">test</span> add e</span><br><span class="line">c9fe281 HEAD@&#123;4&#125;: commit: <span class="built_in">test</span> add d</span><br><span class="line">9c4147d HEAD@&#123;5&#125;: commit: <span class="built_in">test</span> thrid commit </span><br><span class="line">31eebcc HEAD@&#123;6&#125;: commit: <span class="built_in">test</span> second commit </span><br><span class="line">f60cd6c HEAD@&#123;7&#125;: commit: <span class="built_in">test</span> first commit</span><br></pre></td></tr></table></figure><ul><li><p>基于索引值操作[<strong>推荐</strong>]</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard [局部索引值]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git reset --hard 9c4147d</span><br><span class="line">HEAD is now at 9c4147d <span class="built_in">test</span> thrid commit</span><br><span class="line">[root@centos /home/gittest (master)]$ git reflog</span><br><span class="line">9c4147d (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to 9c4147d </span><br><span class="line">ee9b643 HEAD@&#123;1&#125;: commit: <span class="built_in">test</span> add h</span><br><span class="line">bea03f7 HEAD@&#123;2&#125;: commit: <span class="built_in">test</span> add g</span><br><span class="line">2237de4 HEAD@&#123;3&#125;: commit: <span class="built_in">test</span> add f</span><br><span class="line">4e8b43b HEAD@&#123;4&#125;: commit: <span class="built_in">test</span> add e</span><br><span class="line">c9fe281 HEAD@&#123;5&#125;: commit: <span class="built_in">test</span> add d</span><br><span class="line">9c4147d (HEAD -&gt; master) HEAD@&#123;6&#125;: commit (initial): <span class="built_in">test</span> thrid commit </span><br><span class="line">31eebcc HEAD@&#123;7&#125;: commit: <span class="built_in">test</span> second commit </span><br><span class="line">f60cd6c HEAD@&#123;8&#125;: commit: <span class="built_in">test</span> first commit</span><br></pre></td></tr></table></figure></li><li><p>使用<code>^</code>符号：只能后退</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD^</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git reset --hard HEAD^</span><br><span class="line">HEAD is now at 31eebcc <span class="built_in">test</span> second commit</span><br><span class="line">[root@centos /home/gittest (master)]$ git reflog</span><br><span class="line">31eebcc (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to HEAD^</span><br><span class="line">9c4147d HEAD@&#123;1&#125;: reset: moving to 9c4147d</span><br><span class="line">ee9b643 HEAD@&#123;2&#125;: commit: <span class="built_in">test</span> add h</span><br><span class="line">bea03f7 HEAD@&#123;3&#125;: commit: <span class="built_in">test</span> add g</span><br><span class="line">2237de4 HEAD@&#123;4&#125;: commit: <span class="built_in">test</span> add f</span><br><span class="line">4e8b43b HEAD@&#123;5&#125;: commit: <span class="built_in">test</span> add e</span><br><span class="line">c9fe281 HEAD@&#123;6&#125;: commit: <span class="built_in">test</span> add d</span><br><span class="line">9c4147d HEAD@&#123;7&#125;: commit: <span class="built_in">test</span> thrid commit </span><br><span class="line">31eebcc (HEAD -&gt; master) HEAD@&#123;8&#125;: commit (initial): <span class="built_in">test</span> second commit </span><br><span class="line">f60cd6c HEAD@&#123;9&#125;: commit: <span class="built_in">test</span> first commit</span><br></pre></td></tr></table></figure><p>注：一个<code>^</code>表示后退一步，<code>n</code>个表示后退<code>n</code>步</p></li><li><p>使用<code>~</code>符号：只能后退</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard HEAD~n</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git reset --hard HEAD~1</span><br><span class="line">HEAD is now at f60cd6c <span class="built_in">test</span> first commit</span><br><span class="line">[root@centos /home/gittest (master)]$ git reflog</span><br><span class="line">f60cd6c (HEAD -&gt; master) HEAD@&#123;0&#125;: reset: moving to HEAD~1</span><br><span class="line">31eebcc HEAD@&#123;1&#125;: reset: moving to HEAD^ </span><br><span class="line">9c4147d HEAD@&#123;2&#125;: reset: moving to 9c4147d</span><br><span class="line">ee9b643 HEAD@&#123;3&#125;: commit: <span class="built_in">test</span> add h</span><br><span class="line">bea03f7 HEAD@&#123;4&#125;: commit: <span class="built_in">test</span> add g</span><br><span class="line">2237de4 HEAD@&#123;5&#125;: commit: <span class="built_in">test</span> add f</span><br><span class="line">4e8b43b HEAD@&#123;6&#125;: commit: <span class="built_in">test</span> add e</span><br><span class="line">c9fe281 HEAD@&#123;7&#125;: commit: <span class="built_in">test</span> add d</span><br><span class="line">9c4147d HEAD@&#123;8&#125;: commit: <span class="built_in">test</span> thrid commit </span><br><span class="line">31eebcc HEAD@&#123;9&#125;: commit: <span class="built_in">test</span> second commit </span><br><span class="line">f60cd6c (HEAD -&gt; master) HEAD@&#123;10&#125;: commit (initial): <span class="built_in">test</span> first commit</span><br></pre></td></tr></table></figure><p>注：表示后退<code>n</code>步</p></li></ul><h3 id="reset-命令的三个参数对比"><a href="#reset-命令的三个参数对比" class="headerlink" title="reset 命令的三个参数对比"></a>reset 命令的三个参数对比</h3><ul><li><p><code>--soft</code>参数</p><ul><li>仅仅在本地库移动<code>HEAD</code>指针</li></ul><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619145994/1639488543-28b46baa.png"></p></li><li><p><code>--mixed</code>参数</p><ul><li>在本地库移动<code>HEAD</code>指针</li><li>重置暂存区</li></ul><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619145994/1639488566-0edd428e.png"></p></li><li><p><code>--hard</code>参数</p><ul><li>在本地库移动<code>HEAD</code>指针</li><li>重置暂存区</li><li>重置工作区</li></ul></li></ul><h2 id="删除文件并找回"><a href="#删除文件并找回" class="headerlink" title="删除文件并找回"></a>删除文件并找回</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ vi delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git commit -m <span class="string">&quot;create delete.txt&quot;</span> delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ <span class="built_in">rm</span> delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add delete.txt</span><br></pre></td></tr></table></figure><ul><li><p>前提：删除前，文件存在时的状态提交到了本地库。</p></li><li><p>操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard [指针位置]</span><br></pre></td></tr></table></figure><ul><li>删除操作已经提交到本地库：指针位置指向历史记录<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ <span class="built_in">rm</span> delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git commit -m <span class="string">&quot;delete delete.txt&quot;</span> delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git reflog</span><br><span class="line">03b0563 (HEAD -&gt; master) HEAD@&#123;0&#125;: commit: delete delete.txt</span><br><span class="line">2d75244 HEAD@&#123;1&#125;: commit: create delete.txt</span><br><span class="line">f60cd6c HEAD@&#123;2&#125;: reset: moving to HEAD~1</span><br><span class="line">31eebcc HEAD@&#123;3&#125;: reset: moving to HEAD^ </span><br><span class="line">9c4147d HEAD@&#123;4&#125;: reset: moving to 9c4147d</span><br><span class="line">ee9b643 HEAD@&#123;5&#125;: commit: <span class="built_in">test</span> add h</span><br><span class="line">bea03f7 HEAD@&#123;6&#125;: commit: <span class="built_in">test</span> add g</span><br><span class="line">2237de4 HEAD@&#123;7&#125;: commit: <span class="built_in">test</span> add f</span><br><span class="line">4e8b43b HEAD@&#123;8&#125;: commit: <span class="built_in">test</span> add e</span><br><span class="line">c9fe281 HEAD@&#123;9&#125;: commit: <span class="built_in">test</span> add d</span><br><span class="line">9c4147d HEAD@&#123;10&#125;: commit: <span class="built_in">test</span> thrid commit </span><br><span class="line">31eebcc HEAD@&#123;11&#125;: commit: <span class="built_in">test</span> second commit </span><br><span class="line">f60cd6c HEAD@&#123;12&#125;: commit (initial): <span class="built_in">test</span> first commit</span><br><span class="line">[root@centos /home/gittest (master)]$ git reset --hard 2d75244</span><br><span class="line">[root@centos /home/gittest (master)]$ ll</span><br></pre></td></tr></table></figure></li><li>删除操作尚未提交到本地库：指针位置使用<code>HEAD</code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ ll</span><br><span class="line">total 2</span><br><span class="line">delete.txt</span><br><span class="line">test.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ <span class="built_in">rm</span> delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add delete.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ ll</span><br><span class="line">total 1</span><br><span class="line">test.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git reset --hard HEAD</span><br><span class="line">[root@centos /home/gittest (master)]$ ll</span><br><span class="line">total 2</span><br><span class="line">delete.txt</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="比较文件差异"><a href="#比较文件差异" class="headerlink" title="比较文件差异"></a>比较文件差异</h2><ul><li><p>将工作区中的文件和暂存区进行比较</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff [文件名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ vi test.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git diff test.txt</span><br></pre></td></tr></table></figure></li><li><p>将工作区中的文件和本地库历史记录比较</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff [本地库中历史版本] [文件名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git diff HEAD^ test.txt</span><br><span class="line">diff --git a/test.txt b/test.txt</span><br></pre></td></tr></table></figure></li><li><p>不带文件名比较多个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git diff</span><br></pre></td></tr></table></figure></li></ul><h2 id="分支管理"><a href="#分支管理" class="headerlink" title="分支管理"></a>分支管理</h2><h3 id="什么是分支"><a href="#什么是分支" class="headerlink" title="什么是分支"></a>什么是分支</h3><p>在版本控制过程中，使用多条线同时推进多个任务。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1619145994/1639488882-3b2b4f4b.png"></p></div><h3 id="分支的好处"><a href="#分支的好处" class="headerlink" title="分支的好处"></a>分支的好处</h3><ul><li>同时并行推进多个功能开发，提高开发效率</li><li>各个分支在开发过程中，如果某一个分支开发失败，不会对其他分支有任 何影响。失败的分支删除重新开始即可。</li></ul><h3 id="分支操作"><a href="#分支操作" class="headerlink" title="分支操作"></a>分支操作</h3><ul><li><p>创建分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch [分支名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git branch hot_fix</span><br></pre></td></tr></table></figure></li><li><p>查看分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -v</span><br></pre></td></tr></table></figure></li><li><p>切换分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [分支名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git checkout hot_fix</span><br></pre></td></tr></table></figure></li><li><p>合并分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (hot_fix)]$ vi aaa.txt</span><br><span class="line">[root@centos /home/gittest (hot_fix)]$ git add aaa.txt</span><br><span class="line">[root@centos /home/gittest (hot_fix)]$ git commit -m <span class="string">&quot;hot_fix&quot;</span> aaa.txt</span><br></pre></td></tr></table></figure><ol><li><p>切换到接受修改的分支（被合并，增加新内容）上</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout [被合并分支名]</span><br></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (hot_fix)]$ git checkout master</span><br><span class="line">[root@centos /home/gittest (master)]$ vi aaa.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git add aaa.txt</span><br><span class="line">[root@centos /home/gittest (master)]$ git commit -m <span class="string">&quot;master&quot;</span> aaa.txt</span><br></pre></td></tr></table></figure></li><li><p>第二步：执行<code>merge</code>命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge [有新内容分支名]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (master)]$ git merge hot_fix</span><br></pre></td></tr></table></figure></li></ol></li><li><p>解决冲突</p><ul><li>冲突的表现<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (hot_fix)]$  git merge master</span><br><span class="line">Auto-merging aaa.txt</span><br><span class="line">CONFLICT (ontent): Merge conflict <span class="keyword">in</span> aaa.txt</span><br><span class="line">Automatic merge failed; fix conflicts and <span class="keyword">then</span> commit the</span><br></pre></td></tr></table></figure></li><li>冲突的解决<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当前分支内容</span></span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; <span class="string">HEAD</span></span><br><span class="line"><span class="string">hot_fix</span></span><br><span class="line"><span class="string">=======</span></span><br><span class="line"><span class="string"># 另一分支内容</span></span><br><span class="line"><span class="string">master</span></span><br><span class="line"><span class="string">&gt;&gt;&gt;&gt;&gt;&gt;&gt; master</span></span><br></pre></td></tr></table></figure><ol><li>编辑文件，删除特殊符号 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hot_fix</span><br><span class="line"></span><br><span class="line">master</span><br></pre></td></tr></table></figure></li><li>把文件修改到满意的程度，保存退出 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hot_fix master</span><br></pre></td></tr></table></figure></li><li><code>git add [文件名]</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (hot_fix|MERGING)]$ git add aaa.txt</span><br></pre></td></tr></table></figure></li><li><code>git commit -m &quot;日志信息&quot;</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /home/gittest (hot_fix|MERGING)]$ git commit -m <span class="string">&quot;hot and master&quot;</span></span><br></pre></td></tr></table></figure></li><li>此时<code>commit</code>一定不能带具体文件名</li></ol></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>简介</title>
      <link href="/2021/04/19/git/01.%E7%AE%80%E4%BB%8B/"/>
      <url>/2021/04/19/git/01.%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="版本控制工具应该具备的功能"><a href="#版本控制工具应该具备的功能" class="headerlink" title="版本控制工具应该具备的功能"></a>版本控制工具应该具备的功能</h1><ul><li>协同修改<ul><li>多人并行不悖的修改服务器端的同一个文件</li></ul></li><li>数据备份<ul><li>不仅保存目录和文件的当前状态，还能够保存每一个提交过的历史状态</li></ul></li><li>版本管理<ul><li>在保存每一个版本的文件信息的时候要做到不保存重复数据，以节约存储空间，提高运行效率。这方面<code>SVN</code>采用的是增量式管理的方式，而<code>Git</code>采取了文件系统快照的方式</li></ul></li><li>权限控制<ul><li>对团队中参与开发的人员进行权限控制</li><li>对团队外开发者贡献的代码进行审核——<code>Git</code>独有</li></ul></li><li>历史记录<ul><li>查看修改人、修改时间、修改内容、日志信息</li><li>将本地文件恢复到某一个历史状态</li></ul></li><li>分支管理<ul><li>允许开发团队在工作过程中多条生产线同时推进任务，进一步提高效率</li></ul></li></ul><h1 id="版本控制简介"><a href="#版本控制简介" class="headerlink" title="版本控制简介"></a>版本控制简介</h1><h2 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h2><p>　　工程设计领域中使用版本控制管理工程蓝图的设计过程。在<code>IT</code>开发过程中也可以使用版本控制思想管理代码的版本迭代。</p><h2 id="版本控制工具"><a href="#版本控制工具" class="headerlink" title="版本控制工具"></a>版本控制工具</h2><ul><li>集中式版本控制工具：<code>CVS</code>、<code>SVN</code>、<code>VSS</code>…</li><li>分布式版本控制工具：<code>Git</code>、<code>Mercurial</code>、<code>Bazaar</code>、<code>Darcs</code>…</li></ul><h1 id="Git-简介"><a href="#Git-简介" class="headerlink" title="Git 简介"></a>Git 简介</h1><p><code>Git</code>是分布式版本控制系统，它没有中央服务器，每个人的电脑就是一个完整的版本库，这样，工作的时候就不需要联网了，因为版本都是在自己的电脑上。既然每个人的电脑都有一个完整的版本库，那多个人如何协作呢？比如说自己在电脑上改了文件A，其他人也在电脑上改了文件A，这时，你们两之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639487875-eee8781a.png"></p></div><p>仓库（版本库）：相当于一个专门用来存放代码的目录。这个目录里面的所有文件都可以<code>Git</code>管理，每个文件的增删改查都能被<code>Git</code>跟踪到</p><h2 id="Git-简史"><a href="#Git-简史" class="headerlink" title="Git 简史"></a>Git 简史</h2><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639487926-eab22d66.png"></p></div><h2 id="Git-官网"><a href="#Git-官网" class="headerlink" title="Git 官网"></a>Git 官网</h2><p><a href="https://git-scm.com/">官网地址</a></p><h2 id="Git-优势"><a href="#Git-优势" class="headerlink" title="Git 优势"></a>Git 优势</h2><ul><li>大部分操作在本地完成，不需要联网</li><li>完整性保证</li><li>尽可能添加数据而不是删除或修改数据</li><li>分支操作非常快捷流畅</li><li>与<code>Linux</code>命令全面兼容</li></ul><h2 id="Git-安装"><a href="#Git-安装" class="headerlink" title="Git 安装"></a>Git 安装</h2><ul><li>安装到非中文没有空格的目录下</li><li>建议用<code>VIM</code>编辑器</li><li>完全不修改<code>path</code>变量，仅在<code>Git Bash</code>中使用<code>Git</code>：<code>Use Git from Git Bash only</code></li><li><code>Use the OpenSSL library</code></li><li>行末换行符转换方式，使用默认值：<code>Checkout Windows-style, commit Unix-style line endings</code></li><li>执行<code>Git</code>命令的默认终端，使用默认值：<code>Use MinTTY</code></li></ul><h2 id="Git-结构"><a href="#Git-结构" class="headerlink" title="Git 结构"></a>Git 结构</h2><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639488000-3148bac9.png"></p></div><h2 id="Git-和代码托管中心"><a href="#Git-和代码托管中心" class="headerlink" title="Git 和代码托管中心"></a>Git 和代码托管中心</h2><p>代码托管中心的任务：维护远程库</p><ul><li>局域网环境下<ul><li>GitLab 服务器</li></ul></li><li>外网环境下<ul><li>GitHub</li><li>码云</li></ul></li></ul><h2 id="本地库和远程库"><a href="#本地库和远程库" class="headerlink" title="本地库和远程库"></a>本地库和远程库</h2><h3 id="团队内部协作"><a href="#团队内部协作" class="headerlink" title="团队内部协作"></a>团队内部协作</h3><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639488043-341e9b6d.png"></p></div><h3 id="跨团队协作"><a href="#跨团队协作" class="headerlink" title="跨团队协作"></a>跨团队协作</h3><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639488062-0a05b2c2.png"></p></div><h2 id="Git-工作流程"><a href="#Git-工作流程" class="headerlink" title="Git 工作流程"></a>Git 工作流程</h2><p>1．从远程仓库中克隆<code>Git</code>资源作为本地仓库<br>2．从本地仓库中<code>checkout</code>代码然后进行代码修改<br>3．在提交前先将代码提交到暂存区<br>4．提交修改。提交到本地仓库。本地仓库中保存修改的各个历史版本<br>5．在修改完成后，需要和团队成员共享代码时，可以将代码<code>push</code>到远程仓库</p><div align="center"><p><img src="https://cdn.jsdelivr.net/gh/atideas/assets/note/1618811193/1639488132-1cfd971e.png"></p></div>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
